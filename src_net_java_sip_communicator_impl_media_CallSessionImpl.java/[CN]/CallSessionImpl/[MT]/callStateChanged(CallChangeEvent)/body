{
  if (evt.getNewValue() == CallState.CALL_IN_PROGRESS && evt.getNewValue() != evt.getOldValue()) {
    try {
      logger.debug("call connected. starting streaming");
      startStreaming();
      mediaServCallback.getMediaControl(getCall()).startProcessingMedia(this);
    }
 catch (    MediaException ex) {
      logger.error("Failed to start streaming.",ex);
    }
  }
 else   if (evt.getNewValue() == CallState.CALL_ENDED && evt.getNewValue() != evt.getOldValue()) {
    logger.warn("Stopping streaming.");
    stopStreaming();
    mediaServCallback.getMediaControl(getCall()).stopProcessingMedia(this);
    Iterator<Player> playersIter=players.iterator();
    while (playersIter.hasNext()) {
      Player player=playersIter.next();
      player.stop();
      player.deallocate();
      player.close();
      playersIter.remove();
    }
    Iterator<javax.swing.JFrame> videoFramesIter=videoFrames.iterator();
    while (videoFramesIter.hasNext()) {
      javax.swing.JFrame frame=videoFramesIter.next();
      frame.setVisible(false);
      frame.dispose();
      videoFramesIter.remove();
    }
    evt.getSourceCall().removeCallChangeListener(this);
    RTPManager audioRtpMan=getAudioRtpManager();
    if (audioRtpMan != null)     audioRtpMan.dispose();
    RTPManager videoRtpMan=getVideoRtpManager();
    if (videoRtpMan != null)     videoRtpMan.dispose();
  }
}
