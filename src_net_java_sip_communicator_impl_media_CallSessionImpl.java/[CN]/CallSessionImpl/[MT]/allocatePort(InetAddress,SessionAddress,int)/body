{
  InetSocketAddress publicAddress=null;
  boolean initialized=false;
  NetworkAddressManagerService netAddressManager=MediaActivator.getNetworkAddressManagerService();
  for (int i=bindRetries; i > 0; i--) {
    try {
      publicAddress=netAddressManager.getPublicAddressFor(intendedDestination,sessionAddress.getDataPort());
      netAddressManager.getPublicAddressFor(intendedDestination,sessionAddress.getControlPort());
      initialized=true;
      break;
    }
 catch (    IOException ex) {
      logger.warn("Retrying a bind because of a failure. " + "Failed Address is: " + sessionAddress.toString(),ex);
      sessionAddress.setDataPort(sessionAddress.getDataPort() + 2);
      sessionAddress.setControlPort(sessionAddress.getControlPort() + 2);
    }
  }
  if (!initialized)   throw new MediaException("Failed to bind to a local port in " + Integer.toString(bindRetries) + " tries.",MediaException.INTERNAL_ERROR);
  return publicAddress;
}
