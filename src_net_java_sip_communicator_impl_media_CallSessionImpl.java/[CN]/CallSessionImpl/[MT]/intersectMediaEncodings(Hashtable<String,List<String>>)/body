{
  MediaControl mediaControl=mediaServCallback.getMediaControl(getCall());
  String[] supportedAudioEncodings=mediaControl.getSupportedAudioEncodings();
  String[] supportedVideoEncodings=mediaControl.getSupportedVideoEncodings();
  List<String> offeredAudioEncodings=offeredEncodings.get("audio");
  List<String> offeredVideoEncodings=offeredEncodings.get("video");
  List<String> supportedAudioEncsList=Arrays.asList(supportedAudioEncodings);
  List<String> intersectedAudioEncsList=new LinkedList<String>();
  List<String> supportedVideoEncsList=Arrays.asList(supportedVideoEncodings);
  List<String> intersectedVideoEncsList=new LinkedList<String>();
  if (offeredAudioEncodings != null && offeredAudioEncodings.size() > 0) {
    Iterator<String> offeredAudioEncsIter=offeredAudioEncodings.iterator();
    while (offeredAudioEncsIter.hasNext()) {
      String format=offeredAudioEncsIter.next();
      if (supportedAudioEncsList.contains(format))       intersectedAudioEncsList.add(format);
    }
  }
  if (offeredVideoEncodings != null && offeredVideoEncodings.size() > 0) {
    Iterator<String> offeredVideoEncsIter=offeredVideoEncodings.iterator();
    while (offeredVideoEncsIter.hasNext()) {
      String format=offeredVideoEncsIter.next();
      if (supportedVideoEncsList.contains(format))       intersectedVideoEncsList.add(format);
    }
  }
  if (intersectedAudioEncsList.size() == 0 && intersectedVideoEncsList.size() == 0) {
    throw new MediaException("None of the offered formats was supported by this " + "media implementation",MediaException.UNSUPPORTED_FORMAT_SET_ERROR);
  }
  Hashtable<String,List<String>> intersection=new Hashtable<String,List<String>>(2);
  intersection.put("audio",intersectedAudioEncsList);
  intersection.put("video",intersectedVideoEncsList);
  return intersection;
}
