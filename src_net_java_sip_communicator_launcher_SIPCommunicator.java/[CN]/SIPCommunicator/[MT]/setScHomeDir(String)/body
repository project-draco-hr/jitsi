{
  String location=System.getProperty(PNAME_SC_HOME_DIR_LOCATION);
  String name=System.getProperty(PNAME_SC_HOME_DIR_NAME);
  boolean isHomeDirnameForced=name != null;
  if ((location == null) || (name == null)) {
    String defaultLocation=System.getProperty("user.home");
    String defaultName=".sip-communicator";
    if (osName.startsWith("Mac")) {
      if (location == null)       location=System.getProperty("user.home") + File.separator + "Library"+ File.separator+ "Application Support";
      if (name == null)       name="SIP Communicator";
    }
 else     if (osName.startsWith("Windows")) {
      if (location == null)       location=System.getenv("APPDATA");
      if (name == null)       name="SIP Communicator";
    }
    if (location == null)     location=defaultLocation;
    if (name == null)     name=defaultName;
    if (!isHomeDirnameForced && (new File(location,name).isDirectory() == false) && new File(defaultLocation,defaultName).isDirectory()) {
      location=defaultLocation;
      name=defaultName;
    }
    if (isHomeDirnameForced && name.equals(overridableDirName) && !new File(location,name).isDirectory()) {
      for (int i=0; i < legacyDirNames.length; i++) {
        if (new File(location,legacyDirNames[i]).isDirectory()) {
          name=legacyDirNames[i];
          break;
        }
        if (new File(defaultLocation,legacyDirNames[i]).isDirectory()) {
          name=legacyDirNames[i];
          location=defaultLocation;
          break;
        }
      }
    }
    System.setProperty(PNAME_SC_HOME_DIR_LOCATION,location);
    System.setProperty(PNAME_SC_HOME_DIR_NAME,name);
  }
}
