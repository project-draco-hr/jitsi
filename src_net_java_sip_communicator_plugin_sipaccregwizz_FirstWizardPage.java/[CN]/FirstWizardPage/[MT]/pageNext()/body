{
  String uin=uinField.getText();
  int indexOfSeparator=uin.indexOf('@');
  if (indexOfSeparator > -1) {
    uin=uin.substring(0,indexOfSeparator);
  }
  String server=serverField.getText();
  if (!wizard.isModification() && isExistingAccount(uin,server)) {
    nextPageIdentifier=FIRST_PAGE_IDENTIFIER;
    uinPassPanel.add(existingAccountLabel,BorderLayout.NORTH);
    this.revalidate();
  }
 else {
    nextPageIdentifier=SUMMARY_PAGE_IDENTIFIER;
    uinPassPanel.remove(existingAccountLabel);
    SIPAccountRegistration registration=wizard.getRegistration();
    registration.setUin(uinField.getText());
    if (passField.getPassword() != null)     registration.setPassword(new String(passField.getPassword()));
    registration.setRememberPassword(rememberPassBox.isSelected());
    registration.setServerAddress(serverField.getText());
    registration.setServerPort(serverPortField.getText());
    registration.setProxy(proxyField.getText());
    registration.setProxyPort(proxyPortField.getText());
    registration.setPreferredTransport(transportCombo.getSelectedItem().toString());
    registration.setEnablePresence(enablePresOpButton.isSelected());
    registration.setForceP2PMode(forceP2PPresOpButton.isSelected());
    registration.setPollingPeriod(pollPeriodField.getText());
    registration.setSubscriptionExpiration(subscribeExpiresField.getText());
    registration.setKeepAliveMethod(keepAliveMethodBox.getSelectedItem().toString());
    registration.setKeepAliveInterval(keepAliveIntervalValue.getText());
  }
}
