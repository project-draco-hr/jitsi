{
  U opset=parentProvider.getOperationSet(opsetClass);
  if (opset == null)   return null;
  if (!online) {
    if (OFFLINE_OPERATION_SETS.contains(opsetClass))     return opset;
 else     return null;
  }
  if (OPERATION_SETS_TO_FEATURES.containsKey(opsetClass)) {
    String[] features=OPERATION_SETS_TO_FEATURES.get(opsetClass);
    if ((features == null) || ((features.length != 0) && !parentProvider.isFeatureListSupported(parentProvider.getFullJid(contact),features)))     opset=null;
  }
  return opset;
}
