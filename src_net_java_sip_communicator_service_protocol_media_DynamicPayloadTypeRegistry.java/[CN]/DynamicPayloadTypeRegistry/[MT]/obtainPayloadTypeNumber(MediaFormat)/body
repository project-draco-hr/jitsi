{
  MediaType mediaType=format.getMediaType();
  String encoding=format.getEncoding();
  double clockRate=format.getClockRate();
  int channels=MediaType.AUDIO.equals(mediaType) ? ((AudioMediaFormat)format).getChannels() : MediaFormatFactory.CHANNELS_NOT_SPECIFIED;
  Byte payloadType=null;
  for (  Map.Entry<MediaFormat,Byte> payloadTypeMapping : payloadTypeMappings.entrySet()) {
    if (AbstractMediaStream.matches(payloadTypeMapping.getKey(),mediaType,encoding,clockRate,channels)) {
      payloadType=payloadTypeMapping.getValue();
      break;
    }
  }
  if (payloadType == null) {
    payloadType=nextPayloadTypeNumber();
    payloadTypeMappings.put(format,payloadType);
  }
  return payloadType;
}
