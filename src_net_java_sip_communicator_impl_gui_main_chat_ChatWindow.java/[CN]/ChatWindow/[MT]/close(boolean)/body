{
  ChatPanel chatPanel=getCurrentChatPanel();
  if (isEscaped) {
    ChatRightButtonMenu chatRightMenu=getCurrentChatPanel().getChatConversationPanel().getRightButtonMenu();
    WritePanelRightButtonMenu writePanelRightMenu=getCurrentChatPanel().getChatWritePanel().getRightButtonMenu();
    SIPCommMenu selectedMenu=menusPanel.getMainMenuBar().getSelectedMenu();
    MenuSelectionManager menuSelectionManager=MenuSelectionManager.defaultManager();
    if (chatRightMenu.isVisible()) {
      chatRightMenu.setVisible(false);
    }
 else     if (writePanelRightMenu.isVisible()) {
      writePanelRightMenu.setVisible(false);
    }
 else     if (selectedMenu != null || getCurrentChatPanel().getChatWritePanel().getEditTextToolBar().hasSelectedMenus()) {
      menuSelectionManager.clearSelectedPath();
    }
 else {
      mainFrame.getChatWindowManager().closeChat(chatPanel);
    }
  }
 else {
    mainFrame.getChatWindowManager().closeWindow(this);
  }
}
