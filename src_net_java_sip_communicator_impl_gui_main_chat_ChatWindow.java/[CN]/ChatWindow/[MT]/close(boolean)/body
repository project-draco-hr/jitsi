{
  if (isEscaped) {
    ChatPanel chatPanel=getCurrentChat();
    ChatRightButtonMenu chatRightMenu=chatPanel.getChatConversationPanel().getRightButtonMenu();
    ChatWritePanel chatWritePanel=chatPanel.getChatWritePanel();
    WritePanelRightButtonMenu writePanelRightMenu=chatWritePanel.getRightButtonMenu();
    if (chatRightMenu.isVisible()) {
      chatRightMenu.setVisible(false);
    }
 else     if (writePanelRightMenu.isVisible()) {
      writePanelRightMenu.setVisible(false);
    }
 else     if ((menuBar.getSelectedMenu() != null) || chatWritePanel.getEditTextToolBar().hasSelectedMenus()) {
      MenuSelectionManager.defaultManager().clearSelectedPath();
    }
 else {
      GuiActivator.getUIService().getChatWindowManager().closeChat(chatPanel);
    }
  }
 else {
    GuiActivator.getUIService().getChatWindowManager().closeAllChats(this,true);
  }
}
