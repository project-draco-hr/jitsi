{
  if (!ConfigurationManager.isWindowDecorated()) {
    this.setUndecorated(true);
  }
  this.addWindowFocusListener(this);
  this.setHierarchicallyOpaque(false);
  this.setDefaultCloseOperation(JFrame.DO_NOTHING_ON_CLOSE);
  if (ConfigurationManager.isMultiChatWindowEnabled()) {
    chatTabbedPane=new ChatTabbedPane();
    chatTabbedPane.addCloseListener(new CloseListener(){
      public void closeOperation(      MouseEvent e){
        int tabIndex=chatTabbedPane.getOverTabIndex();
        ChatPanel chatPanel=(ChatPanel)chatTabbedPane.getComponentAt(tabIndex);
        GuiActivator.getUIService().getChatWindowManager().closeChat(chatPanel);
      }
    }
);
    chatTabbedPane.addChangeListener(new ChangeListener(){
      public void stateChanged(      ChangeEvent evt){
        removeNonReadChatState();
      }
    }
);
  }
  menuBar=new MessageWindowMenuBar(this);
  this.setJMenuBar(menuBar);
  boolean isToolBarExtended=Boolean.parseBoolean(GuiActivator.getResources().getSettingsString("impl.gui.IS_CHAT_TOOLBAR_EXTENDED"));
  if (isToolBarExtended)   mainToolBar=new ExtendedMainToolBar(this);
 else   mainToolBar=new MainToolBar(this);
  boolean chatToolbarVisible=ConfigurationManager.isChatToolbarVisible();
  northPanel.setVisible(chatToolbarVisible);
  northPanel.setBorder(BorderFactory.createEmptyBorder(3,0,3,0));
  northPanel.add(mainToolBar,BorderLayout.CENTER);
  northPanel.add(contactPhotoPanel,BorderLayout.EAST);
  this.mainPanel.add(northPanel,BorderLayout.NORTH);
  this.getContentPane().add(mainPanel,BorderLayout.CENTER);
  this.getContentPane().add(statusBarPanel,BorderLayout.SOUTH);
  this.initPluginComponents();
  this.setKeybindingInput(KeybindingSet.Category.CHAT);
  this.addKeybindingAction("chat-nextTab",new ForwardTabAction());
  this.addKeybindingAction("chat-previousTab",new BackwordTabAction());
  this.addKeybindingAction("chat-copy",new CopyAction());
  this.addKeybindingAction("chat-paste",new PasteAction());
  this.addKeybindingAction("chat-openSmileys",new OpenSmileyAction());
  this.addKeybindingAction("chat-openHistory",new OpenHistoryAction());
  this.addKeybindingAction("chat-close",new CloseAction());
  String osName=System.getProperty("os.name");
  if (osName.startsWith("Mac")) {
    this.getRootPane().getInputMap(JComponent.WHEN_ANCESTOR_OF_FOCUSED_COMPONENT).put(KeyStroke.getKeyStroke(KeyEvent.VK_W,InputEvent.META_DOWN_MASK),"chat-close");
  }
  this.addWindowListener(new ChatWindowAdapter());
  int width=GuiActivator.getResources().getSettingsInt("impl.gui.CHAT_WINDOW_WIDTH");
  int height=GuiActivator.getResources().getSettingsInt("impl.gui.CHAT_WINDOW_HEIGHT");
  this.setSize(width,height);
}
