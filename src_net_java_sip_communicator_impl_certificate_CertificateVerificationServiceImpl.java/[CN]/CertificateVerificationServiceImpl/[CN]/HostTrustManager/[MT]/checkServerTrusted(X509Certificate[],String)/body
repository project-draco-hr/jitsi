{
  if (CertificateVerificationActivator.getConfigurationService().getBoolean(CertificateVerificationService.ALWAYS_TRUST_MODE_ENABLED_PROP_NAME,false)) {
    return;
  }
  try {
    tm.checkServerTrusted(chain,authType);
  }
 catch (  CertificateException certificateException) {
    KeyStore kStore=getKeyStore();
    if (kStore == null)     throw certificateException;
    try {
      for (int i=0; i < chain.length; i++) {
        X509Certificate c=chain[i];
        if (temporalyAllowed.contains(c)) {
          return;
        }
        String alias=kStore.getCertificateAlias(c);
        if (alias != null) {
          return;
        }
      }
      if (verify(chain,address,port) == CertificateVerificationService.DO_NOT_TRUST) {
        throw certificateException;
      }
    }
 catch (    Throwable e) {
      logger.error("Error trying to " + "show certificate to user",e);
      throw certificateException;
    }
  }
}
