{
  KeyStore kStore=getKeyStore();
  if (kStore == null)   throw certificateException;
  try {
    for (int i=0; i < chain.length; i++) {
      X509Certificate c=chain[i];
      if (temporalyAllowed.contains(c)) {
        return;
      }
      String alias=kStore.getCertificateAlias(c);
      if (alias != null) {
        return;
      }
    }
    if (verify(chain,message) == CertificateVerificationService.DO_NOT_TRUST) {
      throw certificateException;
    }
  }
 catch (  Throwable e) {
    logger.error("Error trying to " + "show certificate to user",e);
    throw certificateException;
  }
}
