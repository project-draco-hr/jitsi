{
  metaContact.addDetail("mobile",phoneNumber);
  try {
    smsOpSet.sendSmsMessage(phoneNumber,message);
  }
 catch (  IllegalStateException ex) {
    logger.error("Failed to send SMS.",ex);
    chatPanel.refreshWriteArea();
    chatPanel.processMessage(phoneNumber,new Date(System.currentTimeMillis()),Constants.OUTGOING_MESSAGE,message.getContent(),message.getContentType());
    chatPanel.processMessage(phoneNumber,new Date(System.currentTimeMillis()),Constants.ERROR_MESSAGE,Messages.getI18NString("msgSendConnectionProblem").getText(),"text");
  }
catch (  Exception ex) {
    logger.error("Failed to send SMS.",ex);
    chatPanel.refreshWriteArea();
    chatPanel.processMessage(phoneNumber,new Date(System.currentTimeMillis()),Constants.OUTGOING_MESSAGE,message.getContent(),message.getContentType());
    chatPanel.processMessage(phoneNumber,new Date(System.currentTimeMillis()),Constants.ERROR_MESSAGE,Messages.getI18NString("msgDeliveryInternalError").getText(),"text");
  }
  this.dispose();
}
