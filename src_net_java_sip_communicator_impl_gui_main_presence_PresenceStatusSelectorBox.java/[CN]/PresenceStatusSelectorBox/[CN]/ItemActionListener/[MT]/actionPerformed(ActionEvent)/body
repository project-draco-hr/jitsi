{
  if (e.getSource() instanceof JMenuItem) {
    JMenuItem menuItem=(JMenuItem)e.getSource();
    LoginManager loginManager=mainFrame.getLoginManager();
    Iterator statusSet=presence.getSupportedStatusSet();
    while (statusSet.hasNext()) {
      PresenceStatus status=((PresenceStatus)statusSet.next());
      if (status.getStatusName().equals(menuItem.getText()) && !presence.getPresenceStatus().equals(status)) {
        if (protocolProvider.getRegistrationState() == RegistrationState.REGISTERED) {
          if (status.isOnline()) {
            new PublishPresenceStatusThread(status).start();
          }
 else {
            loginManager.setManuallyDisconnected(true);
            loginManager.logoff(protocolProvider);
          }
          setSelectedStatus(status);
        }
 else         if (protocolProvider.getRegistrationState() != RegistrationState.REGISTERED && protocolProvider.getRegistrationState() != RegistrationState.REGISTERING && protocolProvider.getRegistrationState() != RegistrationState.AUTHENTICATING && status.isOnline()) {
          lastSelectedStatus=status;
          loginManager.login(protocolProvider);
        }
 else {
          if (!status.isOnline() && !(protocolProvider.getRegistrationState() == RegistrationState.UNREGISTERING)) {
            loginManager.setManuallyDisconnected(true);
            loginManager.logoff(protocolProvider);
            setSelectedStatus(status);
          }
        }
        mainFrame.saveStatusInformation(protocolProvider,status.getStatusName());
        break;
      }
    }
  }
}
