{
  PresenceStatus status=(PresenceStatus)presenceStatus;
  OperationSetPresence presence=mainFrame.getProtocolPresence(protocolProvider);
  logger.trace("Update status for provider: " + protocolProvider.getAccountID().getAccountAddress() + ". The new status will be: "+ status.getStatusName());
  if (connecting.isRunning()) {
    logger.trace("Stop the connecting icon for provider: " + protocolProvider.getAccountID().getAccountAddress());
    this.connecting.stop();
  }
  this.setSelectedStatus(status);
  if (protocolProvider.isRegistered()) {
    try {
      presence.publishPresenceStatus(status,"");
    }
 catch (    IllegalArgumentException e1) {
      logger.error("Error - changing status",e1);
    }
catch (    IllegalStateException e1) {
      logger.error("Error - changing status",e1);
    }
catch (    OperationFailedException e1) {
      String accountUserID=protocolProvider.getAccountID().getUserID();
      String accountServerName=protocolProvider.getAccountID().getService();
      if (e1.getErrorCode() == OperationFailedException.GENERAL_ERROR) {
        String msgText=Messages.getI18NString("statusChangeGeneralError",new String[]{accountUserID,accountServerName}).getText();
        new ErrorDialog(null,msgText,e1,Messages.getI18NString("generalError").getText()).showDialog();
      }
 else       if (e1.getErrorCode() == OperationFailedException.NETWORK_FAILURE) {
        String msgText=Messages.getI18NString("statusChangeNetworkFailure",new String[]{accountUserID,accountServerName}).getText();
        new ErrorDialog(null,msgText,e1,Messages.getI18NString("networkFailure").getText()).showDialog();
      }
 else       if (e1.getErrorCode() == OperationFailedException.PROVIDER_NOT_REGISTERED) {
        String msgText=Messages.getI18NString("statusChangeNetworkFailure",new String[]{accountUserID,accountServerName}).getText();
        new ErrorDialog(null,msgText,e1,Messages.getI18NString("networkFailure").getText()).showDialog();
      }
      logger.error("Error - changing status",e1);
    }
  }
}
