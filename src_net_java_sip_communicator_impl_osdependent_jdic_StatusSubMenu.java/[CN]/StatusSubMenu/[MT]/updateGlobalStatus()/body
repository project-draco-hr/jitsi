{
  int status=0;
  for (  ProtocolProviderService protocolProvider : getProtocolProviders()) {
    boolean isProtocolHidden=protocolProvider.getAccountID().getAccountProperty(ProtocolProviderFactory.IS_PROTOCOL_HIDDEN) != null;
    if (isProtocolHidden)     continue;
    if (!protocolProvider.isRegistered())     continue;
    OperationSetPresence presence=protocolProvider.getOperationSet(OperationSetPresence.class);
    if (presence == null && ignoreNonPresenceOpSetProtocols)     continue;
    int presenceStatus=(presence == null) ? PresenceStatus.AVAILABLE_THRESHOLD : presence.getPresenceStatus().getStatus();
    if (status < presenceStatus)     status=presenceStatus;
  }
  selectItemFromStatus(status);
}
