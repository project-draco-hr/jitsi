{
  Format format=super.getFormat(streamIndex,oldValue);
  if (format instanceof VideoFormat) {
    VideoFormat videoFormat=(VideoFormat)format;
    Dimension size=videoFormat.getSize();
    if (size == null) {
      QTFormatDescription[] formatDescriptions=device.formatDescriptions();
      if ((formatDescriptions != null) && (streamIndex < formatDescriptions.length)) {
        size=formatDescriptions[streamIndex].sizeForKey(QTFormatDescription.VideoEncodedPixelsSizeAttribute);
        if (size != null) {
          if ((size.width < DEFAULT_WIDTH) && (size.height < DEFAULT_HEIGHT)) {
            double ratio=size.height / (double)size.width;
            size.width=DEFAULT_WIDTH;
            size.height=(int)(size.width * ratio);
          }
          format=format.intersects(new VideoFormat(format.getEncoding(),size,videoFormat.getMaxDataLength(),format.getDataType(),videoFormat.getFrameRate()));
        }
      }
    }
  }
  return format;
}
