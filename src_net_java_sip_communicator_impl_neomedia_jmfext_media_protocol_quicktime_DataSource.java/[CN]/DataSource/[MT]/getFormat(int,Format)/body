{
  Format format=super.getFormat(streamIndex,oldValue);
  if (format instanceof VideoFormat) {
    VideoFormat videoFormat=(VideoFormat)format;
    Dimension size=videoFormat.getSize();
    if (size == null) {
      QTFormatDescription[] formatDescriptions=device.formatDescriptions();
      if ((formatDescriptions != null) && (streamIndex < formatDescriptions.length)) {
        size=formatDescriptions[streamIndex].sizeForKey(QTFormatDescription.VideoEncodedPixelsSizeAttribute);
        if (size != null)         format=format.intersects(new VideoFormat(format.getEncoding(),size,videoFormat.getMaxDataLength(),format.getDataType(),videoFormat.getFrameRate()));
      }
    }
  }
  return format;
}
