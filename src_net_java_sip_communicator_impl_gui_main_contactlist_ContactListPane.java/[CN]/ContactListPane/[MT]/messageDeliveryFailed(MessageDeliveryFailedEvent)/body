{
  logger.error(evt.getReason());
  String errorMsg=null;
  Message sourceMessage=(Message)evt.getSource();
  Contact sourceContact=evt.getDestinationContact();
  MetaContact metaContact=mainFrame.getContactList().findMetaContactByContact(sourceContact);
  if (evt.getErrorCode() == MessageDeliveryFailedEvent.OFFLINE_MESSAGES_NOT_SUPPORTED) {
    errorMsg=GuiActivator.getResources().getI18NString("service.gui.MSG_DELIVERY_NOT_SUPPORTED");
  }
 else   if (evt.getErrorCode() == MessageDeliveryFailedEvent.NETWORK_FAILURE) {
    errorMsg=GuiActivator.getResources().getI18NString("service.gui.MSG_NOT_DELIVERED",new String[]{evt.getReason()});
  }
 else   if (evt.getErrorCode() == MessageDeliveryFailedEvent.PROVIDER_NOT_REGISTERED) {
    errorMsg=GuiActivator.getResources().getI18NString("service.gui.MSG_SEND_CONNECTION_PROBLEM");
  }
 else   if (evt.getErrorCode() == MessageDeliveryFailedEvent.INTERNAL_ERROR) {
    errorMsg=GuiActivator.getResources().getI18NString("service.gui.MSG_DELIVERY_INTERNAL_ERROR",new String[]{evt.getReason()});
  }
 else {
    errorMsg=GuiActivator.getResources().getI18NString("service.gui.MSG_DELIVERY_UNKNOWN_ERROR",new String[]{evt.getReason()});
  }
  ChatPanel chatPanel=chatWindowManager.getContactChat(metaContact,sourceContact);
  chatPanel.addMessage(metaContact.getDisplayName(),System.currentTimeMillis(),Chat.OUTGOING_MESSAGE,sourceMessage.getContent(),sourceMessage.getContentType());
  chatPanel.addErrorMessage(metaContact.getDisplayName(),errorMsg);
  chatWindowManager.openChat(chatPanel,false);
}
