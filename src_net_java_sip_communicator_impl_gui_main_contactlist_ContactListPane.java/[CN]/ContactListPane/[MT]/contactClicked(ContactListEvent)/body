{
  MetaContact metaContact=evt.getSourceContact();
  Contact defaultContact=metaContact.getDefaultContact();
  ProtocolProviderService defaultProvider=defaultContact.getProtocolProvider();
  OperationSetBasicInstantMessaging defaultIM=defaultProvider.getOperationSet(OperationSetBasicInstantMessaging.class);
  ProtocolProviderService protoContactProvider;
  OperationSetBasicInstantMessaging protoContactIM;
  boolean isOfflineMessagingSupported=defaultIM != null && !defaultIM.isOfflineMessagingSupported();
  if (defaultContact.getPresenceStatus().getStatus() < 1 && (!isOfflineMessagingSupported || !defaultProvider.isRegistered())) {
    Iterator<Contact> protoContacts=metaContact.getContacts();
    while (protoContacts.hasNext()) {
      Contact contact=protoContacts.next();
      protoContactProvider=contact.getProtocolProvider();
      protoContactIM=protoContactProvider.getOperationSet(OperationSetBasicInstantMessaging.class);
      if (protoContactIM != null && protoContactIM.isOfflineMessagingSupported() && protoContactProvider.isRegistered()) {
        defaultContact=contact;
      }
    }
  }
  ContactEventHandler contactHandler=mainFrame.getContactHandler(defaultContact.getProtocolProvider());
  contactHandler.contactClicked(defaultContact,evt.getClickCount());
}
