{
  logger.debug("Adding protocol provider " + provider.getProtocolName());
  OperationSetBasicInstantMessaging opSetIm=(OperationSetBasicInstantMessaging)provider.getSupportedOperationSets().get(OperationSetBasicInstantMessaging.class.getName());
  if (opSetIm != null) {
    opSetIm.addMessageListener(this);
  }
 else {
    logger.trace("Service did not have a im op. set.");
  }
  OperationSetSmsMessaging opSetSms=(OperationSetSmsMessaging)provider.getSupportedOperationSets().get(OperationSetSmsMessaging.class.getName());
  if (opSetSms != null) {
    opSetSms.addMessageListener(this);
  }
 else {
    logger.trace("Service did not have a sms op. set.");
  }
  OperationSetMultiUserChat opSetMultiUChat=(OperationSetMultiUserChat)provider.getSupportedOperationSets().get(OperationSetMultiUserChat.class.getName());
  if (opSetMultiUChat != null) {
    Iterator iter=opSetMultiUChat.getCurrentlyJoinedChatRooms().iterator();
    while (iter.hasNext()) {
      ChatRoom room=(ChatRoom)iter.next();
      room.addMessageListener(this);
    }
    opSetMultiUChat.addPresenceListener(this);
  }
 else {
    logger.trace("Service did not have a multi im op. set.");
  }
}
