{
  String locationStr=MailboxActivator.getConfigurationService().getString(Mailbox.INCOMING_MESSAGE_PROPERTY_NAME);
  if (locationStr != null) {
    File location=new File(locationStr);
    if (location.canWrite() && location.isDirectory()) {
      return location;
    }
  }
  try {
    return MailboxActivator.getFileAccessService().getPrivatePersistentDirectory(DEFAULT_INCOMING_MSG_DIR_NAME);
  }
 catch (  Exception ex) {
    logger.error("Failed to create a private directory.",ex);
    return new File(MailboxActivator.getConfigurationService().getScHomeDirLocation() + File.separator + DEFAULT_INCOMING_MSG_DIR_NAME);
  }
}
