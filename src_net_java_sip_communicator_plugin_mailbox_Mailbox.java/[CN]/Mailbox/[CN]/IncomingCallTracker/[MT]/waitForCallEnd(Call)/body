{
  double timeToWaitBeforeHangup=System.currentTimeMillis() + getMaxMessageDuration() + MailboxActivator.getMediaService().getDataSourceDurationSeconds(call) * 1000;
  while (call.getCallState() != CallState.CALL_ENDED) {
    if (System.currentTimeMillis() < timeToWaitBeforeHangup) {
      try {
        Thread.sleep(100);
      }
 catch (      InterruptedException exc) {
        logger.error("mailbox sleep was interrupted:\n" + exc,exc);
      }
    }
  }
}
