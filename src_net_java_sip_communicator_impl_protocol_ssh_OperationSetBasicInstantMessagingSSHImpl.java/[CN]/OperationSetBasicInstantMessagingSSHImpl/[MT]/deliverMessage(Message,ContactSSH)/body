{
  String userID=to.getAddress();
  if (userID.equals(this.parentProvider.getAccountID().getUserID())) {
    String sourceUserID=to.getProtocolProvider().getAccountID().getUserID();
    Contact from=opSetPersPresence.findContactByID(sourceUserID);
    if (from == null) {
      from=opSetPersPresence.createVolatileContact(sourceUserID);
    }
    fireMessageReceived(message,from);
  }
 else {
    ProtocolProviderServiceSSHImpl sshProvider=this.opSetPersPresence.findProviderForSSHUserID(userID);
    if (sshProvider != null) {
      OperationSetBasicInstantMessagingSSHImpl opSetIM=(OperationSetBasicInstantMessagingSSHImpl)sshProvider.getOperationSet(OperationSetBasicInstantMessaging.class);
      opSetIM.deliverMessage(message,to);
    }
 else {
      fireMessageReceived(message,to);
    }
  }
}
