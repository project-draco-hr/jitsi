{
  if (!HTML_CONTENT_TYPE.equals(contentType)) {
    boolean processHTMLChars;
    if ((keyword != null) && (keyword.length() != 0)) {
      String messageWithProcessedKeyword=processKeyword(message,contentType,keyword);
      processHTMLChars=(messageWithProcessedKeyword == message);
      message=messageWithProcessedKeyword;
    }
 else     processHTMLChars=true;
    message=processNewLines(processLinksAndHTMLChars(message,processHTMLChars));
  }
 else {
    if ((keyword != null) && (keyword.length() != 0))     message=processKeyword(message,contentType,keyword);
    message=processImgTags(processBrTags(message));
  }
  return processSmileys(message,contentType);
}
