{
  Call call=callEvent.getSourceCall();
  ProtocolProviderService provider=call.getProtocolProvider();
switch (type) {
case CallEvent.CALL_ENDED:
    removeCallListener(call);
  break;
case CallEvent.CALL_INITIATED:
case CallEvent.CALL_RECEIVED:
if (type == CallEvent.CALL_RECEIVED && CallState.CALL_INITIALIZATION.equals(call.getCallState()) && ProtocolProviderActivator.getConfigurationService().getBoolean(PNAME_CALL_WAITING_DISABLED,false)) {
synchronized (calls) {
    for (    Call otherCall : calls) {
      if (!call.equals(otherCall) && CallState.CALL_IN_PROGRESS.equals(otherCall.getCallState())) {
        rejectCallWithBusyHere(call);
        return;
      }
    }
  }
}
if (type == CallEvent.CALL_RECEIVED && CallState.CALL_INITIALIZATION.equals(call.getCallState()) && (ProtocolProviderActivator.getConfigurationService().getBoolean(PNAME_REJECT_IN_CALL_ON_DND,false) || provider.getAccountID().getAccountPropertyBoolean(ACCOUNT_PROPERTY_REJECT_IN_CALL_ON_DND,false))) {
OperationSetPresence presence=provider.getOperationSet(OperationSetPresence.class);
if (presence == null) {
  OperationSetCusaxUtils cusaxOpSet=provider.getOperationSet(OperationSetCusaxUtils.class);
  if (cusaxOpSet != null) {
    ProtocolProviderService linkedCusaxProvider=cusaxOpSet.getLinkedCusaxProvider();
    if (linkedCusaxProvider != null) {
      presence=linkedCusaxProvider.getOperationSet(OperationSetPresence.class);
    }
  }
}
if (presence != null) {
  int presenceStatus=(presence == null) ? PresenceStatus.AVAILABLE_THRESHOLD : presence.getPresenceStatus().getStatus();
  if (presenceStatus > PresenceStatus.ONLINE_THRESHOLD && presenceStatus <= PresenceStatus.EXTENDED_AWAY_THRESHOLD) {
    rejectCallWithBusyHere(call);
    return;
  }
}
}
addCallListener(call);
break;
}
}
