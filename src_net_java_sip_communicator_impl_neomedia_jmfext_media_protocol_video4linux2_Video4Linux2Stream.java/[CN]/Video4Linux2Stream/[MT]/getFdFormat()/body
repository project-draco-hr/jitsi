{
  Format format=null;
  if (-1 != fd) {
    long v4l2_format=Video4Linux2.v4l2_format_alloc(Video4Linux2.V4L2_BUF_TYPE_VIDEO_CAPTURE);
    if (v4l2_format == 0)     throw new OutOfMemoryError("v4l2_format_alloc");
 else {
      try {
        if (Video4Linux2.ioctl(fd,Video4Linux2.VIDIOC_G_FMT,v4l2_format) != -1) {
          long fmtPix=Video4Linux2.v4l2_format_getFmtPix(v4l2_format);
          int pixelformat=Video4Linux2.v4l2_pix_format_getPixelformat(fmtPix);
          int ffmpegPixFmt=DataSource.getFFmpegPixFmt(pixelformat);
          if (FFmpeg.PIX_FMT_NONE != ffmpegPixFmt) {
            int width=Video4Linux2.v4l2_pix_format_getWidth(fmtPix);
            int height=Video4Linux2.v4l2_pix_format_getHeight(fmtPix);
            format=new AVFrameFormat(new Dimension(width,height),Format.NOT_SPECIFIED,ffmpegPixFmt,pixelformat);
          }
        }
      }
  finally {
        Video4Linux2.free(v4l2_format);
      }
    }
  }
  return format;
}
