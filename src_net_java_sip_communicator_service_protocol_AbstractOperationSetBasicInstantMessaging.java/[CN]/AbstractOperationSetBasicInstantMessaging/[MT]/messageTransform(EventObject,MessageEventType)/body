{
  ProtocolProviderService protocolProvider;
switch (eventType) {
case MessageDelivered:
    protocolProvider=((MessageDeliveredEvent)evt).getDestinationContact().getProtocolProvider();
  break;
case MessageDeliveryFailed:
protocolProvider=((MessageDeliveryFailedEvent)evt).getDestinationContact().getProtocolProvider();
break;
case MessageDeliveryPending:
protocolProvider=((MessageDeliveredEvent)evt).getDestinationContact().getProtocolProvider();
break;
case MessageReceived:
protocolProvider=((MessageReceivedEvent)evt).getSourceContact().getProtocolProvider();
break;
default :
return evt;
}
OperationSetInstantMessageTransformImpl opSetMessageTransform=(OperationSetInstantMessageTransformImpl)protocolProvider.getOperationSet(OperationSetInstantMessageTransform.class);
if (opSetMessageTransform == null) return evt;
for (Map.Entry<Integer,Vector<TransformLayer>> entry : opSetMessageTransform.transformLayers.entrySet()) {
for (TransformLayer transformLayer : entry.getValue()) {
if (evt != null) {
switch (eventType) {
case MessageDelivered:
evt=transformLayer.messageDelivered((MessageDeliveredEvent)evt);
break;
case MessageDeliveryPending:
evt=transformLayer.messageDeliveryPending((MessageDeliveredEvent)evt);
break;
case MessageDeliveryFailed:
evt=transformLayer.messageDeliveryFailed((MessageDeliveryFailedEvent)evt);
break;
case MessageReceived:
evt=transformLayer.messageReceived((MessageReceivedEvent)evt);
break;
default :
break;
}
}
}
}
return evt;
}
