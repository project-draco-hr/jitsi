{
  boolean loaded=false;
  if (loadLastFile) {
    Iterator files=historyImpl.getFileList();
    String file=null;
    while (files.hasNext()) {
      file=(String)files.next();
    }
    if (file != null) {
      this.currentDoc=this.historyImpl.getDocumentForFile(file);
      this.currentFile=file;
      loaded=true;
    }
  }
  if (!loaded) {
    this.currentFile=Long.toString(date.getTime());
    while (this.currentFile.length() < 8) {
      this.currentFile="0" + this.currentFile;
    }
    this.currentFile+=".xml";
    this.currentDoc=this.historyImpl.createDocument(this.currentFile);
  }
  Assert.assertNonNull(this.currentDoc,"There should be a current document created.");
  this.currentDocElements=this.currentDoc.getFirstChild().getChildNodes().getLength();
}
