{
  Format format;
  if (this.format == null) {
    format=getCaptureOutputFormat();
    if (format == null)     format=super.doGetFormat();
 else {
      VideoFormat videoFormat=(VideoFormat)format;
      if (videoFormat.getSize() != null)       this.format=format;
 else {
        Dimension defaultSize=NeomediaActivator.getMediaServiceImpl().getDeviceConfiguration().getVideoSize();
        format=videoFormat.intersects(new VideoFormat(null,new Dimension(defaultSize.width,defaultSize.height),Format.NOT_SPECIFIED,Format.byteArray,Format.NOT_SPECIFIED));
      }
    }
  }
 else   format=this.format;
  return format;
}
