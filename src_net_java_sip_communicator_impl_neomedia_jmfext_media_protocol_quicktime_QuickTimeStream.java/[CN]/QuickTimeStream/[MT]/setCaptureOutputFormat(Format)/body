{
  VideoFormat videoFormat=(VideoFormat)format;
  Dimension size=videoFormat.getSize();
  int width;
  int height;
  if (size == null) {
    width=DataSource.DEFAULT_WIDTH;
    height=DataSource.DEFAULT_HEIGHT;
  }
 else {
    width=size.width;
    height=size.height;
  }
  NSMutableDictionary pixelBufferAttributes=null;
  if ((width > 0) && (height > 0)) {
    if (pixelBufferAttributes == null)     pixelBufferAttributes=new NSMutableDictionary();
    pixelBufferAttributes.setIntForKey(width,CVPixelBufferAttributeKey.kCVPixelBufferWidthKey);
    pixelBufferAttributes.setIntForKey(height,CVPixelBufferAttributeKey.kCVPixelBufferHeightKey);
  }
  String encoding;
  if (format instanceof AVFrameFormat) {
    int pixFmt=((AVFrameFormat)format).getPixFmt();
    if (pixFmt == FFmpeg.PIX_FMT_YUV420P)     encoding=VideoFormat.YUV;
 else     if (pixFmt == FFmpeg.PIX_FMT_ARGB)     encoding=VideoFormat.RGB;
 else     encoding=null;
  }
 else   if (format.isSameEncoding(VideoFormat.RGB))   encoding=VideoFormat.RGB;
 else   if (format.isSameEncoding(VideoFormat.YUV))   encoding=VideoFormat.YUV;
 else   encoding=null;
  if (VideoFormat.RGB.equalsIgnoreCase(encoding)) {
    if (pixelBufferAttributes == null)     pixelBufferAttributes=new NSMutableDictionary();
    pixelBufferAttributes.setIntForKey(CVPixelFormatType.kCVPixelFormatType_32ARGB,CVPixelBufferAttributeKey.kCVPixelBufferPixelFormatTypeKey);
  }
 else   if (VideoFormat.YUV.equalsIgnoreCase(encoding)) {
    if (pixelBufferAttributes == null)     pixelBufferAttributes=new NSMutableDictionary();
    pixelBufferAttributes.setIntForKey(CVPixelFormatType.kCVPixelFormatType_420YpCbCr8Planar,CVPixelBufferAttributeKey.kCVPixelBufferPixelFormatTypeKey);
  }
 else   throw new IllegalArgumentException("format");
  if (pixelBufferAttributes != null) {
    captureOutput.setPixelBufferAttributes(pixelBufferAttributes);
    captureOutputFormat=videoFormat;
  }
}
