{
  NetworkAddressManagerService nam=SipActivator.getNetworkAddressManagerService();
  InetAddress intendedDestination=peer.getProtocolProvider().getIntendedDestination(peer.getPeerAddress());
  InetAddress localHostForPeer=nam.getLocalHost(intendedDestination);
  initializePortNumbers();
  DatagramSocket rtpSocket=null;
  try {
    rtpSocket=nam.createDatagramSocket(localHostForPeer,nextMediaPortToTry,minMediaPort,maxMediaPort);
  }
 catch (  Exception exc) {
    ProtocolProviderServiceSipImpl.throwOperationFailedException("Failed to allocate the network ports necessary for the call.",OperationFailedException.INTERNAL_ERROR,exc,logger);
  }
  nextMediaPortToTry=rtpSocket.getLocalPort() + 1;
  DatagramSocket rtcpSocket=null;
  try {
    rtcpSocket=nam.createDatagramSocket(localHostForPeer,nextMediaPortToTry,minMediaPort,maxMediaPort);
  }
 catch (  Exception exc) {
    ProtocolProviderServiceSipImpl.throwOperationFailedException("Failed to allocate the network ports necessary for the call.",OperationFailedException.INTERNAL_ERROR,exc,logger);
  }
  nextMediaPortToTry=rtcpSocket.getLocalPort() + 1;
  if (nextMediaPortToTry > maxMediaPort - 1)   nextMediaPortToTry=minMediaPort;
  DefaultStreamConnector connector=new DefaultStreamConnector(rtpSocket,rtcpSocket);
  return connector;
}
