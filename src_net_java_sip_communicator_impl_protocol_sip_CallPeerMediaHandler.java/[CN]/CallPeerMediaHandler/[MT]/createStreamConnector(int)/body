{
  NetworkAddressManagerService nam=SipActivator.getNetworkAddressManagerService();
  InetAddress intendedDestination=peer.getProtocolProvider().getIntendedDestination(peer.getPeerAddress());
  InetAddress localHostForPeer=nam.getLocalHost(intendedDestination);
  initializePortNumbers();
  DatagramSocket rtpSocket=null;
  try {
    rtpSocket=nam.createDatagramSocket(localHostForPeer,preferredRtpPort,minMediaPort,maxMediaPort);
  }
 catch (  Exception exc) {
    ProtocolProviderServiceSipImpl.throwOperationFailedException("Failed to allocate the network ports necessary for the call.",OperationFailedException.INTERNAL_ERROR,exc,logger);
  }
  int rtpPort=rtpSocket.getLocalPort();
  DatagramSocket rtcpSocket=null;
  try {
    rtcpSocket=nam.createDatagramSocket(localHostForPeer,rtpPort + 1,minMediaPort,maxMediaPort);
  }
 catch (  Exception exc) {
    ProtocolProviderServiceSipImpl.throwOperationFailedException("Failed to allocate the network ports necessary for the call.",OperationFailedException.INTERNAL_ERROR,exc,logger);
  }
  DefaultStreamConnector connector=new DefaultStreamConnector(rtpSocket,rtcpSocket);
  return connector;
}
