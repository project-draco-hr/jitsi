{
  registerDynamicPTsWithStream(stream);
  registerRTPExtensionsWithStream(stream);
  stream.setDevice(device);
  stream.setTarget(target);
  stream.setDirection(direction);
  stream.setFormat(format);
  if (stream instanceof AudioMediaStream) {
    setAudioStream((AudioMediaStream)stream);
    registerAudioLevelListeners(audioStream);
  }
 else   setVideoStream((VideoMediaStream)stream);
  if (peer.getCall().isDefaultEncrypted()) {
    ZrtpControl zrtpControl=stream.getZrtpControl();
    zrtpControl.setZrtpListener(peer);
    zrtpControl.start(stream instanceof AudioMediaStream);
  }
  if (!stream.isStarted())   stream.start();
  if (stream instanceof VideoMediaStream) {
    logger.info("Try to open port on NAT if any");
    try {
      videoStreamConnector.getDataSocket().send(new DatagramPacket(new byte[0],0,target.getDataAddress().getAddress(),target.getDataAddress().getPort()));
    }
 catch (    Exception e) {
      logger.error("Error cannot send to remote peer",e);
    }
  }
  return stream;
}
