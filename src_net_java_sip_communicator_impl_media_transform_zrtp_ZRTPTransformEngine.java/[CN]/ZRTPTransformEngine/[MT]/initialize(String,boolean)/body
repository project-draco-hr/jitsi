{
  BundleContext bc=MediaActivator.getBundleContext();
  ServiceReference faServiceReference=bc.getServiceReference(FileAccessService.class.getName());
  FileAccessService faService=(FileAccessService)bc.getService(faServiceReference);
  File file=null;
  try {
    file=faService.getPrivatePersistentFile(zidFilename);
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
  String zidFilePath=null;
  try {
    zidFilePath=file.getAbsolutePath();
  }
 catch (  SecurityException e) {
    e.printStackTrace();
  }
  if (cryptoProvider == null) {
    return false;
  }
  ZidFile zf=ZidFile.getInstance();
  if (!zf.isOpen()) {
    String fname;
    if (zidFilePath == null) {
      String home=System.getenv("HOME");
      String baseDir=(home != null) ? ((home) + ("/.")) : ".";
      fname=baseDir + "GNUZRTP4J.zid";
      zidFilename=fname;
    }
 else {
      zidFilename=zidFilePath;
    }
    if (zf.open(zidFilename) < 0) {
      return false;
    }
  }
  try {
    zrtpEngine=new ZRtp(zf.getZid(),this,clientIdString,cryptoProvider);
  }
 catch (  GeneralSecurityException e) {
    e.printStackTrace();
    return false;
  }
  if (timeoutProvider == null) {
    timeoutProvider=new TimeoutProvider("ZRTP");
    timeoutProvider.setDaemon(true);
    timeoutProvider.start();
  }
  userCallback.init();
  enableZrtp=autoEnable;
  return true;
}
