{
  ImageIcon statusIcon;
  OperationSetPresence presence=(OperationSetPresence)pps.getOperationSet(OperationSetPresence.class);
  Image statusImage;
  if (presence != null) {
    statusImage=ImageLoader.getBytesInImage(presence.getPresenceStatus().getStatusIcon());
  }
 else {
    statusImage=ImageLoader.getBytesInImage(pps.getProtocolIcon().getIcon(ProtocolIcon.ICON_SIZE_16x16));
    if (!pps.isRegistered()) {
      statusImage=LightGrayFilter.createDisabledImage(statusImage);
    }
  }
  statusIcon=new ImageIcon(badgeImageWithProtocolIndex(statusImage,pps));
  return statusIcon;
}
