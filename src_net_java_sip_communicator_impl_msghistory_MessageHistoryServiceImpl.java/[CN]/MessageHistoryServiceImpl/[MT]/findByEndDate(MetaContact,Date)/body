{
  TreeSet result=new TreeSet(new MessageEventComparator());
  Hashtable readers=getHistoryReaders(contact);
  int recordsCount=countRecords(readers);
  Iterator iter=readers.keySet().iterator();
  while (iter.hasNext()) {
    Contact item=(Contact)iter.next();
    HistoryReader reader=(HistoryReader)readers.get(item);
    addHistorySearchProgressListeners(reader,recordsCount);
    Iterator recs=reader.findByEndDate(endDate);
    while (recs.hasNext()) {
      result.add(convertHistoryRecordToMessageEvent((HistoryRecord)recs.next(),item));
    }
  }
  iter=readers.values().iterator();
  while (iter.hasNext()) {
    HistoryReader item=(HistoryReader)iter.next();
    removeHistorySearchProgressListeners(item);
  }
  return result;
}
