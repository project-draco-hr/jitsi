{
  TreeSet<EventObject> result=new TreeSet<EventObject>(new ChatRoomMessageEventComparator<EventObject>());
  try {
    HistoryReader reader=this.getHistoryForMultiChat(null,room).getReader();
    Iterator<HistoryRecord> recs=reader.findFirstRecordsAfter(date,count);
    while (recs.hasNext()) {
      result.add(convertHistoryRecordToMessageEvent(recs.next(),room));
    }
  }
 catch (  IOException e) {
    logger.error("Could not read history",e);
  }
  LinkedList<EventObject> resultAsList=new LinkedList<EventObject>(result);
  int toIndex=count;
  if (toIndex > resultAsList.size())   toIndex=resultAsList.size();
  return resultAsList.subList(0,toIndex);
}
