{
  TreeSet result=new TreeSet(new ChatRoomMessageEventComparator());
  try {
    HistoryReader reader=this.getHistoryForMultiChat(null,room).getReader();
    Iterator recs=reader.findFirstRecordsAfter(date,count);
    while (recs.hasNext()) {
      result.add(convertHistoryRecordToMessageEvent((HistoryRecord)recs.next(),room));
    }
  }
 catch (  IOException e) {
    logger.error("Could not read history",e);
  }
  return new LinkedList(result).subList(0,count);
}
