{
  MessageImpl msg=new MessageImpl(hr);
  Date timestamp=null;
  if (msg.getMessageReceivedDate() != null) {
    if (msg.getMessageReceivedDate().after(hr.getTimestamp()) && (msg.getMessageReceivedDate().getTime() - hr.getTimestamp().getTime()) > 86400000)     timestamp=hr.getTimestamp();
 else     timestamp=msg.getMessageReceivedDate();
  }
 else   timestamp=hr.getTimestamp();
  if (msg.isOutgoing) {
    return new MessageDeliveredEvent(msg,contact,timestamp);
  }
 else   return new MessageReceivedEvent(msg,contact,timestamp);
}
