{
  MessageImpl msg=createMessageFromHistoryRecord(hr);
  long timestamp;
  long messageReceivedDate=msg.getMessageReceivedDate();
  long hrTimestamp=hr.getTimestamp();
  if (messageReceivedDate != 0) {
    if (messageReceivedDate - hrTimestamp > 86400000)     timestamp=hrTimestamp;
 else     timestamp=msg.getMessageReceivedDate();
  }
 else   timestamp=hrTimestamp;
  if (msg.isOutgoing) {
    return new MessageDeliveredEvent(msg,contact,timestamp);
  }
 else   return new MessageReceivedEvent(msg,contact,timestamp);
}
