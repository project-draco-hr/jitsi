{
  this.bundleContext=bc;
  ServiceReference refConfig=bundleContext.getServiceReference(ConfigurationService.class.getName());
  configService=(ConfigurationService)bundleContext.getService(refConfig);
  String isMessageHistoryEnabledPropertyString="impl.msghistory.IS_MESSAGE_HISTORY_ENABLED";
  String isMessageHistoryEnabledString=configService.getString(isMessageHistoryEnabledPropertyString);
  if (isMessageHistoryEnabledString == null)   isMessageHistoryEnabledString=getResources().getSettingsString(isMessageHistoryEnabledPropertyString);
  if (isMessageHistoryEnabledString == null || isMessageHistoryEnabledString.length() == 0)   return;
  boolean isMessageHistoryEnabled=new Boolean(isMessageHistoryEnabledString).booleanValue();
  if (!isMessageHistoryEnabled)   return;
  msgHistoryPropListener=new MessageHistoryPropertyChangeListener();
  configService.addPropertyChangeListener("impl.msghistory.IS_MESSAGE_HISTORY_ENABLED",msgHistoryPropListener);
  if (logger.isDebugEnabled())   logger.debug("Starting the msg history implementation.");
  this.loadMessageHistoryService();
}
