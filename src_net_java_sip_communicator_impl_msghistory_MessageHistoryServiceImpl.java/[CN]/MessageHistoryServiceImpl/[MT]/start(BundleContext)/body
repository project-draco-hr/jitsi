{
  this.bundleContext=bc;
  ServiceReference refConfig=bundleContext.getServiceReference(ConfigurationService.class.getName());
  configService=(ConfigurationService)bundleContext.getService(refConfig);
  String isMessageHistoryEnabledPropertyString="net.java.sip.communicator.impl.msghistory.isMessageHistoryEnabled";
  String isMessageHistoryEnabledString=configService.getString(isMessageHistoryEnabledPropertyString);
  if (isMessageHistoryEnabledString == null)   isMessageHistoryEnabledString=getResources().getSettingsString(isMessageHistoryEnabledPropertyString);
  if (isMessageHistoryEnabledString == null || isMessageHistoryEnabledString.length() == 0)   return;
  boolean isMessageHistoryEnabled=new Boolean(isMessageHistoryEnabledString).booleanValue();
  if (!isMessageHistoryEnabled)   return;
  msgHistoryPropListener=new MessageHistoryPropertyChangeListener();
  configService.addPropertyChangeListener("net.java.sip.communicator.impl.msghistory.isMessageHistoryEnabled",msgHistoryPropListener);
  logger.debug("Starting the msg history implementation.");
  this.loadMessageHistoryService();
}
