{
  RtpDescriptionPacketExtension description=JingleUtils.getRtpDescription(content);
  MediaType mediaType=MediaType.parseString(description.getMedia());
  TransportManagerJabberImpl transportManager=getTransportManager();
  MediaStreamTarget target=transportManager.getStreamTarget(mediaType);
  if (target == null)   target=JingleUtils.extractDefaultTarget(content);
  if ((target == null) || (target.getDataAddress().getPort() == 0)) {
    closeStream(mediaType);
    return;
  }
  List<MediaFormat> supportedFormats=JingleUtils.extractFormats(description,getDynamicPayloadTypes());
  MediaDevice dev=getDefaultDevice(mediaType);
  if (dev == null) {
    closeStream(mediaType);
    return;
  }
  MediaDirection devDirection=(dev == null) ? MediaDirection.INACTIVE : dev.getDirection();
  devDirection=devDirection.and(getDirectionUserPreference(mediaType));
  if (supportedFormats.isEmpty()) {
    ProtocolProviderServiceJabberImpl.throwOperationFailedException("Remote party sent an invalid Jingle answer.",OperationFailedException.ILLEGAL_ARGUMENT,null,logger);
  }
  StreamConnector connector=transportManager.getStreamConnector(mediaType);
  MediaDirection remoteDirection=JingleUtils.getDirection(content,getPeer().isInitiator());
  MediaDirection direction=devDirection.getDirectionForAnswer(remoteDirection);
  List<RTPExtension> remoteRTPExtensions=JingleUtils.extractRTPExtensions(description,getRtpExtensionsRegistry());
  List<RTPExtension> supportedExtensions=getExtensionsForType(mediaType);
  List<RTPExtension> rtpExtensions=intersectRTPExtensions(remoteRTPExtensions,supportedExtensions);
  initStream(content.getName(),connector,dev,supportedFormats.get(0),target,direction,rtpExtensions);
}
