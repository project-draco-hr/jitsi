{
  MediaDirection streamDirection=stream.getDirection();
  System.out.println("original dir " + streamDirection);
  if (streamDirection.allowsSending())   return streamDirection;
  ContentPacketExtension content=remoteContentMap.get(stream.getName());
  MediaDirection postHoldDir=JingleUtils.getDirection(content,!getPeer().isInitiator());
  System.out.println("remote direction from our perspective is " + postHoldDir);
  MediaDevice device=stream.getDevice();
  postHoldDir=postHoldDir.and(getDirectionUserPreference(device.getMediaType()));
  System.out.println("user pref direction is " + getDirectionUserPreference(device.getMediaType()));
  if (isLocallyOnHold()) {
    System.out.println("locally on hold is " + isLocallyOnHold());
    postHoldDir.and(MediaDirection.SENDONLY);
  }
  postHoldDir=postHoldDir.and(device.getDirection());
  System.out.println("device direction is " + device.getDirection());
  System.out.println("result direction is " + postHoldDir);
  return postHoldDir;
}
