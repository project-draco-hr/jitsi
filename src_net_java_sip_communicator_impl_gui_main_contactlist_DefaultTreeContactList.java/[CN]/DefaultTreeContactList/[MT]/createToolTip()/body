{
  Point currentMouseLocation=MouseInfo.getPointerInfo().getLocation();
  SwingUtilities.convertPointFromScreen(currentMouseLocation,this);
  TreePath path=this.getClosestPathForLocation(currentMouseLocation.x,currentMouseLocation.y);
  Object element=path.getLastPathComponent();
  ExtendedTooltip tip=new ExtendedTooltip(true);
  if (element instanceof ContactNode) {
    MetaContact metaContact=((ContactNode)element).getMetaContact();
    byte[] avatarImage=metaContact.getAvatar();
    if (avatarImage != null && avatarImage.length > 0)     tip.setImage(new ImageIcon(avatarImage));
    tip.setTitle(metaContact.getDisplayName());
    Iterator<Contact> i=metaContact.getContacts();
    String statusMessage=null;
    Contact protocolContact;
    while (i.hasNext()) {
      protocolContact=i.next();
      ImageIcon protocolStatusIcon=new ImageIcon(protocolContact.getPresenceStatus().getStatusIcon());
      String contactAddress=protocolContact.getAddress();
      tip.addLine(protocolStatusIcon,contactAddress);
      if (statusMessage == null && protocolContact.getStatusMessage() != null && protocolContact.getStatusMessage().length() > 0)       statusMessage=protocolContact.getStatusMessage();
    }
    if (statusMessage != null)     tip.setBottomText(statusMessage);
  }
 else   if (element instanceof GroupNode) {
    MetaContactGroup metaGroup=((GroupNode)element).getMetaContactGroup();
    tip.setTitle(metaGroup.getGroupName());
  }
 else   if (element instanceof ChatContact) {
    ChatContact chatContact=(ChatContact)element;
    ImageIcon avatarImage=chatContact.getAvatar();
    if (avatarImage != null)     tip.setImage(avatarImage);
    tip.setTitle(chatContact.getName());
  }
  tip.setComponent(this);
  return tip;
}
