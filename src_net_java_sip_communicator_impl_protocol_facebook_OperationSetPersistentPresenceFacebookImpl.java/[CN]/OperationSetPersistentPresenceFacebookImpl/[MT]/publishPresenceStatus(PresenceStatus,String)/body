{
  PresenceStatus oldPresenceStatus=this.presenceStatus;
  this.presenceStatus=status;
  if (statusMessage != null && !statusMessage.equals("")) {
    if (this.statusMessage == null || !this.statusMessage.equals(statusMessage)) {
      FacebookAdapter adapter=parentProvider.getAdapter();
      if (parentProvider != null && adapter != null)       adapter.setStatusMessage(statusMessage);
    }
  }
  this.statusMessage=statusMessage;
  this.fireProviderStatusChangeEvent(oldPresenceStatus);
  try {
    if (this.presenceStatus == FacebookStatusEnum.OFFLINE) {
      parentProvider.getAdapter().shutdown();
      changePresenceStatusForAllContactsWithoutFiringEvent(getServerStoredContactListRoot(),getPresenceStatus());
    }
 else     if (this.presenceStatus == FacebookStatusEnum.ONLINE) {
      if (oldPresenceStatus == FacebookStatusEnum.INVISIBLE)       parentProvider.getAdapter().getSession().setVisibility(true);
    }
 else     if (this.presenceStatus == FacebookStatusEnum.INVISIBLE) {
      parentProvider.getAdapter().getSession().setVisibility(false);
    }
  }
 catch (  IOException e) {
    throw new OperationFailedException("unable to change facebook visibility",-1,e);
  }
catch (  BrokenFacebookProtocolException e) {
    throw new OperationFailedException("unable to change facebook visibility",-1,e);
  }
}
