{
  final Collection msgList;
  if (historyContact instanceof MetaContact) {
    msgList=msgHistory.findByPeriod((MetaContact)historyContact,startDate,endDate);
  }
 else   if (historyContact instanceof ChatRoomWrapper) {
    ChatRoomWrapper chatRoomWrapper=(ChatRoomWrapper)historyContact;
    if (chatRoomWrapper.getChatRoom() == null)     return;
    msgList=msgHistory.findByPeriod(chatRoomWrapper.getChatRoom(),startDate,endDate);
  }
 else   msgList=null;
  Runnable updateMessagesPanel=new Runnable(){
    public void run(){
      HTMLDocument doc=createHistory(msgList);
      if (searchKeyword == null || searchKeyword == "") {
        dateHistoryTable.put(startDate,doc);
      }
    }
  }
;
  SwingUtilities.invokeLater(updateMessagesPanel);
}
