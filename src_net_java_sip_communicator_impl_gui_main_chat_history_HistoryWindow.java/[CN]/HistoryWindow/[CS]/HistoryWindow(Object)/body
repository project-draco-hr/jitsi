{
  this.historyContact=historyContact;
  chatConvPanel=new ChatConversationPanel(this);
  this.progressBar=new JProgressBar(MessageHistorySearchProgressListener.PROGRESS_MINIMUM_VALUE,MessageHistorySearchProgressListener.PROGRESS_MAXIMUM_VALUE);
  this.progressBar.setValue(0);
  this.progressBar.setStringPainted(true);
  this.msgHistory=GuiActivator.getMsgHistoryService();
  this.msgHistory.addSearchProgressListener(this);
  this.datesPanel=new DatesPanel(this);
  this.historyMenu=new HistoryMenu(this);
  this.searchPanel=new SearchPanel(this);
  this.initPanels();
  this.initDates();
  this.pack();
  this.addWindowListener(new HistoryWindowAdapter());
  if (historyContact instanceof MetaContact) {
    MetaContact metaContact=(MetaContact)historyContact;
    this.setTitle(GuiActivator.getResources().getI18NString("service.gui.HISTORY_CONTACT",new String[]{metaContact.getDisplayName()}));
    Iterator<Contact> protoContacts=metaContact.getContacts();
    while (protoContacts.hasNext()) {
      Contact protoContact=protoContacts.next();
      ((OperationSetBasicInstantMessaging)protoContact.getProtocolProvider().getOperationSet(OperationSetBasicInstantMessaging.class)).addMessageListener(this);
    }
  }
 else   if (historyContact instanceof ChatRoomWrapper) {
    ChatRoomWrapper chatRoomWrapper=(ChatRoomWrapper)historyContact;
    chatRoomWrapper.getChatRoom().addMessageListener(this);
  }
}
