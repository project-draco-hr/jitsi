{
  Contact containedContact=metaContact.getContact(contact.getAddress(),contact.getProtocolProvider());
  if (containedContact != null) {
    int lastDateIndex=datesPanel.getDatesNumber() - 1;
    Date lastDate=datesPanel.getDate(lastDateIndex);
    if (lastDate != null && GuiUtils.compareDates(lastDate,timestamp) == 0) {
      HTMLDocument document=(HTMLDocument)dateHistoryTable.get(lastDate);
      if (document != null) {
        String processedMessage=chatConvPanel.processMessage(contact.getDisplayName(),timestamp,messageType,messageContent,searchKeyword);
        this.appendMessageToDocument(document,processedMessage);
      }
    }
 else     if (lastDate == null || GuiUtils.compareDates(lastDate,timestamp) < 0) {
      long milisecondsPerDay=24 * 60 * 60* 1000;
      Date date=new Date(timestamp.getTime() - timestamp.getTime() % milisecondsPerDay);
      datesVector.add(date);
      datesPanel.addDate(date);
    }
  }
}
