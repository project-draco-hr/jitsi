{
  if (historyRecords.size() > 0) {
    Iterator i=historyRecords.iterator();
    String processedMessage="";
    while (i.hasNext()) {
      Object o=i.next();
      if (o instanceof MessageDeliveredEvent) {
        MessageDeliveredEvent evt=(MessageDeliveredEvent)o;
        ProtocolProviderService protocolProvider=evt.getDestinationContact().getProtocolProvider();
        processedMessage=chatConvPanel.processMessage(this.mainFrame.getAccount(protocolProvider),evt.getTimestamp(),Constants.OUTGOING_MESSAGE,evt.getSourceMessage().getContent(),evt.getSourceMessage().getContentType(),searchKeyword);
      }
 else       if (o instanceof MessageReceivedEvent) {
        MessageReceivedEvent evt=(MessageReceivedEvent)o;
        processedMessage=chatConvPanel.processMessage(evt.getSourceContact().getDisplayName(),evt.getTimestamp(),Constants.INCOMING_MESSAGE,evt.getSourceMessage().getContent(),evt.getSourceMessage().getContentType(),searchKeyword);
      }
 else       if (o instanceof ChatRoomMessageReceivedEvent) {
        ChatRoomMessageReceivedEvent evt=(ChatRoomMessageReceivedEvent)o;
        processedMessage=chatConvPanel.processMessage(evt.getSourceChatRoomMember().getName(),evt.getTimestamp(),Constants.INCOMING_MESSAGE,evt.getMessage().getContent(),evt.getMessage().getContentType(),searchKeyword);
      }
 else       if (o instanceof ChatRoomMessageDeliveredEvent) {
        ChatRoomMessageDeliveredEvent evt=(ChatRoomMessageDeliveredEvent)o;
        processedMessage=chatConvPanel.processMessage(evt.getSourceChatRoom().getParentProvider().getAccountID().getUserID(),evt.getTimestamp(),Constants.INCOMING_MESSAGE,evt.getMessage().getContent(),evt.getMessage().getContentType(),searchKeyword);
      }
      chatConvPanel.appendMessageToEnd(processedMessage);
    }
  }
  this.chatConvPanel.setDefaultContent();
  return this.chatConvPanel.getContent();
}
