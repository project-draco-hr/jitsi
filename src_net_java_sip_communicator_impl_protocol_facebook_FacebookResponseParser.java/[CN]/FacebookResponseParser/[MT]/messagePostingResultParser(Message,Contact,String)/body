{
  if (response == null)   throw new NullPointerException("The parameter response is null");
  String prefix="for (;;);";
  if (response.startsWith(prefix))   response=response.substring(prefix.length());
  JSONObject respObjs=new JSONObject(response);
  if (respObjs == null)   throw new NullPointerException("Failed to parse JSONObject from the parameter response");
  logger.info("error: " + respObjs.getInt("error"));
  if (respObjs.get("error") != null) {
    int errorCode=respObjs.getInt("error");
    String errorString="Error(" + errorCode + "): "+ (String)respObjs.get("errorSummary")+ "; "+ (String)respObjs.get("errorDescription");
    logger.warn(errorString);
    if (errorCode == FacebookErrorCode.Error_Global_NoError) {
      return null;
    }
 else {
      MessageDeliveryFailedEvent mdfe=new MessageDeliveryFailedEvent(msg,to,errorCode,System.currentTimeMillis(),(String)respObjs.get("errorSummary"));
      return mdfe;
    }
  }
  throw new JSONException("The response has no \'error\' code field");
}
