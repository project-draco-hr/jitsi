{
  if (response == null)   return seq;
  String prefix="for (;;);";
  if (response.startsWith(prefix))   response=response.substring(prefix.length());
  JSONObject respObjs=new JSONObject(response);
  String t=(String)respObjs.get("t");
  logger.info("t: " + t);
  if (t == null)   return seq;
  if (t.equals("msg")) {
    JSONArray ms=(JSONArray)respObjs.get("ms");
    logger.info("NO of msgs: " + ms.length());
    int index=0;
    while (index < ms.length()) {
      JSONObject msg=ms.getJSONObject(index);
      index++;
      if (msg.get("type").equals("typ")) {
        int facebookTypingState=msg.getInt("st");
        Long from=msg.getLong("from");
        if (!from.toString().equals(adapter.getUID()))         adapter.promoteTypingNotification(from.toString(),facebookTypingState);
      }
 else       if (msg.get("type").equals("msg")) {
        JSONObject realmsg=(JSONObject)msg.get("msg");
        FacebookMessage fm=new FacebookMessage();
        fm.text=(String)realmsg.get("text");
        fm.time=(Number)realmsg.get("time");
        fm.clientTime=(Number)realmsg.get("clientTime");
        fm.msgID=(String)realmsg.get("msgID");
        fm.from=(Number)msg.get("from");
        fm.to=(Number)msg.get("to");
        fm.fromName=(String)msg.get("from_name");
        fm.toName=(String)msg.get("to_name");
        fm.fromFirstName=(String)msg.get("from_first_name");
        fm.toFirstName=(String)msg.get("to_first_name");
        if (adapter.isMessageHandledBefore(fm.msgID)) {
          System.out.println("Omitting a already handled message: msgIDCollection.contains(msgID)");
          continue;
        }
        adapter.addMessageToCollection(fm.msgID);
        printMessage(fm);
        if (!fm.from.toString().equals(adapter.getUID()))         adapter.promoteMessage(fm);
      }
    }
    seq++;
  }
 else   if (t.equals("refresh")) {
    logger.trace("Refresh");
    if (respObjs.has("seq")) {
      seq=respObjs.getInt("seq");
      logger.trace("refresh seq: " + seq);
    }
    seq=adapter.reconnect();
  }
 else   if (t.equals("continue"))   logger.trace("Time out? reconnect...");
 else   logger.warn("Unrecognized response type: " + t);
  return seq;
}
