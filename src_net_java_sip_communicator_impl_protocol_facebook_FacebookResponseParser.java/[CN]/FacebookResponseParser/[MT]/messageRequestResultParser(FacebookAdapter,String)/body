{
  if (response == null)   return;
  String prefix="for (;;);";
  if (response.startsWith(prefix))   response=response.substring(prefix.length());
  JSONObject respObjs=new JSONObject(response);
  logger.info("t: " + (String)respObjs.get("t"));
  if (respObjs.get("t") != null) {
    if (((String)respObjs.get("t")).equals("msg")) {
      JSONArray ms=(JSONArray)respObjs.get("ms");
      logger.info("NO of msges: " + ms.length());
      int index=0;
      while (index < ms.length()) {
        JSONObject msg=ms.getJSONObject(index);
        index++;
        if (msg.get("type").equals("typ")) {
          int facebookTypingState=msg.getInt("st");
          Long from=msg.getLong("from");
          if (!from.toString().equals(adapter.getUID()))           adapter.promoteTypingNotification(from.toString(),facebookTypingState);
        }
 else         if (msg.get("type").equals("msg")) {
          JSONObject realmsg=(JSONObject)msg.get("msg");
          FacebookMessage fm=new FacebookMessage();
          fm.text=(String)realmsg.get("text");
          fm.time=(Number)realmsg.get("time");
          fm.clientTime=(Number)realmsg.get("clientTime");
          fm.msgID=(String)realmsg.get("msgID");
          fm.from=(Number)msg.get("from");
          fm.to=(Number)msg.get("to");
          fm.fromName=(String)msg.get("from_name");
          fm.toName=(String)msg.get("to_name");
          fm.fromFirstName=(String)msg.get("from_first_name");
          fm.toFirstName=(String)msg.get("to_first_name");
          if (adapter.isMessageHandledBefore(fm.msgID)) {
            System.out.println("Omitting a already handled message: msgIDCollection.contains(msgID)");
            continue;
          }
          adapter.addMessageToCollection(fm.msgID);
          printMessage(fm);
          if (!fm.from.toString().equals(adapter.getUID()))           adapter.promoteMessage(fm);
        }
      }
    }
 else     if (((String)respObjs.get("t")).equals("refresh")) {
      logger.trace("Refresh");
      if (((String)respObjs.get("seq")) != null) {
        logger.trace("refresh seq: " + (String)respObjs.get("seq"));
      }
    }
 else     if (((String)respObjs.get("t")).equals("continue")) {
      logger.trace("Time out? reconcect...");
    }
 else {
      logger.warn("Unrecognized response type: " + (String)respObjs.get("t"));
    }
  }
}
