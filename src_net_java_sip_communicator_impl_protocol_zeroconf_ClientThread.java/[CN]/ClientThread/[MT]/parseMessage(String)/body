{
  if (str.startsWith("<?xml") || str.startsWith("<stream"))   return new MessageZeroconfImpl(null,null,MessageZeroconfImpl.STREAM_OPEN);
  if (str.endsWith("stream>"))   return new MessageZeroconfImpl(null,null,MessageZeroconfImpl.STREAM_CLOSE);
  if ((str.indexOf("<delivered/>") > 0) && (str.indexOf("<body>") < 0))   return new MessageZeroconfImpl(null,null,MessageZeroconfImpl.DELIVERED);
  if (!str.startsWith("<message"))   return new MessageZeroconfImpl(null,null,MessageZeroconfImpl.UNDEF);
  if ((str.indexOf("<body>") < 0) || (str.indexOf("</body>") < 0))   return new MessageZeroconfImpl(null,null,MessageZeroconfImpl.UNDEF);
  String temp=str.substring(str.indexOf("<body>") + 6,str.indexOf("</body>"));
  if (logger.isDebugEnabled())   logger.debug("ZEROCONF: received message [" + temp + "]");
  int messageType=MessageZeroconfImpl.MESSAGE;
  if ((str.indexOf("<id>") >= 0) && (str.indexOf("</id>") >= 0))   messageType=MessageZeroconfImpl.TYPING;
  MessageZeroconfImpl msg=new MessageZeroconfImpl(temp,null,OperationSetBasicInstantMessaging.DEFAULT_MIME_TYPE,messageType);
  return msg;
}
