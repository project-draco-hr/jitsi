{
  String pFileName=getSystemProperty(PNAME_CONFIGURATION_FILE_NAME);
  if (pFileName == null)   pFileName="sip-communicator." + extension;
  File configFileInCurrentDir=new File(pFileName);
  if (configFileInCurrentDir.exists()) {
    if (logger.isDebugEnabled())     logger.debug("Using config file in current dir: " + configFileInCurrentDir.getAbsolutePath());
    return configFileInCurrentDir;
  }
  File configDir=new File(getScHomeDirLocation() + File.separator + getScHomeDirName());
  File configFileInUserHomeDir=new File(configDir,pFileName);
  if (configFileInUserHomeDir.exists()) {
    if (logger.isDebugEnabled())     logger.debug("Using config file in $HOME/.sip-communicator: " + configFileInUserHomeDir.getAbsolutePath());
    return configFileInUserHomeDir;
  }
  InputStream in=getClass().getClassLoader().getResourceAsStream(pFileName);
  if (in == null) {
    if (create) {
      configDir.mkdirs();
      configFileInUserHomeDir.createNewFile();
    }
    if (logger.isDebugEnabled())     logger.debug("Created an empty file in $HOME: " + configFileInUserHomeDir.getAbsolutePath());
    return configFileInUserHomeDir;
  }
  if (logger.isTraceEnabled())   logger.trace("Copying config file from JAR into " + configFileInUserHomeDir.getAbsolutePath());
  configDir.mkdirs();
  try {
    copy(in,configFileInUserHomeDir);
  }
  finally {
    try {
      in.close();
    }
 catch (    IOException ioex) {
    }
  }
  return configFileInUserHomeDir;
}
