{
  try {
    String pFileName=getSystemProperty(FILE_NAME_PROPERTY);
    if (pFileName == null) {
      pFileName="sip-communicator.xml";
    }
    File configFileInCurrentDir=new File(pFileName);
    if (configFileInCurrentDir.exists()) {
      logger.debug("Using config file in current dir: " + configFileInCurrentDir.getCanonicalPath());
      return configFileInCurrentDir;
    }
    String scHomeDirName=getScHomeDirName();
    String scHomeDirLocation=getScHomeDirLocation();
    File configDir=new File(scHomeDirLocation + File.separator + scHomeDirName);
    File configFileInUserHomeDir=new File(configDir,pFileName);
    if (configFileInUserHomeDir.exists()) {
      logger.debug("Using config file in $HOME/.sip-communicator: " + configFileInCurrentDir.getCanonicalPath());
      return configFileInUserHomeDir;
    }
    logger.trace("Copying config file.");
    configDir.mkdirs();
    InputStream in=getClass().getClassLoader().getResourceAsStream(pFileName);
    if (in == null) {
      configFileInUserHomeDir.createNewFile();
      logger.debug("Created an empty file in $HOME: " + configFileInCurrentDir.getCanonicalPath());
      return configFileInUserHomeDir;
    }
    BufferedReader reader=new BufferedReader(new InputStreamReader(in));
    PrintWriter writer=new PrintWriter(new FileWriter(configFileInUserHomeDir));
    String line;
    logger.debug("Copying properties file:");
    while ((line=reader.readLine()) != null) {
      writer.println(line);
      logger.debug(line);
    }
    writer.flush();
    return configFileInUserHomeDir;
  }
 catch (  IOException ex) {
    logger.error("Error creating config file",ex);
    return null;
  }
}
