{
  File configurationFile=getConfigurationFile("xml",false);
  if (configurationFile == null) {
    this.configurationFile=getConfigurationFile("xml",true);
    if (!(this.store instanceof XMLConfigurationStore))     this.store=new XMLConfigurationStore();
  }
 else {
    String name=configurationFile.getName();
    int extensionBeginIndex=name.lastIndexOf('.');
    String extension=(extensionBeginIndex > -1) ? name.substring(extensionBeginIndex) : null;
    if (".properties".equalsIgnoreCase(extension)) {
      this.configurationFile=configurationFile;
      if (!(this.store instanceof PropertyConfigurationStore))       this.store=new PropertyConfigurationStore();
    }
 else {
      File newConfigurationFile=new File(configurationFile.getParentFile(),((extensionBeginIndex > -1) ? name.substring(0,extensionBeginIndex) : name) + ".properties");
      if (newConfigurationFile.exists()) {
        this.configurationFile=newConfigurationFile;
        if (!(this.store instanceof PropertyConfigurationStore))         this.store=new PropertyConfigurationStore();
      }
 else       if (getSystemProperty(PNAME_CONFIGURATION_FILE_NAME) == null) {
        if (configurationFile.exists()) {
          ConfigurationStore xmlStore=new XMLConfigurationStore();
          try {
            xmlStore.reloadConfiguration(configurationFile);
          }
 catch (          XMLException xmlex) {
            IOException ioex=new IOException();
            ioex.initCause(xmlex);
            throw ioex;
          }
          ConfigurationStore propertyStore=(this.store instanceof PropertyConfigurationStore) ? this.store : new PropertyConfigurationStore();
          copy(xmlStore,propertyStore);
          this.configurationFile=getConfigurationFile("properties",true);
          this.store=propertyStore;
          Throwable exception=null;
          try {
            storeConfiguration(this.configurationFile);
          }
 catch (          IllegalStateException isex) {
            exception=isex;
          }
catch (          IOException ioex) {
            exception=ioex;
          }
          if (exception == null)           configurationFile.delete();
 else {
            this.configurationFile=configurationFile;
            this.store=xmlStore;
          }
        }
 else {
          this.configurationFile=getConfigurationFile("properties",true);
          if (!(this.store instanceof PropertyConfigurationStore))           this.store=new PropertyConfigurationStore();
        }
      }
 else {
        this.configurationFile=configurationFile.exists() ? configurationFile : getConfigurationFile("xml",true);
        if (!(this.store instanceof XMLConfigurationStore))         this.store=new XMLConfigurationStore();
      }
    }
  }
}
