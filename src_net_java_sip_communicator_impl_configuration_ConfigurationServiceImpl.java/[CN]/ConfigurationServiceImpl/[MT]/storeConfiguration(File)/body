{
  if (!started)   throw new IllegalStateException("Service is stopped or has not been started");
  String readOnly=System.getProperty(PNAME_CONFIGURATION_FILE_IS_READ_ONLY);
  if ((readOnly != null) && Boolean.parseBoolean(readOnly))   return;
  FailSafeTransaction trans=(file == null) ? null : faService.createFailSafeTransaction(file);
  Throwable exception=null;
  try {
    if (trans != null)     trans.beginTransaction();
    OutputStream stream=(file == null) ? null : new FileOutputStream(file);
    try {
      store.storeConfiguration(stream);
    }
  finally {
      if (stream != null)       stream.close();
    }
    if (trans != null)     trans.commit();
  }
 catch (  IllegalStateException isex) {
    exception=isex;
  }
catch (  IOException ioex) {
    exception=ioex;
  }
  if (exception != null) {
    logger.error("can't write data in the configuration file",exception);
    if (trans != null)     trans.rollback();
  }
}
