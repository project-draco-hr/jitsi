{
  try {
    logger.logEntry();
    if (propertiesDocument == null)     propertiesDocument=createPropertiesDocument();
    Node root=propertiesDocument.getFirstChild();
    Node currentNode=null;
    NodeList children=root.getChildNodes();
    for (int i=0; i < children.getLength(); i++) {
      currentNode=children.item(i);
      if (currentNode.getNodeType() == Node.ELEMENT_NODE) {
        StringBuffer propertyNameBuff=new StringBuffer();
        propertyNameBuff.append(currentNode.getNodeName());
        updateNode(currentNode,propertyNameBuff,properties);
      }
    }
    Map newlyAddedProperties=cloneProperties();
    Iterator propNames=fileExtractedProperties.keySet().iterator();
    while (propNames.hasNext())     newlyAddedProperties.remove(propNames.next());
    this.processNewProperties(propertiesDocument,newlyAddedProperties);
    XMLUtils.indentedWriteXML(propertiesDocument,new FileWriter(getConfigurationFile()));
  }
  finally {
    logger.logExit();
  }
}
