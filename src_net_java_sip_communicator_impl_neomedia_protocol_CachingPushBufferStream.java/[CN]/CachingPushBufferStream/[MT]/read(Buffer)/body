{
synchronized (cache) {
    if (readException != null) {
      IOException ex=new IOException();
      ex.initCause(readException);
      readException=null;
      throw ex;
    }
    buffer.setLength(0);
    if (!cache.isEmpty()) {
      int bufferOffset=buffer.getOffset();
      while (!cache.isEmpty()) {
        Buffer cacheBuffer=cache.get(0);
        int nextBufferOffset=read(cacheBuffer,buffer,bufferOffset);
        if ((cacheBuffer.getLength() <= 0) || (cacheBuffer.getData() == null))         cache.remove(0);
        if (nextBufferOffset < 0)         break;
 else         bufferOffset=nextBufferOffset;
      }
      cacheLengthInMillis-=getLengthInMillis(buffer);
      if (cacheLengthInMillis < 0)       cacheLengthInMillis=0;
      if (canWriteInCache())       cache.notify();
    }
  }
}
