{
synchronized (cache) {
    boolean interrupted=false;
    while (true) {
      if (this.transferHandler != transferHandler)       return;
      if (canWriteInCache())       break;
      try {
        cache.wait();
      }
 catch (      InterruptedException iex) {
        interrupted=true;
      }
    }
    if (interrupted)     Thread.currentThread().interrupt();
    Buffer buffer=new Buffer();
    try {
      stream.read(buffer);
      readException=null;
    }
 catch (    IOException ioex) {
      readException=ioex;
    }
    cache.add(buffer);
    cacheLengthInMillis+=getLengthInMillis(buffer);
  }
}
