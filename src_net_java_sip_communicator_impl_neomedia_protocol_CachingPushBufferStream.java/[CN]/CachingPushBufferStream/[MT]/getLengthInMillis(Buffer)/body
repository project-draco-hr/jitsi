{
  int length=buffer.getLength();
  if (length < 1)   return 0;
  Format format=buffer.getFormat();
  if (format == null) {
    format=getFormat();
    if (format == null)     return 0;
  }
  if (!(format instanceof AudioFormat))   return 0;
  AudioFormat audioFormat=(AudioFormat)format;
  long duration=audioFormat.computeDuration(length);
  return (duration < 1) ? 0 : (duration / 1000000);
}
