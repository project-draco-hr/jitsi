{
synchronized (cache) {
    BufferTransferHandler substituteTransferHandler=(transferHandler == null) ? null : new StreamSubstituteBufferTransferHandler(transferHandler,stream,this){
      @Override public void transferData(      PushBufferStream stream){
        if (CachingPushBufferStream.this.stream == stream) {
          CachingPushBufferStream.this.transferData(this);
        }
        super.transferData(stream);
      }
    }
;
    stream.setTransferHandler(substituteTransferHandler);
    this.transferHandler=substituteTransferHandler;
    cache.notifyAll();
  }
}
