{
  Image selectedIcon;
  int maxWidth=0;
  int maxColors=0;
  int crtDescriptor=-1;
  ByteArrayOutputStream output=new ByteArrayOutputStream();
  byte[] result=null;
  URL feedLocation=getRssURL();
  try {
    File fileLocation=new File(feedLocation.getProtocol() + "://" + feedLocation.getHost()+ "/favicon.ico");
    if (!fileLocation.exists()) {
      return getDefaultRssIcon();
    }
    ICOFile favicon=new ICOFile(fileLocation.toURL());
    logger.trace("Icon has " + favicon.getImageCount() + " pages");
    for (int i=0; i < favicon.getDescriptors().size(); i++) {
      BitmapDescriptor bmpDesc=favicon.getDescriptor(i);
      if ((maxWidth < bmpDesc.getWidth())) {
        maxWidth=bmpDesc.getWidth();
        maxColors=bmpDesc.getColorCount();
        crtDescriptor=i;
      }
      if ((maxColors < bmpDesc.getColorCount())) {
        maxWidth=bmpDesc.getWidth();
        maxColors=bmpDesc.getColorCount();
        crtDescriptor=i;
      }
    }
    if (crtDescriptor == -1) {
      return getDefaultRssIcon();
    }
    selectedIcon=favicon.getDescriptor(crtDescriptor).getImageRGB();
    ImageIO.write((BufferedImage)selectedIcon,"PNG",output);
    result=output.toByteArray();
    logger.trace("Result has " + result.length + " bytes");
    logger.trace("Icon is " + maxWidth + " px X "+ maxWidth+ " px @ "+ maxColors+ " colors");
    output.close();
    return result;
  }
 catch (  MalformedURLException murlex) {
    logger.error("Malformed URL " + murlex,murlex);
  }
catch (  IOException ioex) {
    logger.error("I/O Error on favicon retrieval. " + ioex,ioex);
  }
  return getDefaultRssIcon();
}
