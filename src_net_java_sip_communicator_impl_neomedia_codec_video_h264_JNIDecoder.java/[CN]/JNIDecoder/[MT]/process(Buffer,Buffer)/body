{
  if (!checkInputBuffer(inBuffer))   return BUFFER_PROCESSED_FAILED;
  if (isEOM(inBuffer) || !opened) {
    propagateEOM(outBuffer);
    return BUFFER_PROCESSED_OK;
  }
  if (inBuffer.isDiscard()) {
    outBuffer.setDiscard(true);
    return BUFFER_PROCESSED_OK;
  }
  got_picture[0]=false;
  FFmpeg.avcodec_decode_video(avcontext,avframe,got_picture,(byte[])inBuffer.getData(),inBuffer.getLength());
  if (!got_picture[0]) {
    outBuffer.setDiscard(true);
    return BUFFER_PROCESSED_OK;
  }
  int avctxWidth=FFmpeg.avcodeccontext_get_width(avcontext);
  int avctxHeight=FFmpeg.avcodeccontext_get_height(avcontext);
  if ((avctxWidth != 0) && (avctxWidth != width)) {
    width=avctxWidth;
    Dimension outSize=new Dimension(avctxWidth,avctxHeight);
    VideoFormat inFormat=(VideoFormat)inBuffer.getFormat();
    float outFrameRate=ensureFrameRate(inFormat.getFrameRate());
    outputFormat=new AVFrameFormat(outSize,outFrameRate);
  }
  outBuffer.setFormat(outputFormat);
  Object out=outBuffer.getData();
  if (!(out instanceof AVFrame) || (((AVFrame)out).getPtr() != avframe))   outBuffer.setData(new AVFrame(avframe));
  return BUFFER_PROCESSED_OK;
}
