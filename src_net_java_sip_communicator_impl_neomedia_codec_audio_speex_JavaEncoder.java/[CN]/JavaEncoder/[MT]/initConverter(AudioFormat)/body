{
  lastFormat=inFormat;
  AudioFormat oFormat=(AudioFormat)outputFormat;
  outFormat=new AudioFormat(oFormat.getEncoding(),oFormat.getSampleRate(),oFormat.getSampleSizeInBits(),oFormat.getChannels(),oFormat.getEndian(),oFormat.getSigned(),oFormat.getFrameSizeInBits(),oFormat.getFrameRate(),oFormat.getDataType()){
    /** 
 * Serial version UID.
 */
    private static final long serialVersionUID=0L;
    /** 
 * The length in nanoseconds.
 */
    @Override public long computeDuration(    long length){
      return 20 * 1000000;
    }
  }
;
  encoder=new SpeexEncoder();
  int sampleRate=(int)inFormat.getSampleRate();
  int band=NARROW_BAND;
  if (sampleRate == 16000)   band=WIDE_BAND;
 else   if (sampleRate == 32000)   band=ULTRA_WIDE_BAND;
  encoder.init(band,4,sampleRate,1);
  frameSize=2 * encoder.getFrameSize();
}
