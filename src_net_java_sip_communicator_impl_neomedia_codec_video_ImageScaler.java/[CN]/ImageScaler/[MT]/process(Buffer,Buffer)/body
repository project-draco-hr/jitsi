{
  if (!checkInputBuffer(input)) {
    return BUFFER_PROCESSED_FAILED;
  }
  if (isEOM(input)) {
    propagateEOM(output);
    return BUFFER_PROCESSED_OK;
  }
  if (passthrough) {
    output.setData(input.getData());
    output.setLength(input.getLength());
    output.setOffset(input.getOffset());
    return BUFFER_PROCESSED_OK;
  }
  final BufferedImage image=(BufferedImage)bufferToImage.createImage(input);
  final Dimension inputSize=((VideoFormat)inputFormat).getSize();
  final Dimension outputSize=((VideoFormat)outputFormat).getSize();
  final double scaleX=((double)outputSize.width) / ((double)inputSize.width);
  final double scaleY=((double)outputSize.height) / ((double)inputSize.height);
  final BufferedImage scaled=scale(image,scaleX,scaleY);
  final Buffer b=ImageToBuffer.createBuffer(scaled,((VideoFormat)outputFormat).getFrameRate());
  output.setData(b.getData());
  output.setLength(b.getLength());
  output.setOffset(b.getOffset());
  output.setFormat(b.getFormat());
  return BUFFER_PROCESSED_OK;
}
