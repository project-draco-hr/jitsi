{
  BufferedImage buf=new BufferedImage(width,height,src.getType());
  Double ratioSrc=new Double((double)src.getWidth() / (double)src.getHeight());
  Double ratioDst=new Double(width / height);
  int startWidth=0;
  int startHeight=0;
  if (ratioSrc.compareTo(ratioDst) != 0) {
    int newWidth=0;
    int newHeight=((src.getHeight() * width) / src.getWidth());
    startHeight=(height - newHeight) / 2;
    if (startHeight < 0) {
      newWidth=((src.getWidth() * height) / src.getHeight());
      startWidth=(width - newWidth) / 2;
      startHeight=0;
      width=newWidth;
    }
 else {
      height=newHeight;
    }
  }
  Graphics2D g2d=buf.createGraphics();
  g2d.setBackground(Color.BLACK);
  g2d.setRenderingHint(RenderingHints.KEY_INTERPOLATION,RenderingHints.VALUE_INTERPOLATION_BILINEAR);
  g2d.drawImage(src,startWidth,startHeight,width,height,null);
  g2d.dispose();
  return buf;
}
