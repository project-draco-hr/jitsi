{
  NetworkAddressManagerService nam=ProtocolMediaActivator.getNetworkAddressManagerService();
  InetAddress intendedDestination=getIntendedDestination(getCallPeer());
  InetAddress localHostForPeer=nam.getLocalHost(intendedDestination);
  initializePortNumbers();
  DatagramSocket rtpSocket=null;
  try {
    rtpSocket=nam.createDatagramSocket(localHostForPeer,nextMediaPortToTry,minMediaPort,maxMediaPort);
  }
 catch (  Exception exc) {
    throw new OperationFailedException("Failed to allocate the network ports necessary for the call.",OperationFailedException.INTERNAL_ERROR,exc);
  }
  nextMediaPortToTry=rtpSocket.getLocalPort() + 1;
  DatagramSocket rtcpSocket=null;
  try {
    rtcpSocket=nam.createDatagramSocket(localHostForPeer,nextMediaPortToTry,minMediaPort,maxMediaPort);
  }
 catch (  Exception exc) {
    throw new OperationFailedException("Failed to allocate the network ports necessary for the call.",OperationFailedException.INTERNAL_ERROR,exc);
  }
  nextMediaPortToTry=rtcpSocket.getLocalPort() + 1;
  if (nextMediaPortToTry > maxMediaPort - 1)   nextMediaPortToTry=minMediaPort;
  return new DefaultStreamConnector(rtpSocket,rtcpSocket);
}
