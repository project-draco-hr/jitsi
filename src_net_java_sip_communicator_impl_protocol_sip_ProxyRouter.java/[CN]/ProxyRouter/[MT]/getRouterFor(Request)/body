{
  Address address=((FromHeader)request.getHeader(FromHeader.NAME)).getAddress();
  Set<ProtocolProviderServiceSipImpl> services=ProtocolProviderServiceSipImpl.getAllInstances();
  for (  ProtocolProviderServiceSipImpl service : services) {
    if (request.getRequestURI().isSipURI() && service.getOurSipAddress((SipURI)request.getRequestURI()).equals(address)) {
      String proxy=service.getOutboundProxyString();
      if (proxy == null)       return this.getDefaultRouter();
      Router router=routerCache.get(proxy);
      if (router == null) {
        router=new DefaultRouter(stack,proxy);
        routerCache.put(proxy,router);
      }
      return router;
    }
  }
  return this.getDefaultRouter();
}
