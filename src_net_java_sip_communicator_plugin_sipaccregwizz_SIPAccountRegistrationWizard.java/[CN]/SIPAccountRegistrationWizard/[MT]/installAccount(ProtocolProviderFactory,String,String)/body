{
  Hashtable accountProperties=new Hashtable();
  if (registration.isRememberPassword()) {
    accountProperties.put(ProtocolProviderFactory.PASSWORD,passwd);
  }
  accountProperties.put(ProtocolProviderFactory.SERVER_ADDRESS,registration.getServerAddress());
  accountProperties.put(ProtocolProviderFactory.SERVER_PORT,registration.getServerPort());
  accountProperties.put(ProtocolProviderFactory.PROXY_ADDRESS,registration.getProxy());
  accountProperties.put(ProtocolProviderFactory.PROXY_PORT,registration.getProxyPort());
  accountProperties.put(ProtocolProviderFactory.PREFERRED_TRANSPORT,registration.getPreferredTransport());
  accountProperties.put(ProtocolProviderFactory.IS_PRESENCE_ENABLED,Boolean.toString(registration.isEnablePresence()));
  accountProperties.put(ProtocolProviderFactory.FORCE_P2P_MODE,Boolean.toString(registration.isForceP2PMode()));
  accountProperties.put(ProtocolProviderFactory.POLLING_PERIOD,registration.getPollingPeriod());
  accountProperties.put(ProtocolProviderFactory.SUBSCRIPTION_EXPIRATION,registration.getSubscriptionExpiration());
  if (isModification) {
    providerFactory.uninstallAccount(protocolProvider.getAccountID());
    this.protocolProvider=null;
  }
  try {
    AccountID accountID=providerFactory.installAccount(user,accountProperties);
    ServiceReference serRef=providerFactory.getProviderForAccount(accountID);
    protocolProvider=(ProtocolProviderService)SIPAccRegWizzActivator.bundleContext.getService(serRef);
  }
 catch (  Exception exc) {
    logger.error(exc.getMessage(),exc);
    throw new RuntimeException(exc.getMessage(),exc);
  }
  return protocolProvider;
}
