{
  JMenuItem menuItem=(JMenuItem)e.getSource();
  String itemName=menuItem.getName();
  Contact contact;
  if (itemName.equals(addContactItem.getName())) {
    AddContactDialog dialog=new AddContactDialog(mainFrame,metaContact);
    ProtocolProviderService protocolProvider=GuiActivator.getPreferredAccount();
    if (protocolProvider != null)     dialog.setSelectedAccount(protocolProvider);
    dialog.setVisible(true);
  }
 else   if (itemName.equalsIgnoreCase("sendMessage")) {
    GuiActivator.getUIService().getChatWindowManager().startChat(metaContact);
  }
 else   if (itemName.equalsIgnoreCase("sendSms")) {
    Contact defaultSmsContact=metaContact.getDefaultContact(OperationSetSmsMessaging.class);
    GuiActivator.getUIService().getChatWindowManager().startChat(metaContact,defaultSmsContact,true);
  }
 else   if (itemName.equals("call")) {
    contact=metaContact.getDefaultContact(OperationSetBasicTelephony.class);
    CallManager.createCall(contact.getProtocolProvider(),contact);
  }
 else   if (itemName.equals("videoCall")) {
    contact=metaContact.getDefaultContact(OperationSetVideoTelephony.class);
    CallManager.createVideoCall(contact.getProtocolProvider(),contact);
  }
 else   if (itemName.equals("shareFullScreen")) {
    contact=metaContact.getDefaultContact(OperationSetVideoTelephony.class);
    CallManager.createDesktopSharing(contact.getProtocolProvider(),contact.getAddress());
  }
 else   if (itemName.equals("shareRegion")) {
    contact=metaContact.getDefaultContact(OperationSetVideoTelephony.class);
    CallManager.createRegionDesktopSharing(contact.getProtocolProvider(),contact.getAddress());
  }
 else   if (itemName.equals("sendFile")) {
    SipCommFileChooser scfc=GenericFileDialog.create(null,"Send file...",SipCommFileChooser.LOAD_FILE_OPERATION,ConfigurationUtils.getSendFileLastDir());
    File selectedFile=scfc.getFileFromDialog();
    if (selectedFile != null) {
      ConfigurationUtils.setSendFileLastDir(selectedFile.getParent());
      ChatPanel chatPanel=GuiActivator.getUIService().getChatWindowManager().getContactChat(metaContact,true);
      chatPanel.sendFile(selectedFile);
      GuiActivator.getUIService().getChatWindowManager().openChat(chatPanel,true);
    }
    GuiActivator.getUIService().getChatWindowManager().startChat(metaContact);
  }
 else   if (itemName.equals("renameContact")) {
    RenameContactDialog dialog=new RenameContactDialog(mainFrame,metaContact);
    dialog.setVisible(true);
    dialog.requestFocusInFiled();
  }
 else   if (itemName.equals("viewHistory")) {
    HistoryWindow history;
    HistoryWindowManager historyWindowManager=GuiActivator.getUIService().getHistoryWindowManager();
    if (historyWindowManager.containsHistoryWindowForContact(metaContact)) {
      history=historyWindowManager.getHistoryWindowForContact(metaContact);
      if (history.getState() == JFrame.ICONIFIED)       history.setState(JFrame.NORMAL);
      history.toFront();
    }
 else {
      history=new HistoryWindow(this.metaContact);
      historyWindowManager.addHistoryWindowForContact(metaContact,history);
      history.setVisible(true);
    }
  }
 else   if (itemName.equals("requestAuth")) {
    if (firstUnsubscribedContact != null)     contact=firstUnsubscribedContact;
 else     contact=metaContact.getDefaultContact();
    requestAuthorization(contact);
  }
 else   if (itemName.startsWith(moveToPrefix)) {
    MetaContactListManager.moveMetaContactToGroup(metaContact,itemName.substring(moveToPrefix.length()));
  }
 else   if (itemName.startsWith(removeContactPrefix)) {
    contact=getContactFromMetaContact(itemName.substring(removeContactPrefix.length()));
    if (contact != null) {
      MetaContactListManager.removeContact(contact);
    }
 else {
      MetaContactListManager.removeMetaContact(metaContact);
    }
  }
 else   if (itemName.startsWith(moveSubcontactPrefix)) {
    contact=getContactFromMetaContact(itemName.substring(moveSubcontactPrefix.length()));
    contactList.addContactListListener(this);
    contactList.setGroupClickConsumed(true);
    this.moveDialog=new MoveSubcontactMessageDialog(mainFrame,this);
    this.moveDialog.addWindowListener(new WindowAdapter(){
      @Override public void windowClosed(      WindowEvent e){
        contactList.setGroupClickConsumed(false);
      }
    }
);
    this.moveDialog.setVisible(true);
    if (contact != null) {
      this.contactToMove=contact;
    }
 else {
      this.moveAllContacts=true;
    }
  }
 else   if (itemName.startsWith(callContactPrefix)) {
    contact=getContactFromMetaContact(itemName.substring(callContactPrefix.length()));
    CallManager.createCall(contact.getProtocolProvider(),contact);
  }
 else   if (itemName.startsWith(videoCallPrefix)) {
    contact=getContactFromMetaContact(itemName.substring(videoCallPrefix.length()));
    CallManager.createVideoCall(contact.getProtocolProvider(),contact.getAddress());
  }
 else   if (itemName.startsWith(fullDesktopSharingPrefix)) {
    contact=getContactFromMetaContact(itemName.substring(fullDesktopSharingPrefix.length()));
    CallManager.createDesktopSharing(contact.getProtocolProvider(),contact.getAddress());
  }
 else   if (itemName.startsWith(regionDesktopSharingPrefix)) {
    contact=getContactFromMetaContact(itemName.substring(regionDesktopSharingPrefix.length()));
    CallManager.createRegionDesktopSharing(contact.getProtocolProvider(),contact.getAddress());
  }
 else   if (itemName.startsWith(requestAuthPrefix)) {
    contact=getContactFromMetaContact(itemName.substring(requestAuthPrefix.length()));
    requestAuthorization(contact);
  }
 else   if (itemName.startsWith(callPhonePrefix)) {
    List<ProtocolProviderService> providers=CallManager.getTelephonyProviders();
    String phone=itemName.substring(callPhonePrefix.length());
    if (providers.size() > 1) {
      ChooseCallAccountDialog chooseAccount=new ChooseCallAccountDialog(phone,OperationSetBasicTelephony.class,providers);
      chooseAccount.setVisible(true);
    }
 else {
      CallManager.createCall(providers.get(0),phone);
    }
  }
}
