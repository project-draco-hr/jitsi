{
  if (newState.equals(RegistrationState.CONNECTION_FAILED) && isRegistered()) {
    unregister();
  }
  lastRegistrationState=newState;
  super.fireRegistrationStateChanged(oldState,newState,reasonCode,reason);
}
