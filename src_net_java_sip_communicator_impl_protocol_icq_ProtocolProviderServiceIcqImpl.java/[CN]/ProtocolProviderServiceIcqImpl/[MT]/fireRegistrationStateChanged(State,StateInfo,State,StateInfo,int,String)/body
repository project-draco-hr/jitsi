{
  RegistrationState oldRegistrationState=joustSimStateToRegistrationState(oldJoustSimState,oldJoustSimStateInfo);
  RegistrationState newRegistrationState=joustSimStateToRegistrationState(newJoustSimState,newJoustSimStateInfo);
  if (newJoustSimStateInfo instanceof LoginFailureStateInfo) {
    LoginFailureInfo loginFailure=((LoginFailureStateInfo)newJoustSimStateInfo).getLoginFailureInfo();
    if (loginFailure instanceof AuthFailureInfo) {
      AuthFailureInfo afi=(AuthFailureInfo)loginFailure;
      logger.debug("AuthFailureInfo code : " + afi.getErrorCode());
      int code=ConnectionClosedListener.convertAuthCodeToReasonCode(afi);
      reasonCode=ConnectionClosedListener.convertCodeToRegistrationStateChangeEvent(code);
      reason=ConnectionClosedListener.convertCodeToStringReason(code);
    }
  }
  fireRegistrationStateChanged(oldRegistrationState,newRegistrationState,reasonCode,reason);
}
