{
  if (authority == null)   throw new IllegalArgumentException("The register method needs a valid non-null authority impl " + " in order to be able and retrieve passwords.");
synchronized (initializationLock) {
    String password=IcqActivator.getProtocolProviderFactory().loadPassword(getAccountID());
    if (password == null) {
      UserCredentials credentials=new UserCredentials();
      credentials.setUserName(this.getAccountID().getUserID());
      credentials=authority.obtainCredentials(ProtocolNames.ICQ,credentials);
      char[] pass=credentials.getPassword();
      if (pass == null) {
        return;
      }
      password=new String(pass);
      if (credentials.isPasswordPersistent()) {
        IcqActivator.getProtocolProviderFactory().storePassword(getAccountID(),password);
      }
    }
    session=new DefaultAppSession();
    aimSession=session.openAimSession(new Screenname(getAccountID().getUserID()));
    aimConnection=aimSession.openConnection(new AimConnectionProperties(new Screenname(getAccountID().getUserID()),password));
    aimConnStateListener=new AimConnStateListener();
    aimConnection.addStateListener(aimConnStateListener);
    aimConnection.connect();
  }
}
