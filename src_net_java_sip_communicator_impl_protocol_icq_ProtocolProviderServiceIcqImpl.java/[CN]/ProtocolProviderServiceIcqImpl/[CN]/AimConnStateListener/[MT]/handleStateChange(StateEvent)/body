{
  State newState=event.getNewState();
  State oldState=event.getOldState();
  AimConnection conn=event.getAimConnection();
  logger.debug("ICQ protocol provider " + getProtocolName() + " changed registration status from "+ oldState+ " to "+ newState);
  if (newState == State.ONLINE) {
    icbmService=conn.getIcbmService();
    icbmService.addIcbmListener(aimIcbmListener);
    conn.getInfoService().getOscarConnection().getSnacProcessor().getCmdFactoryMgr().getDefaultFactoryList().registerAll(new DefaultCmdFactory());
  }
 else   if (newState == State.DISCONNECTED || newState == State.FAILED) {
    logger.debug("The aim Connection was disconnected!");
  }
  fireRegistrationStateChanged(oldState,event.getOldStateInfo(),newState,event.getNewStateInfo(),RegistrationStateChangeEvent.REASON_NOT_SPECIFIED,null);
}
