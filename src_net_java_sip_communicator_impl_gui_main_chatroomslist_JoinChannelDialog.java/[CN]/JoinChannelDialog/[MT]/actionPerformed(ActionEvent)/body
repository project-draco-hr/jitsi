{
  JButton button=(JButton)e.getSource();
  String buttonName=button.getName();
  OperationSetMultiUserChat multiChatOpSet=(OperationSetMultiUserChat)protocolProvider.getOperationSet(OperationSetMultiUserChat.class);
  if (buttonName.equals("ok")) {
    ChatRoom chatRoom=null;
    String chatRoomName;
    if (channelsList != null && channelsList.getSelectedValue() != null)     chatRoomName=(String)channelsList.getSelectedValue();
 else     chatRoomName=channelTextField.getText();
    try {
      chatRoom=multiChatOpSet.findRoom(chatRoomName);
    }
 catch (    Exception ex) {
      logger.error("Failed to find chat room.",ex);
      new ErrorDialog(mainFrame,Messages.getI18NString("findChatRoomError",new String[]{chatRoomName}).getText(),ex,Messages.getI18NString("error").getText()).showDialog();
    }
    if (chatRoom != null) {
      try {
        chatRoom.join();
        ConfigurationManager.saveChatRoom(chatRoom);
        ChatRoomsList chatRoomsList=mainFrame.getChatRoomsListPanel().getChatRoomsList();
        if (!chatRoomsList.containsChatRoom(chatRoom))         mainFrame.getChatRoomsListPanel().getChatRoomsList().addChatRoom(chatRoom);
      }
 catch (      OperationFailedException ex) {
        logger.error("Failed to join chat room. ",ex);
        new ErrorDialog(mainFrame,Messages.getI18NString("failedToJoinChannel",new String[]{chatRoom.getName()}).getText(),ex,Messages.getI18NString("error").getText()).showDialog();
      }
    }
 else {
      new ErrorDialog(mainFrame,Messages.getI18NString("chatRoomNotExist",new String[]{chatRoom.getName(),protocolProvider.getAccountID().getService()}).getText(),Messages.getI18NString("error").getText()).showDialog();
    }
  }
 else   if (buttonName.equals("cancel")) {
    this.dispose();
  }
 else   if (buttonName.equals("channelList")) {
    List list=null;
    try {
      list=multiChatOpSet.getExistingChatRooms();
    }
 catch (    OperationFailedException ex) {
      logger.error("Could not obtain existing chat rooms.",ex);
    }
catch (    OperationNotSupportedException ex) {
      logger.error("Could not obtain existing chat rooms.",ex);
    }
    if (list != null && list.size() > 0) {
      channelsList=new JList(list.toArray());
      channelsListScrollPane.getViewport().add(channelsList);
      mainPanel.add(channelsListScrollPane,BorderLayout.SOUTH);
      mainPanel.revalidate();
      mainPanel.repaint();
    }
  }
}
