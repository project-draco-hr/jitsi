{
  int[][] inputSamples;
  int maxInputSampleCount;
  long timeStamp;
synchronized (readSyncRoot) {
    inputSamples=this.inputSamples;
    maxInputSampleCount=this.maxInputSampleCount;
    timeStamp=this.timeStamp;
    this.inputSamples=null;
    this.maxInputSampleCount=0;
    this.timeStamp=Buffer.TIME_UNKNOWN;
  }
  int inputSampleCount=(inputSamples == null) ? 0 : inputSamples.length;
  if ((inputSampleCount == 0) || (maxInputSampleCount <= 0)) {
    buffer.setLength(0);
    return;
  }
  AudioFormat outputFormat=getFormat();
  int[] outputSamples=mix(inputSamples,outputFormat,maxInputSampleCount);
  Class<?> outputDataType=outputFormat.getDataType();
  if (Format.byteArray.equals(outputDataType)) {
    byte[] outputData;
switch (outputFormat.getSampleSizeInBits()) {
case 16:
      outputData=new byte[outputSamples.length * 2];
    for (int i=0; i < outputSamples.length; i++)     ArrayIOUtils.writeInt16(outputSamples[i],outputData,i * 2);
  break;
case 32:
outputData=new byte[outputSamples.length * 4];
for (int i=0; i < outputSamples.length; i++) writeInt(outputSamples[i],outputData,i * 4);
break;
case 8:
case 24:
default :
throw new UnsupportedOperationException("AudioMixingPushBufferStream.read(Buffer)");
}
buffer.setData(outputData);
buffer.setFormat(outputFormat);
buffer.setLength(outputData.length);
buffer.setOffset(0);
buffer.setTimeStamp(timeStamp);
}
 else throw new UnsupportedOperationException("AudioMixingPushBufferStream.read(Buffer)");
}
