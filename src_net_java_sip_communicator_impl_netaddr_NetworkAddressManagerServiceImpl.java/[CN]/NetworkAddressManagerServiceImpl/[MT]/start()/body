{
  String stunAddressStr=null;
  int port=-1;
  stunAddressStr=NetaddrActivator.getConfigurationService().getString(PROP_STUN_SERVER_ADDRESS);
  String portStr=NetaddrActivator.getConfigurationService().getString(PROP_STUN_SERVER_PORT);
  this.localHostFinderSocket=initRandomPortSocket();
  if (stunAddressStr == null || portStr == null) {
    useStun=false;
    logger.info("Stun server address(" + stunAddressStr + ")/port("+ portStr+ ") not set (or invalid). Disabling STUN.");
  }
 else {
    try {
      port=Integer.valueOf(portStr).intValue();
    }
 catch (    NumberFormatException ex) {
      logger.info(portStr + " is not a valid port number. " + "Defaulting to 3478",ex);
      port=DEFAULT_STUN_SERVER_PORT;
    }
    stunServerAddress=new StunAddress(stunAddressStr,port);
    detector=new SimpleAddressDetector(stunServerAddress);
    if (logger.isDebugEnabled()) {
      logger.debug("Created a STUN Address detector for the following " + "STUN server: " + stunAddressStr + ":"+ port);
    }
    detector.start();
    logger.debug("STUN server detector started;");
    NetaddrActivator.getConfigurationService().addVetoableChangeListener(PROP_STUN_SERVER_ADDRESS,this);
    NetaddrActivator.getConfigurationService().addVetoableChangeListener(PROP_STUN_SERVER_PORT,this);
    launchStunServerTest();
  }
}
