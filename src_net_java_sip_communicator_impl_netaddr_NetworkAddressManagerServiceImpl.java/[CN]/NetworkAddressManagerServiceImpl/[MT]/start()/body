{
  String stunAddressStr=null;
  int port=-1;
  stunAddressStr=NetaddrActivator.getConfigurationService().getString(PROP_STUN_SERVER_ADDRESS);
  String portStr=NetaddrActivator.getConfigurationService().getString(PROP_STUN_SERVER_PORT);
  stunServerAddress=new StunAddress(DEFAULT_STUN_SERVER_ADDRESS,DEFAULT_STUN_SERVER_PORT);
  if (stunAddressStr == null || portStr == null) {
    useStun=false;
  }
 else {
    port=Integer.valueOf(portStr).intValue();
    stunServerAddress=new StunAddress(stunAddressStr,port);
    detector=new SimpleAddressDetector(stunServerAddress);
    if (logger.isDebugEnabled())     logger.debug("Created a STUN Address detector for the following " + "STUN server: " + stunAddressStr + ":"+ port);
    try {
      detector.start();
      logger.debug("STUN server started;");
    }
 catch (    StunException ex) {
      logger.error("Failed to start the STUN Address Detector. " + detector.toString(),ex);
      logger.debug("Disabling stun and continuing bravely!");
      detector=null;
      useStun=false;
    }
    NetaddrActivator.getConfigurationService().addVetoableChangeListener(PROP_STUN_SERVER_ADDRESS,this);
    NetaddrActivator.getConfigurationService().addVetoableChangeListener(PROP_STUN_SERVER_PORT,this);
  }
  initializeLocalHostFinderSocket();
}
