{
  InetAddress localHost=null;
  localHostFinderSocket.connect(intendedDestination,this.RANDOM_ADDR_DISC_PORT);
  localHost=localHostFinderSocket.getLocalAddress();
  localHostFinderSocket.disconnect();
  if (localHost.isAnyLocalAddress()) {
    try {
      if (intendedDestination instanceof Inet6Address) {
        Enumeration<NetworkInterface> interfaces=NetworkInterface.getNetworkInterfaces();
        while (interfaces.hasMoreElements()) {
          NetworkInterface iface=interfaces.nextElement();
          Enumeration<InetAddress> addresses=iface.getInetAddresses();
          while (addresses.hasMoreElements()) {
            InetAddress address=addresses.nextElement();
            if (address instanceof Inet6Address) {
              if (!address.isAnyLocalAddress() && !address.isLinkLocalAddress() && !address.isSiteLocalAddress()&& !address.isLoopbackAddress()) {
                return address;
              }
            }
          }
        }
      }
 else       localHost=InetAddress.getLocalHost();
    }
 catch (    Exception ex) {
      logger.warn("Failed to get localhost ",ex);
    }
  }
  return localHost;
}
