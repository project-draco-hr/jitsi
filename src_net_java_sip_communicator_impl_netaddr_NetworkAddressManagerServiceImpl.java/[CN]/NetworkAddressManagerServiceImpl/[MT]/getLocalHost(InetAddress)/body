{
  InetAddress localHost=null;
  if (logger.isTraceEnabled()) {
    logger.trace("Querying a localhost addr for dst=" + intendedDestination);
  }
  if (System.getProperty("os.name").startsWith("Windows")) {
    try {
      localHost=Win32LocalhostRetriever.getSourceForDestination(intendedDestination);
    }
 catch (    Exception e) {
      logger.warn("Failed to get localhost ",e);
    }
  }
 else {
    localHostFinderSocket.connect(intendedDestination,RANDOM_ADDR_DISC_PORT);
    localHost=localHostFinderSocket.getLocalAddress();
    localHostFinderSocket.disconnect();
  }
  if (logger.isTraceEnabled()) {
    logger.trace("Will return the following localhost address: " + localHost);
  }
  return localHost;
}
