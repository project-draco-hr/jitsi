{
  boolean showSystem;
synchronized (showSystemBundlesSync) {
    showSystem=showSystemBundles;
  }
  if (bundleContext.getBundles() == null)   return 0;
 else {
    if (showSystem)     return bundleContext.getBundles().length;
 else {
      int bundlesSize=0;
      Bundle[] bundles=PluginManagerActivator.bundleContext.getBundles();
      for (int i=0; i < bundles.length; i++) {
        Bundle bundle=bundles[i];
        Object sysBundleProp=bundle.getHeaders().get("System-Bundle");
        if (sysBundleProp == null || !sysBundleProp.equals("yes"))         bundlesSize++;
      }
      return bundlesSize;
    }
  }
}
