{
  ChatRoom sourceChatRoom=evt.getChatRoom();
  ChatRoomsList chatRoomsList=mainFrame.getChatRoomsListPanel().getChatRoomsList();
  ChatRoomWrapper chatRoomWrapper=chatRoomsList.findChatRoomWrapperFromChatRoom(sourceChatRoom);
  if (evt.getEventType().equals(LocalUserChatRoomPresenceChangeEvent.LOCAL_USER_JOINED)) {
    if (chatRoomWrapper != null) {
      chatRoomsList.refresh();
      ConferenceChatPanel chatPanel=(ConferenceChatPanel)chatWindowManager.getMultiChat(chatRoomWrapper);
      if (chatWindowManager.isChatOpenedForChatRoom(chatRoomWrapper)) {
        chatPanel.loadChatRoom(sourceChatRoom);
      }
 else {
        chatWindowManager.openChat(chatPanel,true);
      }
    }
    if (sourceChatRoom.isSystem()) {
      MultiUserChatServerWrapper serverWrapper=chatRoomsList.findServerWrapperFromProvider(sourceChatRoom.getParentProvider());
      serverWrapper.setSystemRoom(sourceChatRoom);
    }
    sourceChatRoom.addMessageListener(this);
  }
 else   if (evt.getEventType().equals(LocalUserChatRoomPresenceChangeEvent.LOCAL_USER_JOIN_FAILED)) {
    new ErrorDialog(mainFrame,Messages.getI18NString("failedToJoinChatRoom",new String[]{sourceChatRoom.getName()}).getText() + evt.getReason(),Messages.getI18NString("error").getText()).showDialog();
  }
 else   if (evt.getEventType().equals(LocalUserChatRoomPresenceChangeEvent.LOCAL_USER_LEFT)) {
    ChatWindowManager chatWindowManager=mainFrame.getChatWindowManager();
    if (chatWindowManager.isChatOpenedForChatRoom(chatRoomWrapper)) {
      ChatPanel chatPanel=chatWindowManager.getMultiChat(chatRoomWrapper);
      chatWindowManager.closeChat(chatPanel);
    }
    mainFrame.getChatRoomsListPanel().getChatRoomsList().refresh();
    sourceChatRoom.removeMessageListener(this);
  }
 else   if (evt.getEventType().equals(LocalUserChatRoomPresenceChangeEvent.LOCAL_USER_KICKED)) {
    ChatWindowManager chatWindowManager=mainFrame.getChatWindowManager();
    if (chatWindowManager.isChatOpenedForChatRoom(chatRoomWrapper)) {
      ChatPanel chatPanel=chatWindowManager.getMultiChat(chatRoomWrapper);
      chatWindowManager.closeChat(chatPanel);
    }
    mainFrame.getChatRoomsListPanel().getChatRoomsList().refresh();
    sourceChatRoom.removeMessageListener(this);
  }
 else   if (evt.getEventType().equals(LocalUserChatRoomPresenceChangeEvent.LOCAL_USER_DROPPED)) {
    ChatWindowManager chatWindowManager=mainFrame.getChatWindowManager();
    if (chatWindowManager.isChatOpenedForChatRoom(chatRoomWrapper)) {
      ChatPanel chatPanel=chatWindowManager.getMultiChat(chatRoomWrapper);
      chatWindowManager.closeChat(chatPanel);
    }
    mainFrame.getChatRoomsListPanel().getChatRoomsList().refresh();
    sourceChatRoom.removeMessageListener(this);
  }
}
