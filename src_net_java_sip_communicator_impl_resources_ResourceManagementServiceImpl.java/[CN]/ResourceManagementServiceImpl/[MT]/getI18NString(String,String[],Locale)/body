{
  Map<String,String> stringResources;
  if ((locale != null) && locale.equals(languageLocale)) {
    stringResources=languageResources;
  }
 else {
    stringResources=(languagePack == null) ? null : languagePack.getResources(locale);
  }
  String resourceString=(stringResources == null) ? null : stringResources.get(key);
  if (resourceString == null) {
    logger.warn("Missing resource for key: " + key);
    return '!' + key + '!';
  }
  int mnemonicIndex=resourceString.indexOf('&');
  if (mnemonicIndex == 0 || (mnemonicIndex > 0 && resourceString.charAt(mnemonicIndex - 1) != '\\')) {
    String firstPart=resourceString.substring(0,mnemonicIndex);
    String secondPart=resourceString.substring(mnemonicIndex + 1);
    resourceString=firstPart.concat(secondPart);
  }
  if (resourceString.indexOf('\\') > -1) {
    resourceString=resourceString.replaceAll("\\\\","");
  }
  if (params != null)   resourceString=MessageFormat.format(resourceString,(Object[])params);
  return resourceString;
}
