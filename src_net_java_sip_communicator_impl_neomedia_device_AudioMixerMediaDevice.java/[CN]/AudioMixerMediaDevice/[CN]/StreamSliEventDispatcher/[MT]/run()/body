{
  stopped=false;
  while (!stopped) {
    byte[] dataToProcess=null;
synchronized (this) {
      boolean interrupted=false;
      while (data == null)       try {
        wait();
      }
 catch (      InterruptedException ie) {
        interrupted=true;
      }
      if (interrupted)       Thread.currentThread().interrupt();
      dataToProcess=data;
      data=null;
    }
    if (dataToProcess != null) {
      int newLevel=SoundLevelIndicatorEffect.calculateCurrentSignalPower(dataToProcess,0,dataToProcess.length,SoundLevelChangeEvent.MAX_LEVEL,SoundLevelChangeEvent.MIN_LEVEL,lastLevel);
      Map<Long,Integer> lev=new HashMap<Long,Integer>();
      MediaStream parentStream=deviceSession.getParentStream();
      lev.put(parentStream.getRemoteSourceID(),newLevel);
      SoundLevelChangeEvent soundLevelEvent=new SoundLevelChangeEvent(parentStream,lev);
      List<SoundLevelListener> listeners;
synchronized (stSoundLevelListeners) {
        listeners=new ArrayList<SoundLevelListener>(stSoundLevelListeners);
      }
      for (      SoundLevelListener listener : listeners)       listener.soundLevelChanged(soundLevelEvent);
      lastLevel=newLevel;
    }
  }
}
