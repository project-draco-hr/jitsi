{
  int k;
  int in_tmp, out_tmp, state;
  state=S[S_offset + 0];
  for (k=0; k < len; k++) {
    in_tmp=(768 * in[in_offset + k]);
    out_tmp=state + in_tmp;
    state=in_tmp - (out_tmp >> 1);
    out[out_offset + k]=out_tmp;
  }
  S[S_offset + 0]=state;
}
