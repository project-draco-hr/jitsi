{
  ServiceReference[] serRefs=null;
  String osgiFilter="(" + ProtocolProviderFactory.PROTOCOL_PROPERTY_NAME + "="+ ProtocolNames.ICQ+ ")";
  try {
    serRefs=IcqSlickFixture.bc.getServiceReferences(ProtocolProviderFactory.class.getName(),osgiFilter);
  }
 catch (  InvalidSyntaxException ex) {
    fail(osgiFilter + " is not a valid osgi filter");
  }
  assertTrue("Failed to find an provider factory service for protocol ICQ",serRefs != null || serRefs.length > 0);
  accManager=(ProtocolProviderFactory)IcqSlickFixture.bc.getService(serRefs[0]);
  ourAccountID=System.getProperty(IcqProtocolProviderSlick.TESTED_IMPL_ACCOUNT_ID_PROP_NAME);
  ServiceReference[] icqProviderRefs=bc.getServiceReferences(ProtocolProviderService.class.getName(),"(&" + "(" + ProtocolProviderFactory.PROTOCOL_PROPERTY_NAME + "="+ ProtocolNames.ICQ+ ")"+ "("+ ProtocolProviderFactory.ACCOUNT_ID_PROPERTY_NAME+ "="+ ourAccountID+ ")"+ ")");
  assertNotNull("No Protocol Provider was found for ICQ UIN:" + ourAccountID,icqProviderRefs);
  assertTrue("No Protocol Provider was found for ICQ UIN:" + ourAccountID,icqProviderRefs.length > 0);
  icqServiceRef=icqProviderRefs[0];
  provider=(ProtocolProviderService)bc.getService(icqServiceRef);
}
