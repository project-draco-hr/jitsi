{
  PresenceStatus contactStatus=((ContactListModel)contactList.getModel()).getMetaContactStatus(this.contactItem);
  ChatWindow chatWindow;
  if (!Constants.TABBED_CHAT_WINDOW) {
    if (chatWindows.containsKey(this.contactItem)) {
      chatWindow=(ChatWindow)chatWindows.get(this.contactItem);
      if (chatWindow.isVisible()) {
        if (chatWindow.getState() == JFrame.ICONIFIED)         chatWindow.setState(JFrame.NORMAL);
        chatWindow.toFront();
      }
 else       chatWindow.setVisible(true);
    }
 else {
      chatWindow=new ChatWindow(mainFrame);
      chatWindows.put(this.contactItem,chatWindow);
      ChatPanel chatPanel=chatWindow.createChat(this.contactItem,contactStatus,protocolContact);
      chatPanel.loadHistory();
      chatWindow.addChat(chatPanel);
      chatWindow.pack();
      chatWindow.setVisible(true);
      chatWindow.getCurrentChatPanel().requestFocusInWriteArea();
    }
  }
 else {
    if (chatWindows.isEmpty()) {
      chatWindow=new ChatWindow(mainFrame);
      chatWindows.put(contactItem,chatWindow);
    }
 else {
      chatWindow=(ChatWindow)chatWindows.elements().nextElement();
    }
    if (!chatWindow.containsContactChat(this.contactItem)) {
      ChatPanel chatPanel=chatWindow.createChat(this.contactItem,contactStatus,protocolContact);
      chatPanel.loadHistory();
      chatWindow.addChatTab(chatPanel);
      if (chatWindow.getTabCount() > 1) {
        chatWindow.setSelectedContactTab(this.contactItem);
      }
      if (chatWindow.isVisible()) {
        if (chatWindow.getState() == JFrame.ICONIFIED)         chatWindow.setState(JFrame.NORMAL);
        chatWindow.toFront();
      }
 else       chatWindow.setVisible(true);
      chatWindow.getCurrentChatPanel().requestFocusInWriteArea();
    }
 else {
      if (chatWindow.getTabCount() > 1) {
        chatWindow.setSelectedContactTab(this.contactItem);
      }
      if (chatWindow.isVisible()) {
        if (chatWindow.getState() == JFrame.ICONIFIED)         chatWindow.setState(JFrame.NORMAL);
        chatWindow.toFront();
      }
 else       chatWindow.setVisible(true);
      chatWindow.getCurrentChatPanel().requestFocusInWriteArea();
    }
  }
}
