{
  MetaContact metaContact=evt.getSourceContact();
  Contact defaultContact=metaContact.getDefaultContact();
  ProtocolProviderService defaultProvider=defaultContact.getProtocolProvider();
  OperationSetBasicInstantMessaging defaultIM=(OperationSetBasicInstantMessaging)defaultProvider.getOperationSet(OperationSetBasicInstantMessaging.class);
  ProtocolProviderService protoContactProvider;
  OperationSetBasicInstantMessaging protoContactIM;
  if (defaultContact.getPresenceStatus().getStatus() < 1 && (!defaultIM.isOfflineMessagingSupported() || !defaultProvider.isRegistered())) {
    Iterator<Contact> protoContacts=metaContact.getContacts();
    while (protoContacts.hasNext()) {
      Contact contact=protoContacts.next();
      protoContactProvider=contact.getProtocolProvider();
      protoContactIM=(OperationSetBasicInstantMessaging)protoContactProvider.getOperationSet(OperationSetBasicInstantMessaging.class);
      if (protoContactIM.isOfflineMessagingSupported() && protoContactProvider.isRegistered()) {
        defaultContact=contact;
      }
    }
  }
  ContactEventHandler contactHandler=mainFrame.getContactHandler(defaultContact.getProtocolProvider());
  contactHandler.contactClicked(defaultContact,evt.getClickCount());
}
