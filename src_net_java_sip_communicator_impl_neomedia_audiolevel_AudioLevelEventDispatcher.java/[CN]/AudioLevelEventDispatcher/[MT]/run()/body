{
  stopped=false;
  SimpleAudioLevelListener listenerToNotify=null;
  while (!stopped) {
    byte[] dataToProcess;
    int dataToProcessLength;
synchronized (this) {
      if (data == null) {
        try {
          wait();
          if (levelListener == null)           continue;
          listenerToNotify=levelListener;
        }
 catch (        InterruptedException iex) {
        }
      }
      dataToProcess=data;
      dataToProcessLength=dataLength;
      data=null;
      dataLength=0;
    }
    if (dataToProcess != null) {
      int newLevel=AudioLevelCalculator.calculateSoundPressureLevel(dataToProcess,0,dataToProcessLength,SimpleAudioLevelListener.MIN_LEVEL,SimpleAudioLevelListener.MAX_LEVEL,lastLevel);
      if ((levelMap != null) && (ssrc != -1))       levelMap.putLevel(ssrc,newLevel);
      if (listenerToNotify != null)       listenerToNotify.audioLevelChanged(newLevel);
      lastLevel=newLevel;
    }
  }
}
