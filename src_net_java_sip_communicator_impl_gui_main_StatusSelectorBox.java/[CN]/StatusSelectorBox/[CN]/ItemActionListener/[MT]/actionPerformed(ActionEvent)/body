{
  if (e.getSource() instanceof JMenuItem) {
    JMenuItem menuItem=(JMenuItem)e.getSource();
    OperationSetPresence presence=mainFrame.getProtocolPresence(protocolProvider);
    Iterator statusSet=presence.getSupportedStatusSet();
    while (statusSet.hasNext()) {
      PresenceStatus status=((PresenceStatus)statusSet.next());
      if (status.getStatusName().equals(menuItem.getText()) && !presence.getPresenceStatus().equals(status)) {
        try {
          if (protocolProvider.isRegistered()) {
            if (status.isOnline()) {
              presence.publishPresenceStatus(status,"");
            }
 else {
              mainFrame.getLoginManager().setManuallyDisconnected(true);
              protocolProvider.unregister();
            }
            setSelected(menuItem.getText(),menuItem.getIcon());
          }
 else {
            lastSelectedStatus=status;
            mainFrame.getLoginManager().login(protocolProvider);
          }
        }
 catch (        IllegalArgumentException e1) {
          logger.error("Error - changing status",e1);
        }
catch (        IllegalStateException e1) {
          logger.error("Error - changing status",e1);
        }
catch (        OperationFailedException e1) {
          if (e1.getErrorCode() == OperationFailedException.GENERAL_ERROR) {
            SIPCommMsgTextArea msgText=new SIPCommMsgTextArea(Messages.getString("statusChangeGeneralError"));
            JOptionPane.showMessageDialog(null,msgText,Messages.getString("generalError"),JOptionPane.ERROR_MESSAGE);
          }
 else           if (e1.getErrorCode() == OperationFailedException.NETWORK_FAILURE) {
            SIPCommMsgTextArea msgText=new SIPCommMsgTextArea(Messages.getString("statusChangeNetworkFailure"));
            JOptionPane.showMessageDialog(null,msgText,Messages.getString("networkFailure"),JOptionPane.ERROR_MESSAGE);
          }
 else           if (e1.getErrorCode() == OperationFailedException.PROVIDER_NOT_REGISTERED) {
            SIPCommMsgTextArea msgText=new SIPCommMsgTextArea(Messages.getString("statusChangeNetworkFailure"));
            JOptionPane.showMessageDialog(null,msgText,Messages.getString("networkFailure"),JOptionPane.ERROR_MESSAGE);
          }
          logger.error("Error - changing status",e1);
        }
        break;
      }
    }
  }
}
