{
  if (e.getSource() instanceof JMenuItem) {
    JMenuItem menuItem=(JMenuItem)e.getSource();
    OperationSetPresence presence=mainFrame.getProtocolPresence(account.getProtocolProvider());
    Iterator statusSet=presence.getSupportedStatusSet();
    while (statusSet.hasNext()) {
      PresenceStatus status=((PresenceStatus)statusSet.next());
      if (status.getStatusName().equals(menuItem.getText()) && !presence.getPresenceStatus().equals(status)) {
        try {
          if (status.equals(IcqStatusEnum.ONLINE)) {
            if (account.getProtocolProvider().isRegistered()) {
              presence.publishPresenceStatus(status,"");
            }
 else {
              account.getProtocolProvider().register(null);
            }
          }
 else           if (status.equals(IcqStatusEnum.OFFLINE)) {
            account.getProtocolProvider().unregister();
          }
 else {
            presence.publishPresenceStatus(status,"");
          }
        }
 catch (        IllegalArgumentException e1) {
          logger.error("Error - changing status",e1);
        }
catch (        IllegalStateException e1) {
          logger.error("Error - changing status",e1);
        }
catch (        OperationFailedException e1) {
          if (e1.getErrorCode() == OperationFailedException.GENERAL_ERROR) {
            JOptionPane.showMessageDialog(null,Messages.getString("statusChangeGeneralError"),Messages.getString("generalError"),JOptionPane.ERROR_MESSAGE);
          }
 else           if (e1.getErrorCode() == OperationFailedException.NETWORK_FAILURE) {
            JOptionPane.showMessageDialog(null,Messages.getString("statusChangeNetworkFailure"),Messages.getString("networkFailure"),JOptionPane.ERROR_MESSAGE);
          }
 else           if (e1.getErrorCode() == OperationFailedException.PROVIDER_NOT_REGISTERED) {
            JOptionPane.showMessageDialog(null,Messages.getString("statusChangeNetworkFailure"),Messages.getString("networkFailure"),JOptionPane.ERROR_MESSAGE);
          }
          logger.error("Error - changing status",e1);
        }
        break;
      }
    }
    setIcon(menuItem.getIcon());
  }
}
