{
  MasterPortAudioStream st=inputStreams.get(deviceIndex);
  if (st == null) {
    st=new MasterPortAudioStream(deviceIndex,sampleRate,channels);
    inputStreams.put(deviceIndex,st);
    boolean echoCancelIsEnabled=isEnabledEchoCancel();
    int outputStreamCount;
    OutputPortAudioStream out;
    if (echoCancelIsEnabled && ((outputStreamCount=outputStreams.size()) > 0))     out=outputStreams.get(outputStreamCount - 1);
 else     out=null;
    st.setParams(out,isEnabledDeNoise(),echoCancelIsEnabled,getFramesPerBuffer(),getFilterLength());
  }
  return new InputPortAudioStream(st);
}
