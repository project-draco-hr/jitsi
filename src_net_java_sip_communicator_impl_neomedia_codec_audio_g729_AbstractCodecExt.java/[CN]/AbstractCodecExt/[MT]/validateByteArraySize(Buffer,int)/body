{
  Object data=buffer.getData();
  byte[] newBytes;
  if (data instanceof byte[]) {
    byte[] bytes=(byte[])data;
    if (bytes.length >= newSize)     return bytes;
    newBytes=new byte[newSize];
    System.arraycopy(bytes,0,newBytes,0,bytes.length);
  }
 else {
    newBytes=new byte[newSize];
    buffer.setLength(0);
    buffer.setOffset(0);
  }
  buffer.setData(newBytes);
  return newBytes;
}
