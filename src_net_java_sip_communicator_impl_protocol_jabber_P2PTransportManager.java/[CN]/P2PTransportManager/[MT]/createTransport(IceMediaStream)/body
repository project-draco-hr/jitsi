{
  GTalkTransportPacketExtension trans=new GTalkTransportPacketExtension();
  if (stream != null) {
    for (    Component component : stream.getComponents()) {
      List<LocalCandidate> candidates=component.getLocalCandidates();
      List<LocalCandidate> candidatesToRemove=null;
      for (      LocalCandidate candidate : candidates) {
        if (candidate instanceof UPNPCandidate) {
          LocalCandidate base=candidate.getBase();
          if (candidatesToRemove == null) {
            candidatesToRemove=new ArrayList<LocalCandidate>(candidates.size());
          }
          candidatesToRemove.add(base);
        }
      }
      if (candidatesToRemove != null) {
        for (        Candidate<?> candidateToRemove : candidatesToRemove)         candidates.remove(candidateToRemove);
      }
      for (      Candidate<?> candidate : candidates)       trans.addCandidate(createCandidate(candidate));
    }
  }
  return trans;
}
