{
  Contact defaultContact=metaContact.getDefaultContact();
  ProtocolProviderService defaultProvider=defaultContact.getProtocolProvider();
  OperationSetBasicInstantMessaging defaultIM=(OperationSetBasicInstantMessaging)defaultProvider.getOperationSet(OperationSetBasicInstantMessaging.class);
  if (defaultContact.getPresenceStatus().getStatus() < 1 && (!defaultIM.isOfflineMessagingSupported() || !defaultProvider.isRegistered())) {
    Iterator<Contact> protoContacts=metaContact.getContacts();
    while (protoContacts.hasNext()) {
      Contact contact=protoContacts.next();
      ProtocolProviderService protoContactProvider=contact.getProtocolProvider();
      OperationSetBasicInstantMessaging protoContactIM=(OperationSetBasicInstantMessaging)protoContactProvider.getOperationSet(OperationSetBasicInstantMessaging.class);
      if (protoContactIM.isOfflineMessagingSupported() && protoContactProvider.isRegistered()) {
        defaultContact=contact;
      }
    }
  }
  return createChat(metaContact,defaultContact,null);
}
