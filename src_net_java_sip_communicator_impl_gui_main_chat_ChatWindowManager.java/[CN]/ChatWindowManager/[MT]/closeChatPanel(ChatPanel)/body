{
  ChatWindow chatWindow=chatPanel.getChatWindow();
  chatWindow.removeChat(chatPanel);
  if (chatWindow.getChatCount() == 0)   disposeChatWindow(chatWindow);
  ChatPanel removedChatPanel;
synchronized (chats) {
    removedChatPanel=(ChatPanel)chats.remove(chatPanel.getChatIdentifier());
  }
  if (removedChatPanel != null) {
    removedChatPanel.dispose();
  }
}
