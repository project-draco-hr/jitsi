{
  if (!SwingUtilities.isEventDispatchThread()) {
    SwingUtilities.invokeLater(new Runnable(){
      public void run(){
        openChat(chatPanel,setSelected);
      }
    }
);
    return;
  }
synchronized (syncChat) {
    ChatWindow chatWindow=chatPanel.getChatWindow();
    if (!chatPanel.isShown())     chatWindow.addChat(chatPanel);
    if (chatWindow.isVisible()) {
      if (chatWindow.getExtendedState() != JFrame.ICONIFIED) {
        if (ConfigurationManager.isAutoPopupNewMessage() || setSelected)         chatWindow.toFront();
      }
 else {
        if (setSelected) {
          chatWindow.setExtendedState(JFrame.NORMAL);
          chatWindow.toFront();
        }
        String chatWindowTitle=chatWindow.getTitle();
        if (!chatWindowTitle.startsWith("*"))         chatWindow.setTitle("*" + chatWindowTitle);
      }
      if (setSelected) {
        chatWindow.setCurrentChatPanel(chatPanel);
      }
 else       if (!chatWindow.getCurrentChatPanel().equals(chatPanel) && chatWindow.getChatTabCount() > 0) {
        chatWindow.highlightTab(chatPanel);
        chatPanel.setCaretToEnd();
      }
    }
 else {
      chatWindow.setVisible(true);
      chatWindow.setCurrentChatPanel(chatPanel);
      chatPanel.setCaretToEnd();
    }
  }
}
