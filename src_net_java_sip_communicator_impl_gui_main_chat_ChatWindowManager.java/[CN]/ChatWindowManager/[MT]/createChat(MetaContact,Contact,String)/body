{
  ChatWindow chatWindow;
  if (Constants.TABBED_CHAT_WINDOW) {
    if (this.chatWindow == null) {
      this.chatWindow=new ChatWindow(mainFrame);
      GuiActivator.getUIService().registerExportedWindow(this.chatWindow);
    }
    chatWindow=this.chatWindow;
  }
 else {
    chatWindow=new ChatWindow(mainFrame);
    this.chatWindow=chatWindow;
  }
  ChatPanel chatPanel=new MetaContactChatPanel(chatWindow,contact,protocolContact);
synchronized (chats) {
    this.chats.put(contact,chatPanel);
  }
  if (escapedMessageID != null)   chatPanel.loadHistory(escapedMessageID);
 else   chatPanel.loadHistory();
  return chatPanel;
}
