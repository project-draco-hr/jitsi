{
  if (call != null) {
    if (isSelected()) {
      boolean startedRecording=false;
      try {
        startedRecording=startRecording();
      }
  finally {
        if (!startedRecording && (recorder != null)) {
          try {
            recorder.stop();
          }
  finally {
            recorder=null;
          }
        }
        setSelected(startedRecording);
      }
      if (startedRecording && (recorder != null)) {
        recorder.addListener(new Recorder.Listener(){
          public void recorderStopped(          Recorder recorder){
            NotificationManager.fireNotification(NotificationManager.CALL_SAVED,resources.getI18NString("plugin.callrecordingconfig.CALL_SAVED"),resources.getI18NString("plugin.callrecordingconfig.CALL_SAVED_TO",new String[]{callFilename}));
          }
        }
);
      }
    }
 else     if (recorder != null) {
      try {
        recorder.stop();
      }
  finally {
        recorder=null;
        setSelected(false);
      }
    }
  }
}
