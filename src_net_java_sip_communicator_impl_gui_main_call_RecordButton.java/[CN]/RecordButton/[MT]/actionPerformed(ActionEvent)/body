{
  if (call != null) {
    OperationSetBasicTelephony<?> telephony=call.getProtocolProvider().getOperationSet(OperationSetBasicTelephony.class);
    if (isSelected()) {
      String savedCallsPath=configuration.getString(Recorder.SAVED_CALLS_PATH);
      if ((savedCallsPath == null) || (savedCallsPath.length() == 0)) {
        callFileChooser.setStartPath(createDefaultFilename(null));
        File selectedFile=callFileChooser.getFileFromDialog();
        if (selectedFile != null) {
          callFilename=selectedFile.getAbsolutePath();
          String callFormat=SoundFileUtils.getExtension(selectedFile);
          if (callFormat != null) {
            configuration.setProperty(Recorder.CALL_FORMAT,callFormat);
          }
        }
 else {
          setSelected(false);
          return;
        }
      }
 else       callFilename=createDefaultFilename(savedCallsPath);
      telephony.startRecording(call,callFilename);
    }
 else {
      telephony.stopRecording(call);
      NotificationManager.fireNotification(NotificationManager.CALL_SAVED,resources.getI18NString("plugin.callrecordingconfig.CALL_SAVED"),resources.getI18NString("plugin.callrecordingconfig.CALL_SAVED_TO",new String[]{callFilename}));
    }
  }
}
