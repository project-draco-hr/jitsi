{
  List<PayloadTypePacketExtension> lst=answer.getPayloadTypes();
  boolean masterStreamSet=true;
  for (  MediaType mediaType : MediaType.values()) {
    String ns=getNamespaceForMediaType(mediaType);
    String mediaName=getNameForMediaType(mediaType);
    MediaFormat format=null;
    HashMap<Byte,Byte> overridePTMapping=new HashMap<Byte,Byte>();
    for (    PayloadTypePacketExtension ext : lst) {
      if (ext.getNamespace().equals(ns)) {
        format=JingleUtils.payloadTypeToMediaFormat(ext,getDynamicPayloadTypes(),overridePTMapping);
        if (format != null)         break;
      }
    }
    if (format == null)     continue;
    addZRTPAdvertisedEncryptions(true,answer,mediaType);
    addSDESAdvertisedEncryptions(true,answer,mediaType);
    StreamConnector connector=transportManager.getStreamConnector(mediaType);
    MediaDevice dev=getDefaultDevice(mediaType);
    if (!isDeviceActive(dev))     continue;
    MediaStreamTarget target=transportManager.getStreamTarget(mediaType);
    List<RTPExtension> rtpExtensions=new ArrayList<RTPExtension>();
    MediaDirection direction=MediaDirection.SENDRECV;
    boolean masterStream=false;
    if (!masterStreamSet) {
      if (MediaType.values().length > 1) {
        if (mediaType.equals(MediaType.AUDIO)) {
          masterStream=true;
          masterStreamSet=true;
        }
      }
 else {
        masterStream=true;
        masterStreamSet=true;
      }
    }
    initStream(mediaName,connector,dev,format,target,direction,rtpExtensions,masterStream);
    MediaStream stream=getStream(mediaType);
    if (stream != null) {
      stream.setPTMappingOverrides(overridePTMapping);
    }
  }
}
