{
  BundleContext context=SipActivator.getBundleContext();
  if (context == null)   throw new NullPointerException("The specified BundleContext was null");
  if (userIDStr == null)   throw new NullPointerException("The specified AccountID was null");
  accountProperties.put(USER_ID,userIDStr);
  if (accountProperties == null)   throw new NullPointerException("The specified property map was null");
  String serverAddress=(String)accountProperties.get(SERVER_ADDRESS);
  if (serverAddress == null)   throw new NullPointerException(serverAddress + " is not a valid ServerAddress");
  AccountID accountID=new SipAccountID(userIDStr,accountProperties,serverAddress);
  if (registeredAccounts.containsKey(accountID))   throw new IllegalStateException("An account for id " + userIDStr + " was already installed!");
  this.storeAccount(SipActivator.getBundleContext(),accountID);
  try {
    accountID=loadAccount(accountProperties);
  }
 catch (  RuntimeException exc) {
    this.removeStoredAccount(SipActivator.getBundleContext(),accountID);
    throw exc;
  }
  return accountID;
}
