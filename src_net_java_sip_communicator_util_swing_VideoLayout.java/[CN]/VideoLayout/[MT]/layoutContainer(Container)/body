{
  List<Component> remotes;
  Component local=getLocal();
  if ((this.remotes.size() > 1) && (local != null)) {
    remotes=new ArrayList<Component>();
    remotes.addAll(this.remotes);
    remotes.add(local);
  }
 else   remotes=this.remotes;
  int remoteCount=remotes.size();
  Dimension parentSize=parent.getSize();
  parentSize.width-=remoteCount * 10;
  if (remoteCount == 1) {
    super.layoutContainer(parent,(local == null) ? Component.CENTER_ALIGNMENT : remoteAlignmentX);
  }
 else   if (remoteCount > 0) {
    int columns=calculateColumnCount(remotes);
    int rows=(remoteCount + columns - 1) / columns;
    Rectangle bounds=new Rectangle(0,0,parentSize.width / columns,parentSize.height / rows);
    int columnsMinus1=columns - 1;
    int i=0;
    for (    Component remote : remotes) {
      bounds.x=(columnsMinus1 - (i % columns)) * bounds.width;
      bounds.y=(i / columns) * bounds.height;
      if (bounds.x > 0)       bounds.x+=((columns - (i % columns)) * 10);
      super.layoutComponent(remote,bounds,Component.CENTER_ALIGNMENT,Component.CENTER_ALIGNMENT);
      i++;
      if (i >= remoteCount)       break;
    }
  }
  if (local != null) {
    if (!remotes.contains(local)) {
      Component remote0=remotes.isEmpty() ? null : remotes.get(0);
      int localX;
      int localY;
      int height=Math.round(parentSize.height * LOCAL_TO_REMOTE_RATIO);
      int width=Math.round(parentSize.width * LOCAL_TO_REMOTE_RATIO);
      if ((remotes.size() == 1) && (remote0 instanceof JLabel)) {
        localX=parentSize.width / 2 - width / 2;
        localY=parentSize.height - height;
        super.layoutComponent(local,new Rectangle(localX,localY,width,height),Component.CENTER_ALIGNMENT,Component.BOTTOM_ALIGNMENT);
      }
 else {
        localX=((remote0 == null) ? 0 : remote0.getX()) + 5;
        localY=parentSize.height - height - 5;
        super.layoutComponent(local,new Rectangle(localX,localY,width,height),Component.LEFT_ALIGNMENT,Component.BOTTOM_ALIGNMENT);
      }
    }
    if (closeButton != null) {
      super.layoutComponent(closeButton,new Rectangle(local.getX() + local.getWidth() - closeButton.getWidth(),local.getY(),closeButton.getWidth(),closeButton.getHeight()),Component.CENTER_ALIGNMENT,Component.CENTER_ALIGNMENT);
    }
  }
  if (canvas != null) {
    canvas.setBounds(0,0,parentSize.width,parentSize.height);
  }
}
