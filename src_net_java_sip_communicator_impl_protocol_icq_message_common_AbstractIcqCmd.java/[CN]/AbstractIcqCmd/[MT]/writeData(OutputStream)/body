{
  ByteArrayOutputStream icqout=new ByteArrayOutputStream();
  ByteArrayOutputStream icqDataOut=new ByteArrayOutputStream();
  icqDataWriter.write(icqDataOut);
  int hdrlen=8;
  int primary=null != icqType ? icqType.getPrimary() : 0;
  int secondary=null != icqType ? icqType.getSecondary() : 0;
  if (0 != secondary) {
    hdrlen=10;
  }
  int length=hdrlen + icqDataOut.size();
  LEBinaryTools.writeUShort(icqout,length);
  LEBinaryTools.writeUInt(icqout,icqUIN);
  LEBinaryTools.writeUShort(icqout,primary);
  LEBinaryTools.writeUShort(icqout,icqID);
  if (0 != secondary) {
    LEBinaryTools.writeUShort(icqout,secondary);
  }
  icqDataOut.writeTo(icqout);
  new Tlv(TYPE_ICQ_DATA,ByteBlock.wrap(icqout.toByteArray())).write(out);
}
