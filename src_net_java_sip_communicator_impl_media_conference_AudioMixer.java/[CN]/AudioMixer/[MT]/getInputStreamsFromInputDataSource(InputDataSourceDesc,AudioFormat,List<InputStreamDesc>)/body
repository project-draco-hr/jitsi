{
  DataSource inputDataSource=inputDataSourceDesc.getEffectiveInputDataSource();
  SourceStream[] inputDataSourceStreams;
  if (inputDataSource instanceof PushBufferDataSource)   inputDataSourceStreams=((PushBufferDataSource)inputDataSource).getStreams();
 else   if (inputDataSource instanceof PullBufferDataSource)   inputDataSourceStreams=((PullBufferDataSource)inputDataSource).getStreams();
 else   if (inputDataSource instanceof TranscodingDataSource)   inputDataSourceStreams=((TranscodingDataSource)inputDataSource).getStreams();
 else   inputDataSourceStreams=null;
  if (inputDataSourceStreams != null) {
    boolean added=false;
    for (    SourceStream inputStream : inputDataSourceStreams) {
      Format inputFormat=getFormat(inputStream);
      if ((inputFormat != null) && matches(inputFormat,outputFormat) && inputStreams.add(new InputStreamDesc(inputStream,inputDataSourceDesc)))       added=true;
    }
    return added;
  }
  Format inputFormat=getFormat(inputDataSource);
  if ((inputFormat != null) && !matches(inputFormat,outputFormat)) {
    if (inputDataSource instanceof PushDataSource) {
      for (      PushSourceStream inputStream : ((PushDataSource)inputDataSource).getStreams())       inputStreams.add(new InputStreamDesc(new PushBufferStreamAdapter(inputStream,inputFormat),inputDataSourceDesc));
      return true;
    }
    if (inputDataSource instanceof PullDataSource) {
      for (      PullSourceStream inputStream : ((PullDataSource)inputDataSource).getStreams())       inputStreams.add(new InputStreamDesc(new PullBufferStreamAdapter(inputStream,inputFormat),inputDataSourceDesc));
      return true;
    }
  }
  return false;
}
