{
  boolean notificationsAreSupported=ServiceDiscoveryManager.getInstanceFor(jabberProvider.getConnection()).includesFeature(NewMailNotificationIQ.NAMESPACE);
  if (!notificationsAreSupported)   return;
  ProviderManager providerManager=ProviderManager.getInstance();
  providerManager.addIQProvider(MailboxIQ.ELEMENT_NAME,MailboxIQ.NAMESPACE,new MailboxIQProvider());
  providerManager.addIQProvider(NewMailNotificationIQ.ELEMENT_NAME,NewMailNotificationIQ.NAMESPACE,new NewMailNotificationProvider());
  jabberProvider.getConnection().addPacketListener(new MailboxIQListener(),new PacketTypeFilter(IQ.class));
  jabberProvider.getConnection().addPacketListener(new NewMailNotificationListener(),new PacketTypeFilter(IQ.class));
  if (opSetPersPresence.getCurrentStatusMessage().equals(JabberStatusEnum.OFFLINE)) {
    return;
  }
  QueryNotifyIQ mailnotification=new QueryNotifyIQ();
  logger.trace("sending mailNotification for acc: " + jabberProvider.getAccountID().getAccountUniqueID());
  jabberProvider.getConnection().sendPacket(mailnotification);
}
