{
  String newMailHeader="You have " + mailboxIQ.getTotalMatched() + " new "+ (mailboxIQ.getTotalMatched() > 1 ? "messages" : "message")+ " in your "+ jabberProvider.getAccountID().getService()+ " <a href='"+ mailboxIQ.getUrl()+ "'>inbox</a>.<br/>";
  StringBuffer message=new StringBuffer(newMailHeader);
  message.append("<table width=100% cellpadding=2 cellspacing=0 ");
  message.append("border=0 bgcolor=#e8eef7>");
  Iterator<MailThreadInfo> threads=mailboxIQ.threads();
  String maxThreadsStr=(String)JabberActivator.getConfigurationService().getProperty(PNAME_MAX_GMAIL_THREADS_PER_NOTIFICATION);
  int maxThreads=5;
  try {
    if (maxThreadsStr != null)     maxThreads=Integer.parseInt(maxThreadsStr);
  }
 catch (  NumberFormatException e) {
    logger.debug("Failed to parse max threads count: " + maxThreads + ". Going for default.");
  }
  for (int i=0; i < maxThreads && threads.hasNext(); i++) {
    message.append(threads.next().createHtmlDescription());
  }
  message.append("</table><br/><br/>");
  int threadCount=mailboxIQ.getThreadCount();
  if (threadCount > maxThreads) {
    message.append(threadCount - maxThreads + " more unread messages in your " + " <a href='" + mailboxIQ.getUrl() + "'>inbox</a>.<br/>");
  }
  return message.toString();
}
