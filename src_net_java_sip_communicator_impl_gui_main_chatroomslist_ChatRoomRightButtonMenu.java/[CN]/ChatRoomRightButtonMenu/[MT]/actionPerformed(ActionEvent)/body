{
  JMenuItem menuItem=(JMenuItem)e.getSource();
  String itemName=menuItem.getName();
  final ChatRoom chatRoom=chatRoomWrapper.getChatRoom();
  if (itemName.equals("removeChatRoom")) {
    ChatWindowManager chatWindowManager=mainFrame.getChatWindowManager();
    ChatPanel chatPanel=chatWindowManager.getMultiChat(chatRoomWrapper);
    chatWindowManager.closeChat(chatPanel);
    mainFrame.getChatRoomsListPanel().getChatRoomsList().removeChatRoom(chatRoomWrapper);
    if (chatRoom == null)     return;
    new Thread(){
      public void run(){
        chatRoom.leave();
      }
    }
.start();
  }
 else   if (itemName.equals("leaveChatRoom")) {
    if (chatRoom == null) {
      new ErrorDialog(mainFrame,Messages.getI18NString("haveToBeConnectedToLeave").getText(),Messages.getI18NString("warning").getText()).showDialog();
      return;
    }
    new Thread(){
      public void run(){
        chatRoom.leave();
        ChatWindowManager chatWindowManager=mainFrame.getChatWindowManager();
        ChatPanel chatPanel=chatWindowManager.getMultiChat(chatRoomWrapper);
        chatWindowManager.closeChat(chatPanel);
        mainFrame.getChatRoomsListPanel().getChatRoomsList().refresh();
      }
    }
.start();
  }
 else   if (itemName.equals("joinChatRoom")) {
    if (chatRoom == null) {
      new ErrorDialog(mainFrame,Messages.getI18NString("haveToBeConnectedToJoin").getText(),Messages.getI18NString("warning").getText()).showDialog();
      return;
    }
    new Thread(){
      public void run(){
        try {
          chatRoom.join();
        }
 catch (        OperationFailedException e) {
          if (e.getErrorCode() == OperationFailedException.PROVIDER_NOT_REGISTERED) {
            new ErrorDialog(mainFrame,Messages.getI18NString("chatRoomNotConnected",new String[]{chatRoom.getName()}).getText(),Messages.getI18NString("error").getText()).showDialog();
          }
 else           if (e.getErrorCode() == OperationFailedException.SUBSCRIPTION_ALREADY_EXISTS) {
            new ErrorDialog(mainFrame,Messages.getI18NString("chatRoomAlreadyJoined",new String[]{chatRoom.getName()}).getText(),Messages.getI18NString("error").getText()).showDialog();
          }
 else {
            new ErrorDialog(mainFrame,Messages.getI18NString("failedToJoinChatRoom",new String[]{chatRoom.getName()}).getText(),Messages.getI18NString("error").getText()).showDialog();
          }
          logger.error("Failed to join chat room: " + chatRoom.getName(),e);
        }
      }
    }
.start();
  }
}
