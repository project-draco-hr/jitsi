{
  String master=null;
  JPasswordField passwordField=new JPasswordField();
  String inputMsg=CredentialsStorageActivator.getString("plugin.securityconfig.masterpassword.MP_INPUT");
  String errorMsg="<html><font color=\"red\">" + CredentialsStorageActivator.getString("plugin.securityconfig.masterpassword.MP_VERIFICATION_FAILURE_MSG") + "</font></html>";
  boolean correct=true;
  do {
    Object[] msg=null;
    if (correct) {
      msg=new Object[]{inputMsg,passwordField};
    }
 else {
      msg=new Object[]{errorMsg,inputMsg,passwordField};
    }
    passwordField.setText("");
    if (JOptionPane.showOptionDialog(null,msg,CredentialsStorageActivator.getString("plugin.securityconfig.masterpassword.MP_TITLE"),JOptionPane.YES_NO_OPTION,JOptionPane.QUESTION_MESSAGE,null,new String[]{CredentialsStorageActivator.getString("service.gui.OK"),CredentialsStorageActivator.getString("service.gui.CANCEL")},CredentialsStorageActivator.getString("service.gui.OK")) == JOptionPane.YES_OPTION) {
      master=new String(passwordField.getPassword());
      correct=!master.isEmpty() && verifyMasterPassword(master);
    }
 else {
      return null;
    }
  }
 while (!correct);
  return master;
}
