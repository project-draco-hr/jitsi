{
  String body=this.getTextFromWriteArea();
  Message msg=chatRoom.createMessage(body);
  try {
    chatRoom.sendMessage(msg);
  }
 catch (  Exception ex) {
    logger.error("Failed to send message.",ex);
    this.refreshWriteArea();
    this.processMessage(chatRoom.getName(),new Date(System.currentTimeMillis()),Constants.OUTGOING_MESSAGE,msg.getContent());
    this.processMessage(chatRoom.getName(),new Date(System.currentTimeMillis()),Constants.ERROR_MESSAGE,Messages.getI18NString("msgDeliveryInternalError").getText());
  }
}
