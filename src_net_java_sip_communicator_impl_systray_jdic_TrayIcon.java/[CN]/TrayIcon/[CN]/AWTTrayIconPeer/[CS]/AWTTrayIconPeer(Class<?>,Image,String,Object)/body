{
  Constructor<?> constructor;
  try {
    if (popup instanceof JPopupMenu) {
      constructor=clazz.getConstructor(new Class<?>[]{Image.class,String.class});
    }
 else {
      constructor=clazz.getConstructor(new Class<?>[]{Image.class,String.class,PopupMenu.class});
    }
    addActionListener=clazz.getMethod("addActionListener",new Class<?>[]{ActionListener.class});
    addMouseListener=clazz.getMethod("addMouseListener",new Class<?>[]{MouseListener.class});
    messageTypeClass=Class.forName("java.awt.TrayIcon$MessageType");
    displayMessage=clazz.getMethod("displayMessage",new Class<?>[]{String.class,String.class,messageTypeClass});
    setIcon=clazz.getMethod("setImage",new Class<?>[]{Image.class});
    setIconAutoSize=clazz.getMethod("setImageAutoSize",new Class<?>[]{boolean.class});
  }
 catch (  ClassNotFoundException ex) {
    throw new UnsupportedOperationException(ex);
  }
catch (  NoSuchMethodException ex) {
    throw new UnsupportedOperationException(ex);
  }
  try {
    if (popup instanceof JPopupMenu) {
      impl=constructor.newInstance(new Object[]{image,tooltip});
      addMouseListener(new AWTMouseAdapter((JPopupMenu)popup));
    }
 else {
      impl=constructor.newInstance(new Object[]{image,tooltip,popup});
    }
  }
 catch (  IllegalAccessException ex) {
    throw new UnsupportedOperationException(ex);
  }
catch (  InstantiationException ex) {
    throw new UnsupportedOperationException(ex);
  }
catch (  InvocationTargetException ex) {
    Throwable cause=ex.getCause();
    if (cause == null)     throw new UnsupportedOperationException(ex);
    if (cause instanceof IllegalArgumentException)     throw (IllegalArgumentException)cause;
    if (cause instanceof UnsupportedOperationException)     throw (UnsupportedOperationException)cause;
    if (cause instanceof HeadlessException)     throw (HeadlessException)cause;
    if (cause instanceof SecurityException)     throw (SecurityException)cause;
    throw new UnsupportedOperationException(cause);
  }
}
