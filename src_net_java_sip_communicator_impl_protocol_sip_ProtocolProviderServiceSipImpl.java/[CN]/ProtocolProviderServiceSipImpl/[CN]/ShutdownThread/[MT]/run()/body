{
  if (logger.isTraceEnabled())   logger.trace("Killing the SIP Protocol Provider.");
  OperationSetBasicTelephonySipImpl telephony=(OperationSetBasicTelephonySipImpl)getOperationSet(OperationSetBasicTelephony.class);
  telephony.shutdown();
  if (isRegistered()) {
    try {
      ShutdownUnregistrationBlockListener listener=new ShutdownUnregistrationBlockListener();
      addRegistrationStateChangeListener(listener);
      unregister();
      listener.waitForEvent(3000L);
    }
 catch (    OperationFailedException ex) {
      logger.error("Failed to properly unregister before shutting down. " + getAccountID(),ex);
    }
  }
  headerFactory=null;
  messageFactory=null;
  addressFactory=null;
  sipSecurityManager=null;
  connectionAddresses=null;
  connectionTransports=null;
  currentConnectionAddress=null;
  methodProcessors.clear();
  isInitialized=false;
}
