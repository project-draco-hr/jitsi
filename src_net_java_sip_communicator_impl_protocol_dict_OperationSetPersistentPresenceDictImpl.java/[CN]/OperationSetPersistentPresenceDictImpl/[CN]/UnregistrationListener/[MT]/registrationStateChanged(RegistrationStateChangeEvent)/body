{
  if (!evt.getNewState().equals(RegistrationState.UNREGISTERED) && !evt.getNewState().equals(RegistrationState.AUTHENTICATION_FAILED) && !evt.getNewState().equals(RegistrationState.CONNECTION_FAILED)) {
    return;
  }
  Iterator<ContactGroup> groupsIter=getServerStoredContactListRoot().subgroups();
  while (groupsIter.hasNext()) {
    ContactGroupDictImpl group=(ContactGroupDictImpl)groupsIter.next();
    Iterator<Contact> contactsIter=group.contacts();
    while (contactsIter.hasNext()) {
      ContactDictImpl contact=(ContactDictImpl)contactsIter.next();
      PresenceStatus oldContactStatus=contact.getPresenceStatus();
      if (!oldContactStatus.isOnline())       continue;
      contact.setPresenceStatus(DictStatusEnum.OFFLINE);
      fireContactPresenceStatusChangeEvent(contact,contact.getParentContactGroup(),oldContactStatus);
    }
  }
}
