{
  double rms=0;
  int sampleCount=0;
  while (offset < length) {
    double sample=ArrayIOUtils.readShort(samples,offset);
    sample/=Short.MAX_VALUE;
    rms+=sample * sample;
    sampleCount++;
    offset+=2;
  }
  rms=(sampleCount == 0) ? 0 : Math.sqrt(rms / sampleCount);
  double db;
  if (rms > 0)   db=20 * Math.log10(rms / 0.00002);
 else   db=-MAX_SOUND_PRESSURE_LEVEL;
  return ensureLevelRange((int)db,minLevel,maxLevel);
}
