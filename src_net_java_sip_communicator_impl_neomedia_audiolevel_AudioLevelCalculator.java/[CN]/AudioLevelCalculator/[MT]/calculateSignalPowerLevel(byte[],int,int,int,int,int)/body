{
  if (length == 0)   return 0;
  int samplesNumber=length / 2;
  int absoluteMeanSoundLevel=0;
  double levelRatio=MAX_AUDIO_LEVEL / (maxLevel - minLevel) / 16;
  for (int i=0; i < samplesNumber; i++) {
    int tempL=samples[offset++];
    int tempH=samples[offset++];
    int soundLevel=tempH << 8 | (tempL & 255);
    if (soundLevel > MAX_AUDIO_LEVEL)     soundLevel=MAX_AUDIO_LEVEL;
 else     if (soundLevel < MIN_AUDIO_LEVEL)     soundLevel=MIN_AUDIO_LEVEL;
    absoluteMeanSoundLevel+=Math.abs(soundLevel);
  }
  int result=(int)(absoluteMeanSoundLevel / samplesNumber / levelRatio);
  result=ensureLevelRange(result,minLevel,maxLevel);
  result=animateLevel(result,minLevel,maxLevel,lastLevel);
  return result;
}
