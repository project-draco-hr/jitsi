{
  String master=null;
  JPasswordField passwordField=new JPasswordField();
  String inputMsg=resources.getI18NString("plugin.securityconfig.masterpassword.MP_INPUT");
  String errorMsg="<html><font color=\"red\">" + resources.getI18NString("plugin.securityconfig.masterpassword.MP_VERIFICATION_FAILURE_MSG") + "</font></html>";
  boolean correct=true;
  do {
    Object[] msg=null;
    if (correct) {
      msg=new Object[]{inputMsg,passwordField};
    }
 else {
      msg=new Object[]{errorMsg,inputMsg,passwordField};
    }
    passwordField.setText("");
    if (JOptionPane.showOptionDialog(null,msg,resources.getI18NString("plugin.securityconfig.masterpassword.MP_TITLE"),JOptionPane.YES_NO_OPTION,JOptionPane.QUESTION_MESSAGE,null,new String[]{resources.getI18NString("service.gui.OK"),resources.getI18NString("service.gui.CANCEL")},resources.getI18NString("service.gui.OK")) == JOptionPane.YES_OPTION) {
      master=new String(passwordField.getPassword());
      correct=!master.isEmpty() && credentialsStorageService.verifyMasterPassword(master);
    }
 else     return;
  }
 while (!correct);
  showOrHidePasswords();
}
