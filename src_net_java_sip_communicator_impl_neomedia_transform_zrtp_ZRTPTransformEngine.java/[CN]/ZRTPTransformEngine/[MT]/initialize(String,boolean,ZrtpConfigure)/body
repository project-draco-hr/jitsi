{
  BundleContext bc=NeomediaActivator.getBundleContext();
  ServiceReference faServiceReference=bc.getServiceReference(FileAccessService.class.getName());
  FileAccessService faService=(FileAccessService)bc.getService(faServiceReference);
  File file=null;
  try {
    file=faService.getPrivatePersistentFile(zidFilename);
  }
 catch (  Exception e) {
    logger.warn("Failed to create the zid file.");
    if (logger.isDebugEnabled())     logger.debug("Failed to create the zid file.",e);
  }
  String zidFilePath=null;
  try {
    if (file != null)     zidFilePath=file.getAbsolutePath();
  }
 catch (  SecurityException e) {
    if (logger.isDebugEnabled())     logger.debug("Failed to obtain the absolute path of the zid file.",e);
  }
  ZidFile zf=ZidFile.getInstance();
  if (!zf.isOpen()) {
    String fname;
    if (zidFilePath == null) {
      String home=System.getenv("HOME");
      String baseDir=(home != null) ? ((home) + ("/.")) : ".";
      fname=baseDir + "GNUZRTP4J.zid";
      zidFilename=fname;
    }
 else {
      zidFilename=zidFilePath;
    }
    if (zf.open(zidFilename) < 0) {
      return false;
    }
  }
  if (config == null) {
    config=new ZrtpConfigure();
    config.setStandardConfig();
  }
  if (enableParanoidMode) {
    config.setParanoidMode(enableParanoidMode);
  }
  zrtpEngine=new ZRtp(zf.getZid(),this,clientIdString,config,mitmMode);
  if (timeoutProvider == null) {
    timeoutProvider=new TimeoutProvider("ZRTP");
    timeoutProvider.start();
  }
  enableZrtp=autoEnable;
  return true;
}
