{
  try {
    DOMSource domSource=new DOMSource(document);
    TransformerFactory tf=TransformerFactory.newInstance();
    try {
      tf.setAttribute("indent-number",4);
    }
 catch (    Exception e) {
    }
    Transformer serializer=tf.newTransformer();
    if (doctypeSystem != null)     serializer.setOutputProperty(OutputKeys.DOCTYPE_SYSTEM,doctypeSystem);
    if (doctypePublic != null)     serializer.setOutputProperty(OutputKeys.DOCTYPE_PUBLIC,doctypePublic);
    serializer.setOutputProperty("{http://xml.apache.org/xalan}indent-amount","4");
    serializer.setOutputProperty(OutputKeys.ENCODING,"UTF-8");
    serializer.setOutputProperty(OutputKeys.INDENT,"yes");
    serializer.transform(domSource,streamResult);
  }
 catch (  TransformerException ex) {
    logger.error("Error saving configuration file",ex);
    throw new java.io.IOException("Failed to write the configuration file: " + ex.getMessageAndLocation());
  }
catch (  IllegalArgumentException ex) {
    logger.error("Error saving configuration file",ex);
  }
}
