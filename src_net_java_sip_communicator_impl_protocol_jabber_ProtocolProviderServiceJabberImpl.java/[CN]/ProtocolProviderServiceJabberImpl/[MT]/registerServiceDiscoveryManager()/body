{
  String name=System.getProperty("sip-communicator.application.name","SIP Communicator ") + System.getProperty("sip-communicator.version","SVN");
  ServiceDiscoveryManager.setIdentityName(name);
  ServiceDiscoveryManager.setIdentityType("pc");
  discoveryManager=new ScServiceDiscoveryManager(connection,new String[]{"http://jabber.org/protocol/commands"},supportedFeatures.toArray(new String[supportedFeatures.size()]));
  if (isGTalkTesting()) {
    discoveryManager.addExtFeature(CAPS_GTALK_WEB_VOICE);
    discoveryManager.addExtFeature(CAPS_GTALK_WEB_VIDEO);
    discoveryManager.addExtFeature(CAPS_GTALK_WEB_CAMERA);
    discoveryManager.addFeature(URN_GOOGLE_VOICE);
    discoveryManager.addFeature(URN_GOOGLE_VIDEO);
    discoveryManager.addFeature(URN_GOOGLE_CAMERA);
    discoveryManager.addFeature(URN_GOOGLE_TRANSPORT_P2P);
  }
  if (opsetContactCapabilities != null)   opsetContactCapabilities.setDiscoveryManager(discoveryManager);
}
