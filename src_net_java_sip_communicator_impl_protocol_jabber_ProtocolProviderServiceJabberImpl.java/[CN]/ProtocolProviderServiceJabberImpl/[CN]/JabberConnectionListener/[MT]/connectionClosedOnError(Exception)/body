{
  RegistrationState oldConnectionState=currentConnectionState;
  fireRegistrationStateChanged(oldConnectionState,RegistrationState.UNREGISTERED,RegistrationStateChangeEvent.REASON_INTERNAL_ERROR,exception.getLocalizedMessage());
  OperationSetPersistentPresenceJabberImpl opSetPersPresence=(OperationSetPersistentPresenceJabberImpl)getSupportedOperationSets().get(OperationSetPersistentPresence.class.getName());
  opSetPersPresence.fireProviderPresenceStatusChangeEvent(opSetPersPresence.getPresenceStatus(),JabberStatusEnum.OFFLINE);
}
