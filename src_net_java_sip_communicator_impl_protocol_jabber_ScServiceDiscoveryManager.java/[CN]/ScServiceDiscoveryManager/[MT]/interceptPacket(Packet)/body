{
  if ((packet instanceof Presence) && (capsManager != null)) {
    String ver=getEntityCapsVersion();
    CapsPacketExtension caps=new CapsPacketExtension(getExtFeatures(),capsManager.getNode(),CapsPacketExtension.HASH_METHOD,ver);
    discoveryManager.setNodeInformationProvider(caps.getNode() + "#" + caps.getVersion(),this);
    packet.addExtension(caps);
  }
}
