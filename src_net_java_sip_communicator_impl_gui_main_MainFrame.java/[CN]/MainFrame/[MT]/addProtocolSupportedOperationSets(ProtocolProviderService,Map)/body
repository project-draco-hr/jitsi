{
  this.protocolSupportedOperationSets.put(protocolProvider,supportedOperationSets);
  Iterator entrySetIter=supportedOperationSets.entrySet().iterator();
  for (int i=0; i < supportedOperationSets.size(); i++) {
    Map.Entry entry=(Map.Entry)entrySetIter.next();
    Object key=entry.getKey();
    Object value=entry.getValue();
    if (key.equals(OperationSetPersistentPresence.class.getName()) || key.equals(OperationSetPresence.class.getName())) {
      OperationSetPresence presence=(OperationSetPresence)value;
      this.protocolPresenceSets.put(protocolProvider,presence);
      presence.addProviderPresenceStatusListener(new ProviderPresenceStatusAdapter());
      presence.addContactPresenceStatusListener(new ContactPresenceStatusAdapter());
      try {
        presence.publishPresenceStatus(IcqStatusEnum.ONLINE,"");
      }
 catch (      OperationFailedException e) {
        logger.error("Publish presence status failed.",e);
      }
      this.getStatusPanel().stopConnecting(protocolProvider);
      this.statusPanel.setSelectedStatus(protocolProvider,Constants.ONLINE_STATUS);
      this.tabbedPane.getContactListPanel().getContactList().requestFocus();
    }
 else     if (key.equals(OperationSetBasicInstantMessaging.class.getName()) || key.equals(OperationSetPresence.class.getName())) {
      OperationSetBasicInstantMessaging im=(OperationSetBasicInstantMessaging)value;
      this.imOperationSets.put(protocolProvider,im);
      im.addMessageListener(this.getTabbedPane().getContactListPanel());
    }
 else     if (key.equals(OperationSetTypingNotifications.class.getName())) {
      OperationSetTypingNotifications tn=(OperationSetTypingNotifications)value;
      this.tnOperationSets.put(protocolProvider,tn);
      tn.addTypingNotificationsListener(this.getTabbedPane().getContactListPanel());
    }
  }
}
