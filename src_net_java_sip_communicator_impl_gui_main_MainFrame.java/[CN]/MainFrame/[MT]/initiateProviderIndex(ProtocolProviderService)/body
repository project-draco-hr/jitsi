{
  ConfigurationService configService=GuiActivator.getConfigurationService();
  String prefix="net.java.sip.communicator.impl.ui.accounts";
  List accounts=configService.getPropertyNamesByPrefix(prefix,true);
  Iterator accountsIter=accounts.iterator();
  boolean savedAccount=false;
  while (accountsIter.hasNext()) {
    String accountRootPropName=(String)accountsIter.next();
    String accountUID=configService.getString(accountRootPropName);
    if (accountUID.equals(protocolProvider.getAccountID().getAccountUniqueID())) {
      savedAccount=true;
      String index=configService.getString(accountRootPropName + ".accountIndex");
      if (index != null) {
        return new Integer(index).intValue();
      }
 else {
        int accountIndex=createAccountIndex(protocolProvider,accountRootPropName);
        return accountIndex;
      }
    }
  }
  if (!savedAccount) {
    String accNodeName="acc" + Long.toString(System.currentTimeMillis());
    String accountPackage="net.java.sip.communicator.impl.ui.accounts." + accNodeName;
    configService.setProperty(accountPackage,protocolProvider.getAccountID().getAccountUniqueID());
    int accountIndex=createAccountIndex(protocolProvider,accountPackage);
    return accountIndex;
  }
  return -1;
}
