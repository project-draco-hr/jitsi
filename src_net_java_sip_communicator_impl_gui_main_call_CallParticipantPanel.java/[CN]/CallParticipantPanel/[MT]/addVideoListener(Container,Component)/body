{
  final Call call=callParticipant.getCall();
  if (call == null)   return;
  final OperationSetVideoTelephony telephony=(OperationSetVideoTelephony)call.getProtocolProvider().getOperationSet(OperationSetVideoTelephony.class);
  if (telephony == null)   return;
  final VideoListener videoListener=new VideoListener(){
    public void videoAdded(    VideoEvent event){
      handleVideoEvent(telephony,videoContainer,noVideoComponent);
    }
    public void videoRemoved(    VideoEvent event){
      handleVideoEvent(telephony,videoContainer,noVideoComponent);
    }
  }
;
  CallChangeListener callListener=new CallChangeListener(){
    private boolean videoListenerIsAdded;
    private void addVideoListener(){
      telephony.addVideoListener(callParticipant,videoListener);
      videoListenerIsAdded=true;
      handleVideoEvent(telephony,videoContainer,noVideoComponent);
    }
    public synchronized void callParticipantAdded(    CallParticipantEvent event){
      if (callParticipant.equals(event.getSourceCallParticipant()) && !videoListenerIsAdded) {
        Call call=callParticipant.getCall();
        if ((call != null) && CallState.CALL_IN_PROGRESS.equals(call.getCallState()))         addVideoListener();
      }
    }
    public synchronized void callParticipantRemoved(    CallParticipantEvent event){
      if (callParticipant.equals(event.getSourceCallParticipant()) && videoListenerIsAdded) {
        Call call=callParticipant.getCall();
        if (call != null)         removeVideoListener();
      }
    }
    public synchronized void callStateChanged(    CallChangeEvent event){
      CallState newCallState=(CallState)event.getNewValue();
      if (CallState.CALL_ENDED.equals(newCallState)) {
        if (videoListenerIsAdded)         removeVideoListener();
        call.removeCallChangeListener(this);
      }
 else       if (CallState.CALL_IN_PROGRESS.equals(newCallState)) {
        if (!videoListenerIsAdded)         addVideoListener();
      }
    }
    private void removeVideoListener(){
      telephony.removeVideoListener(callParticipant,videoListener);
      videoListenerIsAdded=false;
    }
  }
;
  call.addCallChangeListener(callListener);
  callListener.callStateChanged(new CallChangeEvent(call,CallChangeEvent.CALL_STATE_CHANGE,null,call.getCallState()));
}
