{
  CaptureDevice captureDevice=null;
  if (getDirection().allowsSending()) {
    if (captureDeviceSharing == null) {
      String protocol=getCaptureDeviceInfoLocatorProtocol();
      boolean createCaptureDeviceIfNull=true;
      if ("javasound".equalsIgnoreCase(protocol) || PortAudioAuto.LOCATOR_PROTOCOL.equalsIgnoreCase(protocol)) {
        captureDevice=super.createCaptureDevice();
        createCaptureDeviceIfNull=false;
        if (captureDevice != null) {
          captureDeviceSharing=createCaptureDeviceSharing(captureDevice);
          captureDevice=captureDeviceSharing.createOutputDataSource();
        }
      }
      if ((captureDevice == null) && createCaptureDeviceIfNull)       captureDevice=super.createCaptureDevice();
    }
 else     captureDevice=captureDeviceSharing.createOutputDataSource();
  }
  return captureDevice;
}
