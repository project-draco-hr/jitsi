{
  CaptureDevice captureDevice=null;
  if (getDirection().allowsSending()) {
    if (captureDeviceSharing == null) {
      CaptureDeviceInfo captureDeviceInfo=getCaptureDeviceInfo();
      boolean createCaptureDeviceIfNull=true;
      if (captureDeviceInfo != null) {
        MediaLocator locator=captureDeviceInfo.getLocator();
        if ((locator != null) && "javasound".equalsIgnoreCase(locator.getProtocol())) {
          captureDevice=super.createCaptureDevice();
          createCaptureDeviceIfNull=false;
          if (captureDevice != null) {
            captureDeviceSharing=createCaptureDeviceSharing(captureDevice);
            captureDevice=captureDeviceSharing.createOutputDataSource();
          }
        }
      }
      if ((captureDevice == null) && createCaptureDeviceIfNull)       captureDevice=super.createCaptureDevice();
    }
 else     captureDevice=captureDeviceSharing.createOutputDataSource();
  }
  return captureDevice;
}
