{
  CaptureDevice captureDevice=null;
  if (getDirection().allowsSending()) {
    if (captureDeviceSharing == null) {
      String protocol=getCaptureDeviceInfoLocatorProtocol();
      boolean createCaptureDeviceIfNull=true;
      if (AudioSystem.LOCATOR_PROTOCOL_JAVASOUND.equalsIgnoreCase(protocol) || AudioSystem.LOCATOR_PROTOCOL_PORTAUDIO.equalsIgnoreCase(protocol)) {
        captureDevice=superCreateCaptureDevice();
        createCaptureDeviceIfNull=false;
        if (captureDevice != null) {
          captureDeviceSharing=createCaptureDeviceSharing(captureDevice);
          captureDevice=captureDeviceSharing.createOutputDataSource();
        }
      }
      if ((captureDevice == null) && createCaptureDeviceIfNull)       captureDevice=superCreateCaptureDevice();
    }
 else     captureDevice=captureDeviceSharing.createOutputDataSource();
  }
  return captureDevice;
}
