{
  boolean transferData=false;
synchronized (dataSyncRoot) {
    if (!automaticallyDropsLateVideoFrames && (data != null)) {
      if (nextData != null) {
        bufferPool.returnFreeBuffer(nextData);
        nextData=null;
      }
      nextData=bufferPool.getFreeBuffer(length);
      if (nextData != null) {
        nextData.setLength(DSCaptureDevice.getBytes(ptr,nextData.ptr,nextData.capacity));
        nextDataTimeStamp=System.nanoTime();
      }
      return;
    }
    if (data != null) {
      bufferPool.returnFreeBuffer(data);
      data=null;
    }
    data=bufferPool.getFreeBuffer(length);
    if (data != null) {
      data.setLength(DSCaptureDevice.getBytes(ptr,data.ptr,data.capacity));
      dataTimeStamp=System.nanoTime();
    }
    if (nextData != null) {
      bufferPool.returnFreeBuffer(nextData);
      nextData=null;
    }
    if (automaticallyDropsLateVideoFrames)     transferData=(data != null);
 else {
      transferData=false;
      dataSyncRoot.notifyAll();
    }
  }
  if (transferData) {
    BufferTransferHandler transferHandler=this.transferHandler;
    if (transferHandler != null)     transferHandler.transferData(this);
  }
}
