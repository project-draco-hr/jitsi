{
synchronized (dataSyncRoot) {
    if (data == null) {
      buffer.setLength(0);
      return;
    }
    Format bufferFormat=buffer.getFormat();
    if (bufferFormat == null) {
      bufferFormat=getFormat();
      if (bufferFormat != null)       buffer.setFormat(bufferFormat);
    }
    if (bufferFormat instanceof AVFrameFormat) {
      FinalizableAVFrame.read(buffer,bufferFormat,data,bufferPool);
    }
 else {
      Object bufferData=buffer.getData();
      byte[] bufferByteData;
      int dataLength=data.getLength();
      if (bufferData instanceof byte[]) {
        bufferByteData=(byte[])bufferData;
        if (bufferByteData.length < dataLength)         bufferByteData=null;
      }
 else       bufferByteData=null;
      if (bufferByteData == null) {
        bufferByteData=new byte[dataLength];
        buffer.setData(bufferByteData);
      }
      buffer.setLength(dataLength);
      buffer.setOffset(0);
      bufferPool.returnFreeBuffer(data);
    }
    buffer.setFlags(Buffer.FLAG_LIVE_DATA | Buffer.FLAG_SYSTEM_TIME);
    buffer.setTimeStamp(dataTimeStamp);
    data=null;
    if (!automaticallyDropsLateVideoFrames)     dataSyncRoot.notifyAll();
  }
}
