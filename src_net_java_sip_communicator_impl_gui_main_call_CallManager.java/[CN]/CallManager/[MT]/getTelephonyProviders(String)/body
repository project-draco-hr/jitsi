{
  List<ProtocolProviderService> telephonyProviders=new LinkedList<ProtocolProviderService>();
  ProtocolProviderFactory providerFactory=GuiActivator.getProtocolProviderFactory(protocolName);
  if (providerFactory != null) {
    ServiceReference serRef;
    ProtocolProviderService protocolProvider;
    for (    AccountID accountID : providerFactory.getRegisteredAccounts()) {
      serRef=providerFactory.getProviderForAccount(accountID);
      protocolProvider=(ProtocolProviderService)GuiActivator.bundleContext.getService(serRef);
      if (protocolProvider.getOperationSet(OperationSetBasicTelephony.class) != null && protocolProvider.isRegistered()) {
        telephonyProviders.add(protocolProvider);
      }
    }
  }
  return telephonyProviders;
}
