{
  String displayName=null;
  if (!StringUtils.isNullOrEmpty(peerAddress)) {
    Vector<ResolveAddressToDisplayNameContactQueryListener> resolvers=new Vector<ResolveAddressToDisplayNameContactQueryListener>(1,1);
    int index=peerAddress.indexOf("@");
    String peerUserID=(index > -1) ? peerAddress.substring(0,index) : peerAddress;
    peerUserID=Pattern.quote(peerUserID);
    Pattern pattern=Pattern.compile("^(" + peerUserID + "|"+ peerUserID+ "@.*)$");
    for (    ContactSourceService contactSourceService : GuiActivator.getContactSources()) {
      if (!(contactSourceService instanceof ExtendedContactSourceService))       continue;
      ContactQuery query=((ExtendedContactSourceService)contactSourceService).queryContactSource(pattern);
      resolvers.add(new ResolveAddressToDisplayNameContactQueryListener(query));
    }
    long startTime=System.currentTimeMillis();
    long currentTime=startTime;
    long timeout=500;
    while (displayName == null && currentTime - startTime < timeout) {
      for (int i=0; i < resolvers.size() && displayName == null; ++i) {
        ResolveAddressToDisplayNameContactQueryListener resolver=resolvers.get(i);
        if (!resolver.isRunning()) {
          if (resolver.isFound()) {
            displayName=resolver.getResolvedName();
            if (displayName.equals(peerAddress)) {
              displayName=null;
            }
          }
        }
      }
      Thread.yield();
      currentTime=System.currentTimeMillis();
    }
    for (int i=0; i < resolvers.size(); ++i) {
      ResolveAddressToDisplayNameContactQueryListener resolver=resolvers.get(i);
      if (resolver.isRunning()) {
        resolver.stop();
      }
    }
  }
  return displayName;
}
