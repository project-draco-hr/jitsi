{
  String displayName=null;
  if (!StringUtils.isNullOrEmpty(peerAddress)) {
    Vector<ResolveAddressToDisplayNameContactQueryListener> resolvers=new Vector<ResolveAddressToDisplayNameContactQueryListener>(1,1);
    int index=peerAddress.indexOf("@");
    String peerUserID=(index > -1) ? peerAddress.substring(0,index) : peerAddress;
    String quotedPeerUserID=Pattern.quote(peerUserID);
    Pattern pattern=Pattern.compile("^(" + quotedPeerUserID + "|"+ quotedPeerUserID+ "@.*)$");
    for (    ContactSourceService css : GuiActivator.getContactSources()) {
      ContactQuery query;
      if (css instanceof ExtendedContactSourceService) {
        query=((ExtendedContactSourceService)css).createContactQuery(pattern);
      }
 else {
        query=css.createContactQuery(peerUserID);
      }
      if (query == null)       continue;
      resolvers.add(new ResolveAddressToDisplayNameContactQueryListener(query));
      query.start();
    }
    long startTime=System.currentTimeMillis();
    long currentTime=startTime;
    long timeout=500;
    while (displayName == null && currentTime - startTime < timeout) {
      for (int i=0; i < resolvers.size() && displayName == null; ++i) {
        ResolveAddressToDisplayNameContactQueryListener resolver=resolvers.get(i);
        if (!resolver.isRunning()) {
          if (resolver.isFound()) {
            displayName=resolver.getResolvedName();
            if (displayName.equals(peerAddress)) {
              displayName=null;
            }
          }
        }
      }
      Thread.yield();
      currentTime=System.currentTimeMillis();
    }
    for (int i=0; i < resolvers.size(); ++i) {
      ResolveAddressToDisplayNameContactQueryListener resolver=resolvers.get(i);
      if (resolver.isRunning()) {
        resolver.stop();
      }
    }
  }
  return displayName;
}
