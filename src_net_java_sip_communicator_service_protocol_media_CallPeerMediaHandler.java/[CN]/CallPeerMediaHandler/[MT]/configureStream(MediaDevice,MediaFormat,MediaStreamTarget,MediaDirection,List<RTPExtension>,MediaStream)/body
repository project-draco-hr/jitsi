{
  registerDynamicPTsWithStream(stream);
  registerRTPExtensionsWithStream(rtpExtensions,stream);
  stream.setDevice(device);
  stream.setTarget(target);
  stream.setDirection(direction);
  stream.setFormat(format);
  MediaAwareCall<?,?,?> call=peer.getCall();
  MediaType mediaType=(stream instanceof AudioMediaStream) ? MediaType.AUDIO : MediaType.VIDEO;
  stream.setRTPTranslator(call.getRTPTranslator(mediaType));
switch (mediaType) {
case AUDIO:
    setAudioStream((AudioMediaStream)stream);
  registerAudioLevelListeners(audioStream);
break;
case VIDEO:
setVideoStream((VideoMediaStream)stream);
break;
}
if (call.isDefaultEncrypted()) {
SrtpControl srtpControl=stream.getSrtpControl();
srtpControl.setSrtpListener(srtpListener);
srtpControl.start(MediaType.AUDIO.equals(mediaType));
}
return stream;
}
