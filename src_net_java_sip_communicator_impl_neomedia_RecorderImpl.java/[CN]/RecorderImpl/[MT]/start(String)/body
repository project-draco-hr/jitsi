{
  if (this.sink == null) {
    if (filename == null)     throw new NullPointerException("filename");
    int extensionBeginIndex=filename.lastIndexOf('.');
    if (extensionBeginIndex < 0)     filename+='.' + this.format;
 else     if (extensionBeginIndex == filename.length() - 1)     filename+=this.format;
    DataSource outputDataSource=deviceSession.getOutputDataSource();
    try {
      DataSink sink=Manager.createDataSink(outputDataSource,new MediaLocator("file:" + filename));
      sink.open();
      sink.start();
      this.sink=sink;
    }
 catch (    NoDataSinkException ndsex) {
      throw new MediaException("Failed to start recording into file " + filename,ndsex);
    }
  }
}
