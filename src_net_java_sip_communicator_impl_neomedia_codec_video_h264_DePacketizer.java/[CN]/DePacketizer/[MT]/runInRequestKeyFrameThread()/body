{
  while (true) {
synchronized (this) {
      if (requestKeyFrameThread != Thread.currentThread())       break;
      long now=System.currentTimeMillis();
      long timeout;
      if (requestKeyFrame) {
        long nextKeyFrameTime=lastKeyFrameTime + TIME_FROM_KEY_FRAME_TO_REQUEST_KEY_FRAME;
        if (now >= nextKeyFrameTime) {
          long nextRequestKeyFrameTime=lastRequestKeyFrameTime + TIME_BETWEEN_REQUEST_KEY_FRAME;
          if (now >= nextRequestKeyFrameTime) {
            timeout=-1;
          }
 else {
            timeout=nextRequestKeyFrameTime - now;
          }
        }
 else {
          timeout=nextKeyFrameTime - now;
        }
      }
 else {
        timeout=0;
      }
      if (timeout >= 0) {
        try {
          wait(timeout);
        }
 catch (        InterruptedException ie) {
        }
        continue;
      }
    }
    KeyFrameControl keyFrameControl=this.keyFrameControl;
    if (keyFrameControl != null) {
      List<KeyFrameControl.KeyFrameRequester> keyFrameRequesters=keyFrameControl.getKeyFrameRequesters();
      if (keyFrameRequesters != null) {
        for (        KeyFrameControl.KeyFrameRequester keyFrameRequester : keyFrameRequesters) {
          try {
            if (keyFrameRequester.requestKeyFrame())             break;
          }
 catch (          Exception e) {
          }
        }
      }
    }
    lastRequestKeyFrameTime=System.currentTimeMillis();
  }
}
