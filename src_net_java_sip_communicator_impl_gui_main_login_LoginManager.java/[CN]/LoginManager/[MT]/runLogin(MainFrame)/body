{
  Set set=GuiActivator.getProtocolProviderFactories().entrySet();
  Iterator iter=set.iterator();
  while (iter.hasNext()) {
    Map.Entry entry=(Map.Entry)iter.next();
    ProtocolProviderFactory providerFactory=(ProtocolProviderFactory)entry.getValue();
    String protocolName=(String)entry.getKey();
    ArrayList accountsList=providerFactory.getRegisteredAccounts();
    if (accountsList.size() > 0) {
      AccountID accountID;
      ServiceReference serRef;
      ProtocolProviderService protocolProvider;
      for (int i=0; i < accountsList.size(); i++) {
        accountID=(AccountID)accountsList.get(i);
        serRef=providerFactory.getProviderForAccount(accountID);
        protocolProvider=(ProtocolProviderService)GuiActivator.bundleContext.getService(serRef);
        this.mainFrame.addAccount(protocolProvider);
        this.login(protocolProvider);
      }
    }
 else {
      showLoginWindow(parent,protocolName,providerFactory);
    }
  }
}
