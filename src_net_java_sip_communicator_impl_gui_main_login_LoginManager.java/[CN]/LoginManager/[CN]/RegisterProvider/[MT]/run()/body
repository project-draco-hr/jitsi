{
  try {
    protocolProvider.register(secAuth);
  }
 catch (  OperationFailedException ex) {
    int errorCode=ex.getErrorCode();
    String errorMessage="";
    if (errorCode == OperationFailedException.GENERAL_ERROR) {
      logger.error("Provider could not be registered" + " due to the following general error: ",ex);
      errorMessage=Messages.getI18NString("loginGeneralError",new String[]{protocolProvider.getAccountID().getUserID(),protocolProvider.getAccountID().getService()}).getText();
      new ErrorDialog(mainFrame,Messages.getI18NString("error").getText(),errorMessage,ex).showDialog();
    }
 else     if (errorCode == OperationFailedException.INTERNAL_ERROR) {
      logger.error("Provider could not be registered" + " due to the following internal error: ",ex);
      errorMessage=Messages.getI18NString("loginInternalError",new String[]{protocolProvider.getAccountID().getUserID(),protocolProvider.getAccountID().getService()}).getText();
      new ErrorDialog(mainFrame,Messages.getI18NString("error").getText(),errorMessage,ex).showDialog();
    }
 else     if (errorCode == OperationFailedException.NETWORK_FAILURE) {
      logger.error("Provider could not be registered" + " due to a network failure: " + ex);
      errorMessage=Messages.getI18NString("loginNetworkError",new String[]{protocolProvider.getAccountID().getUserID(),protocolProvider.getAccountID().getService()}).getText();
      int result=new MessageDialog(null,Messages.getI18NString("error").getText(),errorMessage,Messages.getI18NString("retry").getText(),false).showDialog();
      if (result == MessageDialog.OK_RETURN_CODE) {
        login(protocolProvider);
      }
    }
 else     if (errorCode == OperationFailedException.INVALID_ACCOUNT_PROPERTIES) {
      logger.error("Provider could not be registered" + " due to an invalid account property: ",ex);
      errorMessage=Messages.getI18NString("loginInvalidPropsError",new String[]{protocolProvider.getAccountID().getUserID(),protocolProvider.getAccountID().getService()}).getText();
      new ErrorDialog(mainFrame,Messages.getI18NString("error").getText(),errorMessage,ex).showDialog();
    }
 else {
      logger.error("Provider could not be registered.",ex);
    }
    mainFrame.getStatusPanel().updateStatus(protocolProvider);
  }
catch (  Throwable ex) {
    logger.error("Failed to register protocol provider. ",ex);
    new ErrorDialog(mainFrame,Messages.getI18NString("error").getText(),Messages.getI18NString("loginGeneralError",new String[]{protocolProvider.getAccountID().getUserID(),protocolProvider.getAccountID().getService()}).getText()).showDialog();
    mainFrame.getStatusPanel().updateStatus(protocolProvider);
  }
}
