{
  if (getPeer().getProtocolProvider().getAccountID().getAccountPropertyBoolean(ProtocolProviderFactory.DEFAULT_ENCRYPTION,true) && getPeer().getCall().isSipZrtpAttribute()) {
    try {
      MediaTypeSrtpControl key=new MediaTypeSrtpControl(mediaType,SrtpControlType.ZRTP);
      SrtpControl scontrol=getSrtpControls().get(key);
      if (scontrol == null) {
        scontrol=SipActivator.getMediaService().createZrtpControl();
        getSrtpControls().put(key,scontrol);
      }
      ZrtpControl zcontrol=(ZrtpControl)scontrol;
      String helloHash=zcontrol.getHelloHash();
      if (helloHash != null && helloHash.length() > 0)       md.setAttribute(SdpUtils.ZRTP_HASH_ATTR,helloHash);
    }
 catch (    SdpException ex) {
      logger.error("Cannot add zrtp-hash to sdp",ex);
    }
  }
}
