{
  if (sTmpDir == null) {
    String tmpDirName=System.getProperty("java.io.tmpdir");
    File tmpDir=File.createTempFile(TEMP_DIR_PREFIX,".tmp",new File(tmpDirName));
    tmpDir.delete();
    File lockFile=new File(tmpDirName,tmpDir.getName() + ".lck");
    lockFile.createNewFile();
    lockFile.deleteOnExit();
    if (!tmpDir.mkdirs()) {
      throw new IOException("Unable to create temporary directory:" + tmpDir.getAbsolutePath());
    }
    sTmpDir=tmpDir;
  }
  return File.createTempFile(prefix,suffix,sTmpDir);
}
