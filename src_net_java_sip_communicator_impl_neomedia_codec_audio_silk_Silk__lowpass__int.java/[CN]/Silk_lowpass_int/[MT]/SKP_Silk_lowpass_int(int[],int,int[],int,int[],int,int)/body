{
  int k;
  int in_tmp, out_tmp, state;
  state=S[S_offset + 0];
  for (k=len; k > 0; k--) {
    in_tmp=in[in_offset++];
    in_tmp-=(in_tmp >> 2);
    out_tmp=state + in_tmp;
    state=in_tmp - (out_tmp >> 1);
    out[out_offset++]=out_tmp;
  }
  S[S_offset + 0]=state;
}
