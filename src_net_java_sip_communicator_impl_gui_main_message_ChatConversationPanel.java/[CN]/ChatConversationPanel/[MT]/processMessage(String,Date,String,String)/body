{
  String chatString="";
  String endHeaderTag="";
  String timeString="";
  Calendar calendar1=Calendar.getInstance();
  Calendar calendar=Calendar.getInstance();
  calendar.setTime(date);
  if ((calendar.get(Calendar.DAY_OF_MONTH) < calendar1.get(Calendar.DAY_OF_MONTH)) && (calendar.get(Calendar.MONTH) <= calendar1.get(Calendar.MONTH)) && (calendar.get(Calendar.YEAR) <= calendar1.get(Calendar.YEAR))) {
    timeString=this.processMonth(calendar.get(Calendar.MONTH) + 1) + " " + this.processTime(calendar.get(Calendar.DAY_OF_MONTH))+ " ";
  }
  if (messageType.equals(Constants.INCOMING_MESSAGE)) {
    this.lastIncomingMsgTimestamp=new Date();
    chatString="<h2>";
    endHeaderTag="</h2>";
    chatString+=timeString + contactName + " at "+ processTime(calendar.get(Calendar.HOUR_OF_DAY))+ ":"+ processTime(calendar.get(Calendar.MINUTE))+ ":"+ processTime(calendar.get(Calendar.SECOND))+ endHeaderTag+ "<DIV>"+ "<PLAINTEXT>"+ processSmilies(processNewLines(processLinks(message)))+ "</PLAINTEXT>"+ "</DIV>";
  }
 else   if (messageType.equals(Constants.OUTGOING_MESSAGE)) {
    chatString="<h3>";
    endHeaderTag="</h3>";
    chatString+=timeString + Messages.getString("me") + " at "+ processTime(calendar.get(Calendar.HOUR_OF_DAY))+ ":"+ processTime(calendar.get(Calendar.MINUTE))+ ":"+ processTime(calendar.get(Calendar.SECOND))+ endHeaderTag+ "<DIV>"+ "<PLAINTEXT>"+ processSmilies(processNewLines(processLinks(message)))+ "</PLAINTEXT>"+ "</DIV>";
  }
 else   if (messageType.equals(Constants.SYSTEM_MESSAGE)) {
    chatString="<h4>";
    endHeaderTag="</h4>";
    chatString+=processTime(calendar.get(Calendar.HOUR_OF_DAY)) + ":" + processTime(calendar.get(Calendar.MINUTE))+ ":"+ processTime(calendar.get(Calendar.SECOND))+ " "+ contactName+ " "+ message+ endHeaderTag;
  }
 else   if (messageType.equals(Constants.HISTORY_INCOMING_MESSAGE)) {
    chatString="<h2>";
    endHeaderTag="</h2>";
    chatString+=timeString + contactName + " at "+ processTime(calendar.get(Calendar.HOUR_OF_DAY))+ ":"+ processTime(calendar.get(Calendar.MINUTE))+ ":"+ processTime(calendar.get(Calendar.SECOND))+ endHeaderTag+ "<DIV style=\"color:#707070;\">"+ "<PLAINTEXT>"+ processSmilies(processNewLines(processLinks(message)))+ "</PLAINTEXT>"+ "</DIV>";
  }
 else   if (messageType.equals(Constants.HISTORY_OUTGOING_MESSAGE)) {
    chatString="<h3>";
    endHeaderTag="</h3>";
    chatString+=timeString + Messages.getString("me") + " at "+ processTime(calendar.get(Calendar.HOUR_OF_DAY))+ ":"+ processTime(calendar.get(Calendar.MINUTE))+ ":"+ processTime(calendar.get(Calendar.SECOND))+ endHeaderTag+ "<DIV style=\"color:#707070;\">"+ "<PLAINTEXT>"+ processSmilies(processNewLines(processLinks(message)))+ "</PLAINTEXT>"+ "</DIV>";
  }
  return chatString;
}
