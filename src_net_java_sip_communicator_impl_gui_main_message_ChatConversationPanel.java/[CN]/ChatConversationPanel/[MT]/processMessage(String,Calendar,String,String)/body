{
  String chatString;
  String endHeaderTag;
  if (messageType.equals(ChatMessage.INCOMING_MESSAGE)) {
    chatString="<h2>";
    endHeaderTag="</h2>";
  }
 else {
    chatString="<h3>";
    endHeaderTag="</h3>";
  }
  chatString+=contactName + " at " + calendar.get(Calendar.HOUR_OF_DAY)+ ":"+ proccessMinutes(calendar.get(Calendar.MINUTE))+ endHeaderTag+ "<DIV>"+ processSmilies(processNewLines(processLinks(message)))+ "</DIV>";
  Element root=this.document.getDefaultRootElement();
  try {
    this.document.insertAfterEnd(root.getElement(root.getElementCount() - 1),chatString);
  }
 catch (  BadLocationException e) {
    e.printStackTrace();
  }
catch (  IOException e) {
    e.printStackTrace();
  }
  this.chatEditorPane.scrollRectToVisible(new Rectangle(chatEditorPane.getX(),chatEditorPane.getHeight() - 1,1,1));
}
