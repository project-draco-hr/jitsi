{
synchronized (this.buffer) {
    if (streamReadException != null) {
      IOException ie=new IOException();
      ie.initCause(streamReadException);
      streamReadException=null;
      throw ie;
    }
 else     if (bufferIsWritten) {
      buffer.copy(this.buffer);
      bufferIsWritten=false;
    }
 else     buffer.setLength(0);
  }
}
