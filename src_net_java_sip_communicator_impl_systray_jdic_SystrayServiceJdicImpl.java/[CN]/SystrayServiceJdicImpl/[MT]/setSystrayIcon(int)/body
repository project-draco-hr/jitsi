{
  if (!checkInitialized())   return;
  String osName=System.getProperty("os.name");
  ImageIcon toChangeSystrayIcon=null;
  if (imageType == SystrayService.SC_IMG_TYPE) {
    if (osName.startsWith("Mac OS X") && TrayMenuFactory.isVisible(menu)) {
      toChangeSystrayIcon=logoIconWhite;
    }
 else {
      toChangeSystrayIcon=logoIcon;
    }
  }
 else   if (imageType == SystrayService.SC_IMG_OFFLINE_TYPE) {
    if (!osName.startsWith("Mac OS X")) {
      toChangeSystrayIcon=logoIconOffline;
    }
  }
 else   if (imageType == SystrayService.SC_IMG_AWAY_TYPE) {
    if (!osName.startsWith("Mac OS X")) {
      toChangeSystrayIcon=logoIconAway;
    }
  }
 else   if (imageType == SystrayService.SC_IMG_FFC_TYPE) {
    if (!osName.startsWith("Mac OS X")) {
      toChangeSystrayIcon=logoIconFFC;
    }
  }
 else   if (imageType == SystrayService.ENVELOPE_IMG_TYPE) {
    if (osName.startsWith("Mac OS X") && TrayMenuFactory.isVisible(menu)) {
      toChangeSystrayIcon=envelopeIconWhite;
    }
 else {
      toChangeSystrayIcon=envelopeIcon;
    }
  }
  if (toChangeSystrayIcon != null) {
    this.trayIcon.setIcon(toChangeSystrayIcon);
    this.currentIcon=toChangeSystrayIcon;
  }
  if (osName.startsWith("Mac OS X")) {
    URL toChangeDockIcon=null;
switch (imageType) {
case SystrayService.SC_IMG_TYPE:
      break;
case SystrayService.SC_IMG_OFFLINE_TYPE:
    toChangeDockIcon=dockIconOffline;
  break;
case SystrayService.SC_IMG_AWAY_TYPE:
toChangeDockIcon=dockIconAway;
break;
case SystrayService.SC_IMG_FFC_TYPE:
toChangeDockIcon=dockIconFFC;
break;
}
try {
if (toChangeDockIcon != null) {
Dock.setDockTileImage(toChangeDockIcon);
}
 else Dock.restoreDockTileImage();
}
 catch (Exception e) {
logger.error("failed to change dock icon",e);
}
}
}
