{
  OperationSetBasicInstantMessaging contactIMOperationSet=this.mainFrame.getProtocolIM(contact.getDefaultContact().getProtocolProvider());
  ChatPanel chatPanel=null;
  if (chatTabbedPane == null) {
    chatPanel=new ChatPanel(this,contactIMOperationSet);
    chatPanel.addContactToChat(contact,status);
    chatTabbedPane=new SIPCommTabbedPane(true);
    chatTabbedPane.addCloseListener(new CloseListener(){
      public void closeOperation(      MouseEvent e){
        int selectedIndex=chatTabbedPane.getOverTabIndex();
        removeContactTab(selectedIndex);
      }
    }
);
    this.getContentPane().add(chatPanel,BorderLayout.CENTER);
    chatPanel.setTabIndex(0);
    this.contactTabsTable.put(contact.getMetaUID(),chatPanel);
    this.setTitle(contact.getDisplayName());
  }
 else {
    PresenceStatus defaultStatus=contact.getDefaultContact().getPresenceStatus();
    if (chatTabbedPane.getTabCount() > 0) {
      chatPanel=new ChatPanel(this,contactIMOperationSet);
      chatPanel.addContactToChat(contact,status);
      chatTabbedPane.addTab(contact.getDisplayName(),new ImageIcon(Constants.getStatusIcon(defaultStatus)),chatPanel);
      chatTabbedPane.getParent().validate();
      chatPanel.setTabIndex(chatTabbedPane.getTabCount() - 1);
      this.contactTabsTable.put(contact.getMetaUID(),chatPanel);
    }
 else {
      ChatPanel firstChatPanel=(ChatPanel)contactTabsTable.elements().nextElement();
      PresenceStatus currentContactStatus=firstChatPanel.getDefaultContact().getDefaultContact().getPresenceStatus();
      chatTabbedPane.addTab(currentChatPanel.getDefaultContact().getDisplayName(),new ImageIcon(Constants.getStatusIcon(currentContactStatus)),currentChatPanel);
      chatPanel=new ChatPanel(this,contactIMOperationSet);
      chatPanel.addContactToChat(contact,status);
      chatTabbedPane.addTab(contact.getDisplayName(),new ImageIcon(Constants.getStatusIcon(defaultStatus)),chatPanel);
      chatPanel.setTabIndex(chatTabbedPane.getTabCount() - 1);
      this.contactTabsTable.put(contact.getMetaUID(),currentChatPanel);
    }
    this.getContentPane().add(chatTabbedPane,BorderLayout.CENTER);
    this.getContentPane().validate();
  }
  return chatPanel;
}
