{
  if (isEscaped) {
    ChatRightButtonMenu chatRightMenu=currentChatPanel.getChatConversationPanel().getRightButtonMenu();
    WritePanelRightButtonMenu writePanelRightMenu=currentChatPanel.getChatWritePanel().getRightButtonMenu();
    JMenu selectedMenu=menusPanel.getMainMenuBar().getSelectedMenu();
    JMenu contactMenu=currentChatPanel.getChatSendPanel().getProtoContactSelectorBox().getMenu();
    MenuSelectionManager menuSelectionManager=MenuSelectionManager.defaultManager();
    if (chatRightMenu.isVisible()) {
      chatRightMenu.setVisible(false);
    }
 else     if (writePanelRightMenu.isVisible()) {
      writePanelRightMenu.setVisible(false);
    }
 else     if (selectedMenu != null || contactMenu.isPopupMenuVisible() || menusPanel.getMainToolBar().hasSelectedMenus()) {
      menuSelectionManager.clearSelectedPath();
    }
 else {
      closeWindow(false);
    }
  }
 else {
    closeWindow(true);
  }
}
