{
  if (!evt.getNewState().equals(RegistrationState.REGISTERED))   return;
  ProtocolProviderService pps=evt.getProvider();
  PresenceStatus status=getLastPresenceStatus(pps);
  if (status == null) {
    status=AccountStatusUtils.getOnlineStatus(pps);
  }
  if (status != null && status.getStatus() >= PresenceStatus.ONLINE_THRESHOLD) {
    publishStatus(pps,status);
  }
}
