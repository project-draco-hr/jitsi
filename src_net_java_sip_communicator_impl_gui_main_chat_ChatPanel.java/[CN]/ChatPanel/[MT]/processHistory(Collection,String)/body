{
  Iterator iterator=historyList.iterator();
  String historyString="";
  while (iterator.hasNext()) {
    Object o=iterator.next();
    if (o instanceof MessageDeliveredEvent) {
      MessageDeliveredEvent evt=(MessageDeliveredEvent)o;
      ProtocolProviderService protocolProvider=evt.getDestinationContact().getProtocolProvider();
      historyString+=processHistoryMessage(getChatWindow().getMainFrame().getAccount(protocolProvider),evt.getTimestamp(),Constants.HISTORY_OUTGOING_MESSAGE,evt.getSourceMessage().getContent());
    }
 else     if (o instanceof MessageReceivedEvent) {
      MessageReceivedEvent evt=(MessageReceivedEvent)o;
      if (!evt.getSourceMessage().getMessageUID().equals(escapedMessageID)) {
        historyString+=processHistoryMessage(evt.getSourceContact().getDisplayName(),evt.getTimestamp(),Constants.HISTORY_INCOMING_MESSAGE,evt.getSourceMessage().getContent());
      }
    }
  }
  conversationPanel.insertMessageAfterStart(historyString);
}
