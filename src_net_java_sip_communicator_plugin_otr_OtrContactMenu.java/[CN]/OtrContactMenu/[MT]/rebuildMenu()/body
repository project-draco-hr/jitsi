{
  this.removeAll();
  OtrPolicy policy=OtrActivator.scOtrEngine.getContactPolicy(contact);
  JMenuItem endOtr=new JMenuItem();
  endOtr.setText(OtrActivator.resourceService.getI18NString("plugin.otr.menu.END_OTR"));
  endOtr.setActionCommand(ACTION_COMMAND_END_OTR);
  endOtr.addActionListener(this);
  JMenuItem startOtr=new JMenuItem();
  startOtr.setText(OtrActivator.resourceService.getI18NString("plugin.otr.menu.START_OTR"));
  startOtr.setEnabled(policy.getEnableManual());
  startOtr.setActionCommand(ACTION_COMMAND_START_OTR);
  startOtr.addActionListener(this);
switch (getSessionStatus()) {
case ENCRYPTED:
    JMenuItem refreshOtr=new JMenuItem();
  refreshOtr.setText(OtrActivator.resourceService.getI18NString("plugin.otr.menu.REFRESH_OTR"));
refreshOtr.setEnabled(policy.getEnableManual());
refreshOtr.setActionCommand(ACTION_COMMAND_REFRESH_OTR);
refreshOtr.addActionListener(this);
JMenuItem authBuddy=new JMenuItem();
authBuddy.setText(OtrActivator.resourceService.getI18NString("plugin.otr.menu.AUTHENTICATE_BUDDY"));
authBuddy.setActionCommand(ACTION_COMMAND_AUTHENTICATE_BUDDY);
authBuddy.addActionListener(this);
this.add(endOtr);
this.add(refreshOtr);
this.add(authBuddy);
break;
case FINISHED:
this.add(endOtr);
this.add(startOtr);
break;
case PLAINTEXT:
this.add(startOtr);
break;
}
JCheckBoxMenuItem cbEnable=new JCheckBoxMenuItem();
cbEnable.setText(OtrActivator.resourceService.getI18NString("plugin.otr.menu.CB_ENABLE"));
cbEnable.setState(policy.getEnableManual());
cbEnable.setActionCommand(ACTION_COMMAND_CB_ENABLE);
cbEnable.addActionListener(this);
JCheckBoxMenuItem cbAlways=new JCheckBoxMenuItem();
cbAlways.setText(OtrActivator.resourceService.getI18NString("plugin.otr.menu.CB_AUTO"));
cbAlways.setEnabled(policy.getEnableManual());
cbAlways.setState(policy.getEnableAlways());
cbAlways.setActionCommand(ACTION_COMMAND_CB_AUTO);
cbAlways.addActionListener(this);
JCheckBoxMenuItem cbRequire=new JCheckBoxMenuItem();
cbRequire.setText(OtrActivator.resourceService.getI18NString("plugin.otr.menu.CB_REQUIRE"));
cbRequire.setEnabled(policy.getEnableManual());
cbRequire.setState(policy.getRequireEncryption());
cbRequire.setActionCommand(ACTION_COMMAND_CB_REQUIRE);
cbRequire.addActionListener(this);
JMenuItem cbReset=new JMenuItem();
cbReset.setText(OtrActivator.resourceService.getI18NString("plugin.otr.menu.CB_RESET"));
cbReset.setActionCommand(ACTION_COMMAND_CB_RESET);
cbReset.addActionListener(this);
this.addSeparator();
this.add(cbEnable);
this.add(cbAlways);
this.add(cbRequire);
this.addSeparator();
this.add(cbReset);
}
