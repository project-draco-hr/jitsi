{
  this.colorLabel=new ColorLabel();
  colorLabel.setPreferredSize(new Dimension(18,18));
  colorLabel.setOpaque(true);
  colorLabel.setBackground(Color.BLACK);
  this.add(colorLabel);
  colorLabel.addMouseListener(new MouseAdapter(){
    @Override public void mousePressed(    MouseEvent event){
      Color newColor=JColorChooser.showDialog(new JColorChooser(),"Choose a colour",colorLabel.getBackground());
      if (newColor != null)       setFontColor(newColor);
      chatEditorPane.requestFocus();
    }
  }
);
  chatEditorPane.addCaretListener(new CaretListener(){
    public void caretUpdate(    CaretEvent e){
      selectColor(StyleConstants.Foreground,colorLabel);
    }
  }
);
  chatEditorPane.addKeyListener(new KeyAdapter(){
    @Override public void keyTyped(    KeyEvent e){
      String chatWritePanelText=chatWritePanel.getText();
      if (chatWritePanelText != null && chatWritePanelText.length() > 0) {
        Color currentColor=(Color)((HTMLEditorKit)chatEditorPane.getEditorKit()).getInputAttributes().getAttribute(StyleConstants.Foreground);
        if (currentColor != null)         colorLabel.setBackground(currentColor);
 else         colorLabel.setBackground(Color.BLACK);
      }
    }
  }
);
  chatEditorPane.addMouseListener(new MouseAdapter(){
    @Override public void mouseClicked(    MouseEvent e){
      selectColor(StyleConstants.Foreground,colorLabel);
    }
  }
);
}
