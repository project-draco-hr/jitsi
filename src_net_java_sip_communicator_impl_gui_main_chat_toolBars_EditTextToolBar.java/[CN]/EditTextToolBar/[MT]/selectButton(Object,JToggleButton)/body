{
  boolean selected=false;
  if (chatEditorPane.getSelectedText() == null) {
    int index=chatEditorPane.getCaretPosition();
    if (index == 0) {
      index=1;
    }
    AttributeSet attributes=((HTMLDocument)chatEditorPane.getDocument()).getCharacterElement(index - 1).getAttributes();
    if (attributes.getAttribute(styleConstant) != null) {
      selected=attributes.containsAttribute(styleConstant,true);
    }
  }
 else {
    int index=chatEditorPane.getSelectionStart();
    if (index < chatEditorPane.getSelectionEnd()) {
      AttributeSet attributes=((HTMLDocument)chatEditorPane.getDocument()).getCharacterElement(index).getAttributes();
      if (attributes.getAttribute(styleConstant) != null) {
        selected=attributes.containsAttribute(styleConstant,true);
      }
    }
    for (index++; index < chatEditorPane.getSelectionEnd(); index++) {
      AttributeSet attributes=((HTMLDocument)chatEditorPane.getDocument()).getCharacterElement(index).getAttributes();
      if (attributes.getAttribute(styleConstant) != null) {
        selected=selected && attributes.containsAttribute(styleConstant,true);
      }
    }
  }
  button.setSelected(selected);
}
