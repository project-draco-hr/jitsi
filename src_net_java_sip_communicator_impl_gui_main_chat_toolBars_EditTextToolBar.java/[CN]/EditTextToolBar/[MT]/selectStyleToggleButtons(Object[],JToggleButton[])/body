{
  if (chatEditorPane.getText().length() < 1)   return;
  if (chatEditorPane.getSelectedText() == null) {
    AttributeSet attributes=((HTMLDocument)chatEditorPane.getDocument()).getCharacterElement(chatEditorPane.getCaretPosition() - 1).getAttributes();
    for (int i=0; i < buttons.length; i++)     buttons[i].setSelected(attributes.containsAttribute(styleConstants[i],true));
  }
 else {
    int selectionStart=chatEditorPane.getSelectionStart();
    int selectionEnd=chatEditorPane.getSelectionEnd();
    HTMLDocument htmlDocument=(HTMLDocument)chatEditorPane.getDocument();
    for (int buttonIndex=0; buttonIndex < buttons.length; buttonIndex++) {
      boolean selected=false;
      Object styleConstant=styleConstants[buttonIndex];
      for (int selectionIndex=selectionStart; selectionIndex < selectionEnd; selectionIndex++) {
        AttributeSet attributes=htmlDocument.getCharacterElement(selectionIndex).getAttributes();
        selected=attributes.containsAttribute(styleConstant,true);
        if (selected)         break;
      }
      buttons[buttonIndex].setSelected(selected);
    }
  }
}
