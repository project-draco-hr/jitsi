{
  String messageFromAddr=message.getFromAddr();
  if ((messageFromAddr == null) || (messageFromAddr.indexOf('@') < 0))   return;
  String subject=message.getSubject();
  try {
    subject=MimeUtility.decodeText(subject);
  }
 catch (  Exception ex) {
    logger.warn("Failed to decode the subject of a new e-mail",ex);
  }
  String messageFrom=message.getFrom();
  Message newMailMessage=new MessageMsnImpl(MessageFormat.format(MsnActivator.getResources().getI18NString("service.gui.NEW_MAIL"),messageFrom,messageFromAddr,subject,""),HTML_MIME_TYPE,DEFAULT_MIME_ENCODING,subject);
  Contact sourceContact=opSetPersPresence.findContactByID(messageFromAddr);
  if (sourceContact == null) {
    if (logger.isDebugEnabled())     logger.debug("received a new mail from an unknown contact: " + messageFrom + " &lt;"+ messageFromAddr+ "&gt;");
    String id=contact.getId();
    Email email=contact.getEmail();
    String displayName=contact.getDisplayName();
    if (id == null)     id=messageFromAddr;
    if (email == null)     email=Email.parseStr(messageFromAddr);
    if (displayName == null)     displayName=messageFrom;
    sourceContact=opSetPersPresence.createVolatileContact(id,email,displayName);
  }
  MessageReceivedEvent msgReceivedEvt=new MessageReceivedEvent(newMailMessage,sourceContact,new Date(),MessageReceivedEvent.SYSTEM_MESSAGE_RECEIVED);
  fireMessageEvent(msgReceivedEvt);
}
