{
  final Dimension dim=Toolkit.getDefaultToolkit().getScreenSize();
  final RGBFormat format=(RGBFormat)currentFormat;
  final int width=(int)format.getSize().getWidth();
  final int height=(int)format.getSize().getHeight();
  Buffer buffer=new Buffer();
  if (desktopInteract == null) {
    try {
      desktopInteract=new DesktopInteractImpl();
    }
 catch (    Exception e) {
      logger.warn("Cannot create DesktopInteract object!");
      started=false;
      return;
    }
  }
  while (started) {
    byte data[]=null;
    BufferedImage scaledScreen=null;
    BufferedImage screen=null;
    screen=desktopInteract.captureScreen();
    scaledScreen=ImageStreamingUtils.getScaledImage(screen,width,height,BufferedImage.TYPE_INT_ARGB);
    data=ImageStreamingUtils.getImageByte(scaledScreen);
    buffer.setData(data);
    buffer.setOffset(0);
    buffer.setLength(data.length);
    buffer.setFormat(currentFormat);
    buffer.setHeader(null);
    buffer.setTimeStamp(System.nanoTime());
    buffer.setSequenceNumber(seqNo);
    buffer.setFlags(Buffer.FLAG_LIVE_DATA | Buffer.FLAG_SYSTEM_TIME);
    seqNo++;
synchronized (syncBuf) {
      buf=buffer;
    }
    if (transferHandler != null) {
      transferHandler.transferData(this);
      Thread.yield();
    }
    screen=null;
    scaledScreen=null;
    data=null;
    try {
      Thread.sleep(100);
    }
 catch (    InterruptedException e) {
    }
  }
  buffer=null;
}
