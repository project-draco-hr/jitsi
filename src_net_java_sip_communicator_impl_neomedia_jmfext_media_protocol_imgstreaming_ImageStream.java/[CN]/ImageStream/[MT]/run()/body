{
  VideoFormat format=(VideoFormat)getFormat();
  Dimension formatSize=format.getSize();
  int width=(int)formatSize.getWidth();
  int height=(int)formatSize.getHeight();
  if (desktopInteract == null) {
    try {
      desktopInteract=new DesktopInteractImpl();
    }
 catch (    Exception e) {
      logger.warn("Cannot create DesktopInteract object!");
      started=false;
      return;
    }
  }
  while (started) {
    byte data[]=null;
    BufferedImage scaledScreen=null;
    BufferedImage screen=null;
    screen=desktopInteract.captureScreen();
    if (OSUtils.IS_LINUX || OSUtils.IS_FREEBSD || OSUtils.IS_WINDOWS) {
      scaledScreen=screen;
    }
 else {
      scaledScreen=ImageStreamingUtils.getScaledImage(screen,width,height,BufferedImage.TYPE_INT_ARGB);
    }
    data=ImageStreamingUtils.getImageBytes(scaledScreen);
synchronized (buf) {
      buf.setData(data);
      buf.setOffset(0);
      buf.setLength(data.length);
      buf.setFormat(format);
      buf.setHeader(null);
      buf.setTimeStamp(System.nanoTime());
      buf.setSequenceNumber(seqNo++);
      buf.setFlags(Buffer.FLAG_LIVE_DATA | Buffer.FLAG_SYSTEM_TIME);
    }
    BufferTransferHandler transferHandler=this.transferHandler;
    if (transferHandler != null) {
      transferHandler.transferData(this);
      Thread.yield();
    }
    screen=null;
    scaledScreen=null;
    data=null;
    try {
      Thread.sleep(100);
    }
 catch (    InterruptedException e) {
    }
  }
}
