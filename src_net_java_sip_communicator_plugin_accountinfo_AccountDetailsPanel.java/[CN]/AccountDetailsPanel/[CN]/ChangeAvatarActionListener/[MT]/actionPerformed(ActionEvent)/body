{
  JFileChooser chooser=new JFileChooser(lastAvatarDir);
  chooser.addChoosableFileFilter(new ImageFilter());
  int returnVal=chooser.showOpenDialog(null);
  if (returnVal == JFileChooser.APPROVE_OPTION) {
    try {
      File file=chooser.getSelectedFile();
      lastAvatarDir=file.getParentFile();
      FileInputStream in=new FileInputStream(file);
      byte buffer[]=new byte[in.available()];
      in.read(buffer);
      if (buffer == null || buffer.length <= 0)       return;
      newAvatarImage=buffer;
      avatarLabel.setIcon(new ImageIcon(getScaledImageInstance(newAvatarImage)));
    }
 catch (    IOException ex) {
      logger.error("Failed to load image.",ex);
    }
  }
}
