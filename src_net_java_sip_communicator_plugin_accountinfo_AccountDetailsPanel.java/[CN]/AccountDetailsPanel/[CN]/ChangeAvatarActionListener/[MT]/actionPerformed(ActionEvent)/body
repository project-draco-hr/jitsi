{
  SipCommFileChooser chooser=GenericFileDialog.create(null,"Change avatar...",SipCommFileChooser.LOAD_FILE_OPERATION,lastAvatarDir.getAbsolutePath());
  chooser.addFilter(new ImageFilter());
  File file=chooser.getFileFromDialog();
  if (file != null) {
    try {
      lastAvatarDir=file.getParentFile();
      FileInputStream in=new FileInputStream(file);
      byte[] buffer;
      try {
        buffer=new byte[in.available()];
        in.read(buffer);
      }
  finally {
        in.close();
      }
      if (buffer == null || buffer.length <= 0)       return;
      newAvatarImage=buffer;
      avatarImageIcon=new ImageIcon(getScaledImageInstance(newAvatarImage));
      avatarLabel.setIcon(avatarImageIcon);
    }
 catch (    IOException ex) {
      logger.error("Failed to load image.",ex);
    }
  }
}
