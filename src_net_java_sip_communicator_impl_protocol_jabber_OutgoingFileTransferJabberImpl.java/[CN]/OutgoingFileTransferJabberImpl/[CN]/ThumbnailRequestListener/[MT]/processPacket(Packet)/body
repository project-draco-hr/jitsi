{
  if (!(packet instanceof ThumbnailIQ))   return;
  ThumbnailIQ thumbnailIQ=(ThumbnailIQ)packet;
  if (thumbnailIQ.getCid() != null && thumbnailIQ.getCid().equals(thumbnailElement.getCid())) {
    ThumbnailedFile thumbnailedFile=(ThumbnailedFile)file;
    ThumbnailIQ thumbnailResponse=new ThumbnailIQ(thumbnailIQ.getTo(),thumbnailIQ.getFrom(),thumbnailIQ.getCid(),thumbnailedFile.getThumbnailMimeType(),thumbnailedFile.getThumbnailData(),IQ.Type.RESULT);
    if (logger.isDebugEnabled())     logger.debug("Send thumbnail response to the receiver: " + thumbnailResponse.toXML());
    protocolProvider.getConnection().sendPacket(thumbnailResponse);
  }
 else {
  }
  if (protocolProvider.getConnection() != null) {
    protocolProvider.getConnection().removePacketListener(this);
  }
}
