{
  JNIEncoder encoder=null;
  SwScaler scaler=null;
  int codecCount=0;
  if (format.getEncoding().equals("h264/rtp") && usePLI) {
    encoder=new JNIEncoder();
    try {
      ((ControlTransformInputStream)rtpConnector.getControlInputStream()).addRTCPFeedbackListener(encoder);
    }
 catch (    Exception e) {
      logger.error("Error cannot get RTCP input stream",e);
    }
    codecCount++;
  }
  if (outputSize != null) {
    scaler=new SwScaler();
    scaler.setOutputSize(outputSize);
    codecCount++;
  }
  Codec[] codecs=new Codec[codecCount];
  codecCount=0;
  if (scaler != null)   codecs[codecCount++]=scaler;
  if (encoder != null)   codecs[codecCount++]=encoder;
  if (codecCount != 0) {
    try {
      trackControl.setCodecChain(codecs);
    }
 catch (    UnsupportedPlugInException upiex) {
      logger.error("Failed to add SwScaler/JNIEncoder to codec chain",upiex);
    }
  }
  return super.setProcessorFormat(trackControl,format);
}
