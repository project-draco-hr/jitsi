{
  MediaLocator audioCaptureDeviceLocator=deviceConfiguration.getAudioCaptureDevice().getLocator();
  if (audioCaptureDeviceLocator == null)   return false;
  try {
    dataSource=Manager.createDataSource(audioCaptureDeviceLocator);
  }
 catch (  NoDataSourceException e) {
    logger.warn("No data source during entropy preparation",e);
    return false;
  }
catch (  IOException e) {
    logger.warn("Got an IO Exception during entropy preparation",e);
    return false;
  }
  FormatControl fc=((CaptureDevice)dataSource).getFormatControls()[0];
  AudioFormat af=(AudioFormat)fc.getFormat();
  int framesToRead=(int)(af.getSampleRate() * NUM_OF_SECONDS);
  int frameSize=(af.getSampleSizeInBits() / 8) * af.getChannels();
  bytesToGather=framesToRead * frameSize;
  bytes20ms=frameSize * (int)(af.getSampleRate() / 50);
  if (dataSource instanceof PullBufferDataSource) {
    audioStream=((PullBufferDataSource)dataSource).getStreams()[0];
  }
 else {
    audioStream=((PushBufferDataSource)dataSource).getStreams()[0];
    ((PushBufferStream)audioStream).setTransferHandler(this);
  }
  return (audioStream != null);
}
