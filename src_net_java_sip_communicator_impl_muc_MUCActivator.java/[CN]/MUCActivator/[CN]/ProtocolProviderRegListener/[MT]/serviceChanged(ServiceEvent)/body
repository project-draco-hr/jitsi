{
  ServiceReference serviceRef=event.getServiceReference();
  if (serviceRef.getBundle().getState() == Bundle.STOPPING) {
    return;
  }
  Object service=bundleContext.getService(serviceRef);
  if (!(service instanceof ProtocolProviderService)) {
    return;
  }
switch (event.getType()) {
case ServiceEvent.REGISTERED:
    handleProviderAdded((ProtocolProviderService)service);
  for (  ChatRoomQuery query : getContactSource().getQueries())   query.addQueryToProviderPresenceListeners((ProtocolProviderService)service);
break;
case ServiceEvent.UNREGISTERING:
handleProviderRemoved((ProtocolProviderService)service);
for (ChatRoomQuery query : getContactSource().getQueries()) query.removeQueryFromProviderPresenceListeners((ProtocolProviderService)service);
break;
}
}
