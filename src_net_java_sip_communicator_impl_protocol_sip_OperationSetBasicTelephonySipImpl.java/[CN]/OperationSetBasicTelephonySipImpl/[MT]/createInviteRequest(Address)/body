{
  CallIdHeader callIdHeader=protocolProvider.getDefaultJainSipProvider().getNewCallId();
  HeaderFactory headerFactory=protocolProvider.getHeaderFactory();
  CSeqHeader cSeqHeader=null;
  try {
    cSeqHeader=headerFactory.createCSeqHeader(1l,Request.INVITE);
  }
 catch (  InvalidArgumentException ex) {
    logger.error("An unexpected erro occurred while" + "constructing the CSeqHeadder",ex);
    throw new OperationFailedException("An unexpected erro occurred while" + "constructing the CSeqHeadder",OperationFailedException.INTERNAL_ERROR,ex);
  }
catch (  ParseException exc) {
    logger.error("An unexpected erro occurred while" + "constructing the CSeqHeadder",exc);
    throw new OperationFailedException("An unexpected erro occurred while" + "constructing the CSeqHeadder",OperationFailedException.INTERNAL_ERROR,exc);
  }
  Header replacesHeader=stripReplacesHeader(toAddress);
  String localTag=ProtocolProviderServiceSipImpl.generateLocalTag();
  FromHeader fromHeader=null;
  ToHeader toHeader=null;
  try {
    fromHeader=headerFactory.createFromHeader(protocolProvider.getOurSipAddress(toAddress),localTag);
    toHeader=headerFactory.createToHeader(toAddress,null);
  }
 catch (  ParseException ex) {
    logger.error("An unexpected erro occurred while" + "constructing the ToHeader",ex);
    throw new OperationFailedException("An unexpected erro occurred while" + "constructing the ToHeader",OperationFailedException.INTERNAL_ERROR,ex);
  }
  ArrayList<ViaHeader> viaHeaders=protocolProvider.getLocalViaHeaders(toAddress);
  MaxForwardsHeader maxForwards=protocolProvider.getMaxForwardsHeader();
  ContactHeader contactHeader=protocolProvider.getContactHeader(toHeader.getAddress());
  Request invite=null;
  try {
    invite=protocolProvider.getMessageFactory().createRequest(toHeader.getAddress().getURI(),Request.INVITE,callIdHeader,cSeqHeader,fromHeader,toHeader,viaHeaders,maxForwards);
  }
 catch (  ParseException ex) {
    logger.error("Failed to create invite Request!",ex);
    throw new OperationFailedException("Failed to create invite Request!",OperationFailedException.INTERNAL_ERROR,ex);
  }
  UserAgentHeader userAgentHeader=protocolProvider.getSipCommUserAgentHeader();
  if (userAgentHeader != null)   invite.addHeader(userAgentHeader);
  invite.addHeader(contactHeader);
  if (replacesHeader != null) {
    invite.setHeader(replacesHeader);
  }
  return invite;
}
