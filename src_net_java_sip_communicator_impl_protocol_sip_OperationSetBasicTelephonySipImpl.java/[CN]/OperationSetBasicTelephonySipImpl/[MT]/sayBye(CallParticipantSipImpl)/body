{
  Dialog dialog=callParticipant.getDialog();
  Request request=callParticipant.getFirstTransaction().getRequest();
  Request bye=null;
  try {
    bye=dialog.createRequest(Request.BYE);
    InetAddress destinationInetAddress=null;
    String host=((SipURI)bye.getRequestURI()).getHost();
    try {
      destinationInetAddress=InetAddress.getByName(host);
    }
 catch (    UnknownHostException ex) {
      throw new IllegalArgumentException(host + " is not a valid internet address " + ex.getMessage());
    }
    ArrayList viaHeaders=protocolProvider.getLocalViaHeaders(destinationInetAddress,protocolProvider.getRegistrarConnection().getRegistrarListeningPoint());
    bye.setHeader((ViaHeader)viaHeaders.get(0));
    bye.addHeader(protocolProvider.getSipCommUserAgentHeader());
  }
 catch (  SipException ex) {
    throwOperationFailedException("Failed to create bye request!",OperationFailedException.INTERNAL_ERROR,ex);
  }
  sendRequest(callParticipant.getJainSipProvider(),bye,dialog);
  try {
    return DialogUtils.processByeThenIsDialogAlive(dialog);
  }
 catch (  SipException ex) {
    throwOperationFailedException("Failed to determine whether the dialog should stay alive.",OperationFailedException.INTERNAL_ERROR,ex);
    return false;
  }
}
