{
  CallSipImpl call=new CallSipImpl(protocolProvider);
  CallPeerSipImpl callParticipant=new CallPeerSipImpl(containingTransaction.getDialog().getRemoteParty(),call);
  boolean incomingCall=(containingTransaction instanceof ServerTransaction);
  callParticipant.setState(incomingCall ? CallPeerState.INCOMING_CALL : CallPeerState.INITIATING_CALL);
  callParticipant.setDialog(containingTransaction.getDialog());
  callParticipant.setFirstTransaction(containingTransaction);
  callParticipant.setJainSipProvider(sourceProvider);
  activeCallsRepository.addCall(call);
  fireCallEvent(incomingCall ? CallEvent.CALL_RECEIVED : CallEvent.CALL_INITIATED,call);
  return callParticipant;
}
