{
  ServerTransaction serverTransaction=requestEvent.getServerTransaction();
  SipProvider jainSipProvider=(SipProvider)requestEvent.getSource();
  Request request=requestEvent.getRequest();
  String requestMethod=request.getMethod();
  if (serverTransaction == null) {
    try {
      serverTransaction=jainSipProvider.getNewServerTransaction(request);
    }
 catch (    TransactionAlreadyExistsException ex) {
      logger.error("Failed to create a new server" + "transaction for an incoming request\n" + "(Next message contains the request)",ex);
      return;
    }
catch (    TransactionUnavailableException ex) {
      logger.error("Failed to create a new server" + "transaction for an incoming request\n" + "(Next message contains the request)",ex);
      return;
    }
  }
  if (requestMethod.equals(Request.INVITE)) {
    logger.debug("received INVITE");
    DialogState dialogState=serverTransaction.getDialog().getState();
    if ((dialogState == null) || dialogState.equals(DialogState.CONFIRMED)) {
      if (logger.isDebugEnabled())       logger.debug("request is an INVITE. Dialog state=" + dialogState);
      processInvite(jainSipProvider,serverTransaction,request);
    }
 else {
      logger.error("reINVITEs while the dialog is not confirmed are not currently supported.");
    }
  }
 else   if (requestMethod.equals(Request.ACK)) {
    processAck(serverTransaction,request);
  }
 else   if (requestMethod.equals(Request.BYE)) {
    processBye(serverTransaction,request);
  }
 else   if (requestMethod.equals(Request.CANCEL)) {
    processCancel(serverTransaction,request);
  }
 else   if (requestMethod.equals(Request.REFER)) {
    logger.debug("received REFER");
    processRefer(serverTransaction,request,jainSipProvider);
  }
}
