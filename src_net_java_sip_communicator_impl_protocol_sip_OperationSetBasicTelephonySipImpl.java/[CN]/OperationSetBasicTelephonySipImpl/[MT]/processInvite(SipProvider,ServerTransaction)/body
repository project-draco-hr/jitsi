{
  Request invite=serverTransaction.getRequest();
  Dialog dialog=serverTransaction.getDialog();
  CallSipImpl callSipImpl=activeCallsRepository.findCall(dialog);
  if (callSipImpl == null) {
    ReplacesHeader replacesHeader=(ReplacesHeader)invite.getHeader(ReplacesHeader.NAME);
    if (replacesHeader == null) {
      callSipImpl=new CallSipImpl(protocolProvider);
      callSipImpl.processInvite(sourceProvider,serverTransaction);
    }
 else {
      CallPeerSipImpl callPeerToReplace=activeCallsRepository.findCallPeer(replacesHeader.getCallId(),replacesHeader.getToTag(),replacesHeader.getFromTag());
      if (callPeerToReplace != null) {
        callPeerToReplace.getCall().processReplacingInvite(sourceProvider,serverTransaction,callPeerToReplace);
      }
 else {
        this.sayErrorSilently(serverTransaction,Response.CALL_OR_TRANSACTION_DOES_NOT_EXIST);
      }
    }
  }
 else {
    callSipImpl.processReInvite(sourceProvider,serverTransaction);
  }
}
