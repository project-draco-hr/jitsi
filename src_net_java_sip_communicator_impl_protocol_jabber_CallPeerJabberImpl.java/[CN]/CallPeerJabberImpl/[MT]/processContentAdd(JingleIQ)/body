{
  CallPeerMediaHandlerJabberImpl mediaHandler=getMediaHandler();
  List<ContentPacketExtension> contents=content.getContentList();
  Iterable<ContentPacketExtension> answerContents;
  JingleIQ contentIQ;
  boolean noCands=false;
  logger.info("nocand " + noCands);
  logger.info("run code");
  try {
    if (!contentAddWithNoCands)     mediaHandler.processOffer(contents);
    if (contentAddWithNoCands == false) {
      for (      ContentPacketExtension c : contents) {
        if (JingleUtils.getFirstCandidate(c,1) == null) {
          contentAddWithNoCands=true;
          noCands=true;
        }
      }
    }
    if (noCands) {
      new Thread(){
        public void run(){
          try {
synchronized (candSyncRoot) {
              candSyncRoot.wait();
            }
          }
 catch (          InterruptedException e) {
          }
          processContentAdd(content);
          contentAddWithNoCands=false;
        }
      }
.start();
      logger.info("start thread");
      return;
    }
    mediaHandler.getTransportManager().wrapupConnectivityEstablishment();
    logger.info("wraping up");
    answerContents=mediaHandler.generateSessionAccept();
    contentIQ=null;
  }
 catch (  Exception e) {
    logger.warn("Exception occurred",e);
    answerContents=null;
    contentIQ=JinglePacketFactory.createContentReject(getProtocolProvider().getOurJID(),this.peerJID,getJingleSID(),answerContents);
  }
  if (contentIQ == null) {
    contentIQ=JinglePacketFactory.createContentAccept(getProtocolProvider().getOurJID(),this.peerJID,getJingleSID(),answerContents);
  }
  getProtocolProvider().getConnection().sendPacket(contentIQ);
  mediaHandler.start();
}
