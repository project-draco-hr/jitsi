{
  super.paintComponent(g);
  Graphics2D g2=(Graphics2D)g;
  g2.setRenderingHint(RenderingHints.KEY_ANTIALIASING,RenderingHints.VALUE_ANTIALIAS_ON);
  int width=getWidth();
  int height=getHeight();
  boolean imageIsChanging=false;
  if ((cache == null) || (cacheWidth != width) || (cacheHeight != height)) {
    cache=g2.getDeviceConfiguration().createCompatibleImage(width,height);
    cacheWidth=width;
    cacheHeight=height;
    Graphics2D cacheGraphics=cache.createGraphics();
    try {
      super.paintComponent(cacheGraphics);
      cacheGraphics.setRenderingHint(RenderingHints.KEY_ANTIALIASING,RenderingHints.VALUE_ANTIALIAS_ON);
      imageIsChanging=!cacheGraphics.drawImage(image,0,0,null);
      cacheGraphics.setColor(new Color(150,150,150));
      cacheGraphics.drawRoundRect(0,0,width - 1,height - 1,5,5);
    }
  finally {
      cacheGraphics.dispose();
    }
  }
  g2.drawImage(cache,0,0,null);
  if (imageIsChanging) {
    cache=null;
  }
}
