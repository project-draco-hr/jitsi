{
  assertConnected();
  String[] splitMessages=message.getContent().split("\n");
  String messagePortion=null;
  for (int i=0; i < splitMessages.length; i++) {
    messagePortion=splitMessages[i];
    if (messagePortion.equals("\n") || messagePortion.matches("[\\ ]*")) {
      continue;
    }
    final IrcConnection connection=this.parentProvider.getIrcStack().getConnection();
    if (connection == null) {
      throw new IllegalStateException("Connection is not available.");
    }
    if (((MessageIrcImpl)message).isCommand()) {
      try {
        connection.getMessageManager().command(this,messagePortion);
        this.fireMessageReceivedEvent(message,this.user,new Date(),ChatRoomMessageReceivedEvent.SYSTEM_MESSAGE_RECEIVED);
      }
 catch (      final UnsupportedCommandException e) {
        this.fireMessageDeliveryFailedEvent(ChatRoomMessageDeliveryFailedEvent.UNSUPPORTED_OPERATION,e.getMessage(),new Date(),message);
      }
    }
 else {
      connection.getMessageManager().message(this,messagePortion);
      this.fireMessageDeliveredEvent(new MessageIrcImpl(messagePortion,message.getContentType(),message.getEncoding(),message.getSubject()));
    }
  }
}
