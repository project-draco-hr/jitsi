{
  if (stopping || !started) {
    buffer.setLength(0);
    return;
  }
synchronized (readSync) {
    while (true) {
      if (bufferData == null) {
        if (!parentStream.read(buffer)) {
          try {
            readSync.wait();
          }
 catch (          InterruptedException e) {
          }
          continue;
        }
      }
 else {
        Object data=buffer.getData();
        byte[] dataArray=null;
        if (data instanceof byte[]) {
          dataArray=(byte[])data;
          if (dataArray.length < bufferLength)           dataArray=null;
        }
        if (dataArray == null) {
          dataArray=new byte[bufferLength];
          buffer.setData(dataArray);
        }
        System.arraycopy(bufferData,0,dataArray,0,bufferLength);
        buffer.setFlags(Buffer.FLAG_SYSTEM_TIME);
        buffer.setLength(bufferLength);
        buffer.setOffset(0);
        buffer.setTimeStamp(bufferTimeStamp);
      }
      break;
    }
    bufferData=null;
  }
}
