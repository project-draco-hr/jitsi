{
  int status=0;
  Iterator<ProtocolProviderService> pProviders=mainFrame.getProtocolProviders();
  while (pProviders.hasNext()) {
    ProtocolProviderService protocolProvider=pProviders.next();
    boolean isProtocolHidden=protocolProvider.getAccountID().getAccountProperty(ProtocolProviderFactory.IS_PROTOCOL_HIDDEN) != null;
    if (isProtocolHidden)     continue;
    if (!protocolProvider.isRegistered())     continue;
    OperationSetPresence presence=protocolProvider.getOperationSet(OperationSetPresence.class);
    int presenceStatus=(presence == null) ? PresenceStatus.AVAILABLE_THRESHOLD : presence.getPresenceStatus().getStatus();
    if (status < presenceStatus)     status=presenceStatus;
  }
  JMenuItem item=getItemFromStatus(status);
  setSelected(new SelectedObject(item.getText(),item.getIcon(),item));
  computeTextWidth();
  this.revalidate();
  setSystrayIcon(status);
}
