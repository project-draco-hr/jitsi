{
  JMenuItem menuItem=(JMenuItem)e.getSource();
  String itemName=menuItem.getName();
  Iterator<ProtocolProviderService> pProviders=mainFrame.getProtocolProviders();
  while (pProviders.hasNext()) {
    ProtocolProviderService protocolProvider=pProviders.next();
    if (itemName.equals(Constants.ONLINE_STATUS)) {
      if (!protocolProvider.isRegistered()) {
        saveStatusInformation(protocolProvider,onlineItem.getName());
        GuiActivator.getUIService().getLoginManager().login(protocolProvider);
      }
 else {
        OperationSetPresence presence=protocolProvider.getOperationSet(OperationSetPresence.class);
        if (presence == null) {
          saveStatusInformation(protocolProvider,onlineItem.getName());
          continue;
        }
        Iterator<PresenceStatus> statusSet=presence.getSupportedStatusSet();
        while (statusSet.hasNext()) {
          PresenceStatus status=statusSet.next();
          if (status.getStatus() < PresenceStatus.EAGER_TO_COMMUNICATE_THRESHOLD && status.getStatus() >= PresenceStatus.AVAILABLE_THRESHOLD) {
            new PublishPresenceStatusThread(presence,status).start();
            this.saveStatusInformation(protocolProvider,status.getStatusName());
            break;
          }
        }
      }
    }
 else     if (itemName.equals(Constants.OFFLINE_STATUS)) {
      if (!protocolProvider.getRegistrationState().equals(RegistrationState.UNREGISTERED) && !protocolProvider.getRegistrationState().equals(RegistrationState.UNREGISTERING)) {
        OperationSetPresence presence=protocolProvider.getOperationSet(OperationSetPresence.class);
        if (presence == null) {
          saveStatusInformation(protocolProvider,offlineItem.getName());
          GuiActivator.getUIService().getLoginManager().logoff(protocolProvider);
          continue;
        }
        Iterator<PresenceStatus> statusSet=presence.getSupportedStatusSet();
        while (statusSet.hasNext()) {
          PresenceStatus status=statusSet.next();
          if (status.getStatus() < PresenceStatus.ONLINE_THRESHOLD) {
            this.saveStatusInformation(protocolProvider,status.getStatusName());
            break;
          }
        }
        try {
          GuiActivator.getUIService().getLoginManager().setManuallyDisconnected(true);
          protocolProvider.unregister();
        }
 catch (        OperationFailedException e1) {
          logger.error("Unable to unregister the protocol provider: " + protocolProvider + " due to the following exception: "+ e1);
        }
      }
    }
 else     if (itemName.equals(Constants.FREE_FOR_CHAT_STATUS)) {
      if (!protocolProvider.isRegistered())       continue;
      OperationSetPresence presence=protocolProvider.getOperationSet(OperationSetPresence.class);
      if (presence == null)       continue;
      Iterator<PresenceStatus> statusSet=presence.getSupportedStatusSet();
      PresenceStatus status=null;
      while (statusSet.hasNext()) {
        PresenceStatus currentStatus=statusSet.next();
        if (status == null)         status=currentStatus;
        if (status.getStatus() < currentStatus.getStatus()) {
          status=currentStatus;
        }
      }
      if (status != null) {
        new PublishPresenceStatusThread(presence,status).start();
        this.saveStatusInformation(protocolProvider,status.getStatusName());
      }
    }
 else     if (itemName.equals(Constants.AWAY_STATUS)) {
      if (!protocolProvider.isRegistered())       continue;
      OperationSetPresence presence=protocolProvider.getOperationSet(OperationSetPresence.class);
      if (presence == null)       continue;
      Iterator<PresenceStatus> statusSet=presence.getSupportedStatusSet();
      PresenceStatus status=null;
      while (statusSet.hasNext()) {
        PresenceStatus currentStatus=statusSet.next();
        if (status == null && currentStatus.getStatus() < PresenceStatus.AVAILABLE_THRESHOLD && currentStatus.getStatus() >= PresenceStatus.ONLINE_THRESHOLD) {
          status=currentStatus;
        }
        if (status != null) {
          if (currentStatus.getStatus() < PresenceStatus.AVAILABLE_THRESHOLD && currentStatus.getStatus() >= PresenceStatus.ONLINE_THRESHOLD && currentStatus.getStatus() > status.getStatus()) {
            status=currentStatus;
          }
        }
      }
      if (status != null) {
        new PublishPresenceStatusThread(presence,status).start();
        this.saveStatusInformation(protocolProvider,status.getStatusName());
      }
    }
  }
}
