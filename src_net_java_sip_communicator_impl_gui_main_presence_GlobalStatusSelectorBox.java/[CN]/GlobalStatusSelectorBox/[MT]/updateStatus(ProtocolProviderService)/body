{
  StatusSelectorMenu accountMenu=accountMenus.get(protocolProvider);
  if (accountMenu == null)   return;
  if (accountMenu instanceof PresenceStatusMenu) {
    PresenceStatusMenu presenceStatusMenu=(PresenceStatusMenu)accountMenu;
    PresenceStatus presenceStatus;
    if (!protocolProvider.isRegistered())     presenceStatus=presenceStatusMenu.getOfflineStatus();
 else {
      presenceStatus=presenceStatusMenu.getLastSelectedStatus();
      if (presenceStatus == null) {
        presenceStatus=getLastPresenceStatus(protocolProvider);
        if (presenceStatus == null)         presenceStatus=presenceStatusMenu.getOnlineStatus();
      }
    }
    presenceStatusMenu.updateStatus(presenceStatus);
  }
 else {
    ((SimpleStatusMenu)accountMenu).updateStatus();
  }
  accountMenu.repaint();
  this.updateGlobalStatus();
}
