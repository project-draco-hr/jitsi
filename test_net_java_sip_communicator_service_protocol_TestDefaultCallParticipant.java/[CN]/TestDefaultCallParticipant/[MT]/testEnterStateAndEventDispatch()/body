{
  CallParticipantState oldState=defaultCallParticipant.getState();
  CallParticipantState newState=CallParticipantState.CONNECTED;
  CpAdapter adapter=new CpAdapter();
  defaultCallParticipant.addCallParticipantListener(adapter);
  long timeBeforeChange=System.currentTimeMillis();
  defaultCallParticipant.enterState(newState);
  long timeAfterChange=System.currentTimeMillis();
  assertEquals(newState,defaultCallParticipant.getState());
  assertNotNull(lastCpChangeEvent);
  assertEquals(lastCpChangeEvent.getOldValue(),oldState);
  assertEquals(lastCpChangeEvent.getNewValue(),newState);
  long currentStateStartDate=defaultCallParticipant.getCurrentStateStartDate().getTime();
  assertTrue("currentStateStart date is not properly updated",currentStateStartDate >= timeBeforeChange && currentStateStartDate <= timeAfterChange);
  defaultCallParticipant.removeCallParticipantListener(adapter);
  lastCpChangeEvent=null;
  defaultCallParticipant.enterState(CallParticipantState.DISCONNECTED);
  assertNull("a listener was not properly removed",lastCpChangeEvent);
}
