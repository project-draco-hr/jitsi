{
  ClientTransaction clientTransaction=responseEvent.getClientTransaction();
  Response response=responseEvent.getResponse();
  CSeqHeader cseq=((CSeqHeader)response.getHeader(CSeqHeader.NAME));
  if (cseq == null) {
    logger.error("An incoming response did not contain a CSeq header");
    return;
  }
  String method=cseq.getMethod();
  SipProvider sourceProvider=(SipProvider)responseEvent.getSource();
  if (method.equals(Request.SUBSCRIBE)) {
    CallIdHeader idheader=(CallIdHeader)response.getHeader(CallIdHeader.NAME);
    ContactSipImpl contact=(ContactSipImpl)this.subscribedContacts.get(idheader.getCallId());
    ExpiresHeader expHeader=(ExpiresHeader)response.getHeader(ExpiresHeader.NAME);
    if ((expHeader != null && expHeader.getExpires() == 0) || contact == null) {
      if (response.getStatusCode() == Response.UNAUTHORIZED || response.getStatusCode() == Response.PROXY_AUTHENTICATION_REQUIRED) {
        try {
          processAuthenticationChallenge(clientTransaction,response,sourceProvider);
        }
 catch (        OperationFailedException e) {
          logger.error("can't handle the challenge");
        }
      }
 else       if (response.getStatusCode() != Response.OK && response.getStatusCode() != Response.ACCEPTED) {
synchronized (this.waitedCallIds) {
          this.waitedCallIds.remove(idheader.getCallId());
        }
      }
      return;
    }
    try {
      finalizeSubscription(contact,clientTransaction.getDialog());
    }
 catch (    NullPointerException e) {
      logger.debug("failed to finalize the subscription of the" + "contact",e);
      return;
    }
    if (response.getStatusCode() == Response.OK || response.getStatusCode() == Response.ACCEPTED) {
    }
 else     if (response.getStatusCode() == Response.UNAUTHORIZED || response.getStatusCode() == Response.PROXY_AUTHENTICATION_REQUIRED) {
      try {
        processAuthenticationChallenge(clientTransaction,response,sourceProvider);
      }
 catch (      OperationFailedException e) {
        logger.error("can't handle the challenge");
        changePresenceStatusForContact(contact,SipStatusEnum.UNKNOWN);
      }
    }
 else     if (response.getStatusCode() == Response.REQUEST_TIMEOUT || response.getStatusCode() == Response.TEMPORARILY_UNAVAILABLE || response.getStatusCode() == Response.BUSY_HERE || response.getStatusCode() == Response.BUSY_EVERYWHERE || response.getStatusCode() == Response.DECLINE) {
      logger.debug("error received from the network" + response);
      if (response.getStatusCode() == Response.TEMPORARILY_UNAVAILABLE) {
        changePresenceStatusForContact(contact,SipStatusEnum.OFFLINE);
      }
 else {
        changePresenceStatusForContact(contact,SipStatusEnum.UNKNOWN);
      }
    }
 else {
      logger.debug("error received from the network" + response);
      contact.setResolvable(false);
      changePresenceStatusForContact(contact,SipStatusEnum.UNKNOWN);
    }
  }
 else   if (method.equals(Request.NOTIFY)) {
    if (response.getStatusCode() != Response.UNAUTHORIZED && response.getStatusCode() != Response.PROXY_AUTHENTICATION_REQUIRED) {
synchronized (this.waitedCallIds) {
        this.waitedCallIds.remove(((CallIdHeader)response.getHeader(CallIdHeader.NAME)).getCallId());
      }
    }
    if (response.getStatusCode() == Response.OK) {
    }
 else     if (response.getStatusCode() == Response.UNAUTHORIZED || response.getStatusCode() == Response.PROXY_AUTHENTICATION_REQUIRED) {
      try {
        processAuthenticationChallenge(clientTransaction,response,sourceProvider);
      }
 catch (      OperationFailedException e) {
        logger.error("can't handle the challenge");
        String contactAddress=((FromHeader)response.getHeader(FromHeader.NAME)).getAddress().getURI().toString();
        Contact watcher=getWatcher(contactAddress);
        if (watcher != null) {
synchronized (this.ourWatchers) {
            this.ourWatchers.remove(watcher);
          }
        }
      }
    }
 else {
      logger.debug("error received from the network" + response);
      String contactAddress=((FromHeader)response.getHeader(FromHeader.NAME)).getAddress().getURI().toString();
      Contact watcher=getWatcher(contactAddress);
      if (watcher != null) {
synchronized (this.ourWatchers) {
          this.ourWatchers.remove(watcher);
        }
      }
    }
  }
 else   if (method.equals(Request.PUBLISH)) {
    if (response.getStatusCode() != Response.UNAUTHORIZED && response.getStatusCode() != Response.PROXY_AUTHENTICATION_REQUIRED) {
synchronized (this.waitedCallIds) {
        this.waitedCallIds.remove(((CallIdHeader)response.getHeader(CallIdHeader.NAME)).getCallId());
      }
    }
    if (response.getStatusCode() == Response.OK) {
      SIPETagHeader etHeader=(SIPETagHeader)response.getHeader(SIPETagHeader.NAME);
      if (etHeader == null) {
        logger.debug("can't find the ETag header");
        return;
      }
      this.distantPAET=etHeader.getETag();
    }
 else     if (response.getStatusCode() == Response.UNAUTHORIZED || response.getStatusCode() == Response.PROXY_AUTHENTICATION_REQUIRED) {
      try {
        processAuthenticationChallenge(clientTransaction,response,sourceProvider);
      }
 catch (      OperationFailedException e) {
        logger.error("can't handle the challenge");
        return;
      }
    }
 else {
      logger.debug("error received from the network" + response);
      this.distantPAET=null;
    }
  }
}
