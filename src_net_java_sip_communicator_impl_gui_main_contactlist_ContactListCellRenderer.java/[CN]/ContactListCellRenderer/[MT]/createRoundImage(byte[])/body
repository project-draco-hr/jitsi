{
  BufferedImage destImage=null;
  try {
    InputStream in=new ByteArrayInputStream(avatarBytes);
    BufferedImage avatarImage=ImageIO.read(in);
    ImageIcon scaledImage=ImageUtils.scaleIconWithinBounds(new ImageIcon(avatarImage),AVATAR_WIDTH,AVATAR_HEIGHT);
    destImage=new BufferedImage(scaledImage.getIconWidth(),scaledImage.getIconHeight(),BufferedImage.TYPE_INT_ARGB);
    Graphics2D g=destImage.createGraphics();
    AntialiasingManager.activateAntialiasing(g);
    g.setColor(Color.WHITE);
    g.fillRoundRect(0,0,scaledImage.getIconWidth(),scaledImage.getIconHeight(),10,10);
    g.setComposite(AlphaComposite.SrcIn);
    g.drawImage(scaledImage.getImage(),0,0,null);
  }
 catch (  Exception e) {
    logger.error("Could not create image.",e);
  }
  return destImage;
}
