{
  SourceStream[] inputDataSourceStreams=inputDataSourceDesc.getStreams();
  if (inputDataSourceStreams != null) {
    boolean added=false;
    for (    SourceStream inputStream : inputDataSourceStreams) {
      Format inputFormat=getFormat(inputStream);
      if ((inputFormat != null) && matches(inputFormat,outputFormat)) {
        InputStreamDesc inputStreamDesc=getExistingInputStreamDesc(inputStream,existingInputStreams);
        if (inputStreamDesc == null)         inputStreamDesc=createInputStreamDesc(inputStream,inputDataSourceDesc);
        if (inputStreams.add(inputStreamDesc))         added=true;
      }
    }
    return added;
  }
  DataSource inputDataSource=inputDataSourceDesc.getEffectiveInputDataSource();
  if (inputDataSource == null)   return false;
  Format inputFormat=getFormat(inputDataSource);
  if ((inputFormat != null) && !matches(inputFormat,outputFormat)) {
    if (inputDataSource instanceof PushDataSource) {
      for (      PushSourceStream inputStream : ((PushDataSource)inputDataSource).getStreams()) {
        InputStreamDesc inputStreamDesc=getExistingInputStreamDesc(inputStream,existingInputStreams);
        if (inputStreamDesc == null)         inputStreamDesc=createInputStreamDesc(new PushBufferStreamAdapter(inputStream,inputFormat),inputDataSourceDesc);
        inputStreams.add(inputStreamDesc);
      }
      return true;
    }
    if (inputDataSource instanceof PullDataSource) {
      for (      PullSourceStream inputStream : ((PullDataSource)inputDataSource).getStreams()) {
        InputStreamDesc inputStreamDesc=getExistingInputStreamDesc(inputStream,existingInputStreams);
        if (inputStreamDesc == null)         inputStreamDesc=createInputStreamDesc(new PullBufferStreamAdapter(inputStream,inputFormat),inputDataSourceDesc);
        inputStreams.add(inputStreamDesc);
      }
      return true;
    }
  }
  return false;
}
