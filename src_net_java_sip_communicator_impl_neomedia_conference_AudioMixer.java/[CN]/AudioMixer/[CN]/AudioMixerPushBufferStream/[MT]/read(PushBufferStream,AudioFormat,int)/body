{
  AudioFormat inputStreamFormat=(AudioFormat)inputStream.getFormat();
  Buffer buffer=new Buffer();
  if (sampleCount != 0) {
    Class<?> inputDataType=inputStreamFormat.getDataType();
    if (Format.byteArray.equals(inputDataType)) {
      buffer.setData(new byte[sampleCount * (inputStreamFormat.getSampleSizeInBits() / 8)]);
      buffer.setLength(0);
      buffer.setOffset(0);
    }
 else     throw new UnsupportedFormatException("!Format.getDataType().equals(byte[].class)",inputStreamFormat);
  }
  inputStream.read(buffer);
  int inputLength=buffer.getLength();
  if (inputLength <= 0)   return null;
  AudioFormat inputFormat=(AudioFormat)buffer.getFormat();
  if (inputFormat == null)   inputFormat=inputStreamFormat;
  if (logger.isTraceEnabled() && ((lastReadInputFormat == null) || !lastReadInputFormat.matches(inputFormat))) {
    lastReadInputFormat=inputFormat;
    logger.trace("Read inputSamples in different format " + lastReadInputFormat);
  }
  int inputFormatSigned=inputFormat.getSigned();
  if ((inputFormatSigned != AudioFormat.SIGNED) && (inputFormatSigned != Format.NOT_SPECIFIED))   throw new UnsupportedFormatException("AudioFormat.getSigned()",inputFormat);
  int inputFormatChannels=inputFormat.getChannels();
  int outputFormatChannels=outputFormat.getChannels();
  if ((inputFormatChannels != outputFormatChannels) && (inputFormatChannels != Format.NOT_SPECIFIED) && (outputFormatChannels != Format.NOT_SPECIFIED)) {
    logger.error("Encountered inputFormat with a different number of" + " channels than outputFormat for inputFormat " + inputFormat + " and outputFormat "+ outputFormat);
    throw new UnsupportedFormatException("AudioFormat.getChannels()",inputFormat);
  }
  Object inputData=buffer.getData();
  if (inputData instanceof byte[]) {
    byte[] inputSamples=(byte[])inputData;
    int[] outputSamples;
    int outputSampleSizeInBits=outputFormat.getSampleSizeInBits();
switch (inputFormat.getSampleSizeInBits()) {
case 16:
      outputSamples=new int[inputSamples.length / 2];
    for (int i=0; i < outputSamples.length; i++) {
      int sample=ArrayIOUtils.readInt16(inputSamples,i * 2);
switch (outputSampleSizeInBits) {
case 16:
        break;
case 32:
      sample=Math.round(sample * INT_TO_SHORT_RATIO);
    break;
case 8:
case 24:
default :
  throw new UnsupportedFormatException("AudioFormat.getSampleSizeInBits()",outputFormat);
}
outputSamples[i]=sample;
}
return outputSamples;
case 32:
outputSamples=new int[inputSamples.length / 4];
for (int i=0; i < outputSamples.length; i++) {
int sample=readInt(inputSamples,i * 4);
switch (outputSampleSizeInBits) {
case 16:
sample=Math.round(sample * SHORT_TO_INT_RATIO);
break;
case 32:
break;
case 8:
case 24:
default :
throw new UnsupportedFormatException("AudioFormat.getSampleSizeInBits()",outputFormat);
}
outputSamples[i]=sample;
}
return outputSamples;
case 8:
case 24:
default :
throw new UnsupportedFormatException("AudioFormat.getSampleSizeInBits()",inputFormat);
}
}
 else if (inputData != null) {
throw new UnsupportedFormatException("Format.getDataType().equals(" + inputData.getClass() + ")",inputFormat);
}
return null;
}
