{
  if (!(evt.getSource() instanceof ProtocolProviderService))   return;
  ProtocolProviderService pp=(ProtocolProviderService)evt.getSource();
  if (evt.getNewState().equals(RegistrationState.CONNECTION_FAILED)) {
    if (needsReconnection.contains(pp))     return;
    if (connectedInterfaces.size() == 0)     needsReconnection.add(pp);
 else {
      reconnect(pp);
    }
    unregisteredProviders.remove(pp);
  }
 else   if (evt.getNewState().equals(RegistrationState.REGISTERED)) {
    autoReconnEnabledProviders.put((ProtocolProviderService)evt.getSource(),new ArrayList<String>(connectedInterfaces));
    currentlyReconnecting.remove(pp);
  }
 else   if (evt.getNewState().equals(RegistrationState.UNREGISTERED)) {
    autoReconnEnabledProviders.remove((ProtocolProviderService)evt.getSource());
    if (!unregisteredProviders.contains(pp) && currentlyReconnecting.containsKey(pp)) {
      currentlyReconnecting.remove(pp).cancel();
    }
    unregisteredProviders.remove(pp);
  }
}
