{
synchronized (registeredWizards) {
    registeredWizards.put(wizard.getClass().getName(),wizard);
  }
  Set set=GuiActivator.getProtocolProviderFactories().entrySet();
  Iterator iter=set.iterator();
  boolean hasRegisteredAccounts=false;
  while (iter.hasNext()) {
    Map.Entry entry=(Map.Entry)iter.next();
    ProtocolProviderFactory providerFactory=(ProtocolProviderFactory)entry.getValue();
    ArrayList accountsList=providerFactory.getRegisteredAccounts();
    AccountID accountID;
    for (int i=0; i < accountsList.size(); i++) {
      accountID=(AccountID)accountsList.get(i);
      boolean isHidden=accountID.getAccountProperties().get("HIDDEN_PROTOCOL") != null;
      if (!isHidden) {
        hasRegisteredAccounts=true;
        break;
      }
    }
  }
  String preferredWizardName=LOGIN_RESOURCE_BUNDLE.getString("preferredAccountWizard");
  if (!hasRegisteredAccounts && preferredWizardName != null && wizard.getClass().getName().equals(preferredWizardName)) {
    this.setCurrentWizard(wizard);
    this.showDialog(true);
  }
  this.fireAccountRegistrationEvent(wizard,AccountRegistrationEvent.REGISTRATION_ADDED);
}
