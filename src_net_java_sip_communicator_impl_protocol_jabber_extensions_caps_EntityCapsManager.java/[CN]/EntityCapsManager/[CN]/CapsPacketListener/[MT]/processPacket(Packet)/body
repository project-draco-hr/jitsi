{
  CapsPacketExtension ext=(CapsPacketExtension)packet.getExtension(CapsPacketExtension.ELEMENT_NAME,CapsPacketExtension.NAMESPACE);
  String hash=ext.getHash();
  if (hash == null)   hash="";
  if (hash != null) {
    boolean online=(packet instanceof Presence) && ((Presence)packet).isAvailable();
    if (online) {
      addUserCapsNode(packet.getFrom(),ext.getNode(),hash,ext.getVersion(),ext.getExtensions(),online);
    }
 else {
      removeUserCapsNode(packet.getFrom());
    }
  }
}
