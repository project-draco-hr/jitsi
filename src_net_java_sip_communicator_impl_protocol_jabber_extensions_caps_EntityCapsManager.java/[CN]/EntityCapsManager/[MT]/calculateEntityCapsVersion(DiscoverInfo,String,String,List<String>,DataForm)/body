{
  StringBuilder bldr=new StringBuilder();
  bldr.append("client/" + identityType + "//"+ identityName+ "<");
synchronized (features) {
    SortedSet<String> fs=new TreeSet<String>();
    for (    String f : features) {
      fs.add(f);
    }
    for (    String f : fs) {
      bldr.append(f + "<");
    }
  }
  if (extendedInfo != null) {
synchronized (extendedInfo) {
      SortedSet<FormField> fs=new TreeSet<FormField>(new Comparator<FormField>(){
        public int compare(        FormField f1,        FormField f2){
          return f1.getVariable().compareTo(f2.getVariable());
        }
      }
);
      FormField formType=null;
      for (Iterator<FormField> fieldsIter=extendedInfo.getFields(); fieldsIter.hasNext(); ) {
        FormField f=fieldsIter.next();
        if (!f.getVariable().equals("FORM_TYPE")) {
          fs.add(f);
        }
 else {
          formType=f;
        }
      }
      if (formType != null) {
        bldr.append(formFieldValuesToCaps(formType.getValues()));
      }
      for (      FormField f : fs) {
        bldr.append(f.getVariable() + "<");
        bldr.append(formFieldValuesToCaps(f.getValues()));
      }
    }
  }
  setCurrentCapsVersion(discoverInfo,capsToHash(s));
}
