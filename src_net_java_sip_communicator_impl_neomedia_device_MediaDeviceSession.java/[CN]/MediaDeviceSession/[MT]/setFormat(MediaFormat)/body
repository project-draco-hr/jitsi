{
  if (!getMediaType().equals(format.getMediaType()))   throw new IllegalArgumentException("format");
  @SuppressWarnings("unchecked") MediaFormatImpl<? extends Format> mediaFormatImpl=(MediaFormatImpl<? extends Format>)format;
  this.format=mediaFormatImpl;
  if (logger.isTraceEnabled()) {
    logger.trace("Set format " + this.format + " on "+ getClass().getSimpleName()+ " "+ hashCode());
  }
  if (processor != null) {
    int processorState=processor.getState();
    if (processorState == Processor.Configured)     setProcessorFormat(processor,this.format);
 else     if (processorIsPrematurelyClosed || ((processorState > Processor.Configured) && !this.format.getFormat().equals(getProcessorFormat()))) {
      setProcessor(null);
    }
  }
}
