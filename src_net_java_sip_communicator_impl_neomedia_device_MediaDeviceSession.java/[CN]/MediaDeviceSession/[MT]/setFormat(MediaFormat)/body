{
  MediaType mediaType=getMediaType();
  if (!mediaType.equals(format.getMediaType()))   throw new IllegalArgumentException("format");
  @SuppressWarnings("unchecked") MediaFormatImpl<? extends Format> mediaFormatImpl=(MediaFormatImpl<? extends Format>)format;
  this.format=mediaFormatImpl.getFormat();
  if (processor != null) {
    int processorState=processor.getState();
    if (processorState == Processor.Configured)     setProcessorFormat(processor,this.format);
 else     if (processorIsPrematurelyClosed || ((processorState > Processor.Configured) && !this.format.equals(getProcessorFormat()))) {
      setProcessor(null);
    }
  }
}
