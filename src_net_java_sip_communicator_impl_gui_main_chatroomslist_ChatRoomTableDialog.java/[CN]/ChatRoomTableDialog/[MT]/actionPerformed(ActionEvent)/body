{
  String[] joinOptions;
  String subject=null;
  JButton sourceButton=(JButton)e.getSource();
  if (sourceButton.equals(addButton)) {
    String chatRoomName=editor.getText();
    if (StringUtils.isNullOrEmpty(chatRoomName))     return;
    ChatRoomWrapper chatRoomWrapper=GuiActivator.getMUCService().createChatRoom(chatRoomName.trim(),getSelectedProvider().getProtocolProvider(),new ArrayList<String>(),"",false,true,true);
    ChatRoomJoinOptionsDialog.getJoinOptions(true,chatRoomWrapper.getParentProvider().getProtocolProvider(),chatRoomWrapper.getChatRoomID());
  }
 else   if (sourceButton.equals(removeButton)) {
    chatRoomsTableUI.removeSelectedRoom();
  }
 else   if (sourceButton.equals(okButton)) {
    ChatRoomWrapper selectedRoom=chatRoomsTableUI.getSelectedRoom();
    if (selectedRoom == null) {
      if (editor.getText() != null && editor.getText().trim().length() > 0) {
        ChatRoomWrapper chatRoomWrapper=GuiActivator.getMUCService().createChatRoom(editor.getText().trim(),getSelectedProvider().getProtocolProvider(),new ArrayList<String>(),"",false,false,false);
        joinOptions=ChatRoomJoinOptionsDialog.getJoinOptions(chatRoomWrapper.getParentProvider().getProtocolProvider(),chatRoomWrapper.getChatRoomID());
        String nickName=joinOptions[0];
        subject=joinOptions[1];
        if (nickName == null)         return;
        GuiActivator.getMUCService().joinChatRoom(chatRoomWrapper,nickName,null,subject);
        ChatWindowManager chatWindowManager=GuiActivator.getUIService().getChatWindowManager();
        ChatPanel chatPanel=chatWindowManager.getMultiChat(chatRoomWrapper,true);
        chatWindowManager.openChat(chatPanel,true);
      }
    }
 else {
      if (selectedRoom.getChatRoom() != null) {
        if (!selectedRoom.getChatRoom().isJoined()) {
          String savedNick=ConfigurationUtils.getChatRoomProperty(selectedRoom.getParentProvider().getProtocolProvider(),selectedRoom.getChatRoomID(),"userNickName");
          if (savedNick == null) {
            joinOptions=ChatRoomJoinOptionsDialog.getJoinOptions(selectedRoom.getParentProvider().getProtocolProvider(),selectedRoom.getChatRoomID());
            savedNick=joinOptions[0];
            subject=joinOptions[1];
            if (savedNick == null)             return;
          }
          GuiActivator.getMUCService().joinChatRoom(selectedRoom,savedNick,null,subject);
        }
 else         chatRoomsTableUI.openChatForSelection();
      }
 else {
        ChatRoomWrapper chatRoomWrapper=GuiActivator.getMUCService().createChatRoom(selectedRoom.getChatRoomName(),getSelectedProvider().getProtocolProvider(),new ArrayList<String>(),"",false,false,true);
        String savedNick=ConfigurationUtils.getChatRoomProperty(chatRoomWrapper.getParentProvider().getProtocolProvider(),chatRoomWrapper.getChatRoomID(),"userNickName");
        if (savedNick == null) {
          joinOptions=ChatRoomJoinOptionsDialog.getJoinOptions(selectedRoom.getParentProvider().getProtocolProvider(),selectedRoom.getChatRoomID());
          savedNick=joinOptions[0];
          subject=joinOptions[1];
          if (savedNick == null)           return;
        }
        GuiActivator.getMUCService().joinChatRoom(chatRoomWrapper,savedNick,null,subject);
      }
    }
    dispose();
  }
 else   if (sourceButton.equals(cancelButton)) {
    dispose();
  }
}
