{
  JButton sourceButton=(JButton)e.getSource();
  if (sourceButton.equals(addButton)) {
    String chatRoomName=editor.getText();
    if (StringUtils.isNullOrEmpty(chatRoomName))     return;
    ChatRoomWrapper chatRoomWrapper=GuiActivator.getUIService().getConferenceChatManager().createChatRoom(chatRoomName,getSelectedProvider().getProtocolProvider(),new ArrayList<String>(),"",false,true);
    String nickName=null;
    ChatOperationReasonDialog reasonDialog=new ChatOperationReasonDialog(GuiActivator.getResources().getI18NString("service.gui.CHANGE_NICKNAME"),GuiActivator.getResources().getI18NString("service.gui.CHANGE_NICKNAME_LABEL"));
    reasonDialog.setReasonFieldText("");
    int result=reasonDialog.showDialog();
    if (result == MessageDialog.OK_RETURN_CODE) {
      nickName=reasonDialog.getReason().trim();
      ConfigurationManager.updateChatRoomProperty(getSelectedProvider().getProtocolProvider(),chatRoomWrapper.getChatRoomID(),"userNickName",nickName);
    }
  }
 else   if (sourceButton.equals(removeButton)) {
    chatRoomsTableUI.removeSelectedRoom();
  }
 else   if (sourceButton.equals(okButton)) {
    ChatRoomWrapper selectedRoom=chatRoomsTableUI.getSelectedRoom();
    if (selectedRoom == null) {
      if (editor.getText() != null && editor.getText().trim().length() > 0) {
        ChatRoomWrapper chatRoomWrapper=GuiActivator.getUIService().getConferenceChatManager().createChatRoom(editor.getText(),getSelectedProvider().getProtocolProvider(),new ArrayList<String>(),"",false,false);
        String nickName=null;
        ChatOperationReasonDialog reasonDialog=new ChatOperationReasonDialog(GuiActivator.getResources().getI18NString("service.gui.CHANGE_NICKNAME"),GuiActivator.getResources().getI18NString("service.gui.CHANGE_NICKNAME_LABEL"));
        reasonDialog.setReasonFieldText(chatRoomWrapper.getChatRoom().getUserNickname());
        int result=reasonDialog.showDialog();
        if (result == MessageDialog.OK_RETURN_CODE) {
          nickName=reasonDialog.getReason().trim();
          ConfigurationManager.updateChatRoomProperty(getSelectedProvider().getProtocolProvider(),chatRoomWrapper.getChatRoomID(),"userNickName",nickName);
        }
        GuiActivator.getUIService().getConferenceChatManager().joinChatRoom(chatRoomWrapper);
        ChatWindowManager chatWindowManager=GuiActivator.getUIService().getChatWindowManager();
        ChatPanel chatPanel=chatWindowManager.getMultiChat(chatRoomWrapper,true);
        chatWindowManager.openChat(chatPanel,true);
      }
    }
 else {
      if (selectedRoom.getChatRoom() != null) {
        if (!selectedRoom.getChatRoom().isJoined()) {
          String savedNick=ConfigurationManager.getChatRoomProperty(selectedRoom.getParentProvider().getProtocolProvider(),selectedRoom.getChatRoomID(),"userNickName");
          GuiActivator.getUIService().getConferenceChatManager().joinChatRoom(selectedRoom,savedNick,null);
        }
 else         chatRoomsTableUI.openChatForSelection();
      }
 else {
        ChatRoomWrapper chatRoomWrapper=GuiActivator.getUIService().getConferenceChatManager().createChatRoom(selectedRoom.getChatRoomName(),getSelectedProvider().getProtocolProvider(),new ArrayList<String>(),"",false,true);
        String savedNick=ConfigurationManager.getChatRoomProperty(chatRoomWrapper.getParentProvider().getProtocolProvider(),chatRoomWrapper.getChatRoomID(),"userNickName");
        if (savedNick == null) {
          String nickName=null;
          ChatOperationReasonDialog reasonDialog=new ChatOperationReasonDialog(GuiActivator.getResources().getI18NString("service.gui.CHANGE_NICKNAME"),GuiActivator.getResources().getI18NString("service.gui.CHANGE_NICKNAME_LABEL"));
          reasonDialog.setReasonFieldText(chatRoomWrapper.getChatRoom().getUserNickname());
          int result=reasonDialog.showDialog();
          if (result == MessageDialog.OK_RETURN_CODE) {
            nickName=reasonDialog.getReason().trim();
            ConfigurationManager.updateChatRoomProperty(getSelectedProvider().getProtocolProvider(),chatRoomWrapper.getChatRoomID(),"userNickName",nickName);
          }
          GuiActivator.getUIService().getConferenceChatManager().joinChatRoom(chatRoomWrapper,nickName,null);
        }
 else         GuiActivator.getUIService().getConferenceChatManager().joinChatRoom(chatRoomWrapper,savedNick,null);
      }
    }
    dispose();
  }
 else   if (sourceButton.equals(cancelButton)) {
    dispose();
  }
}
