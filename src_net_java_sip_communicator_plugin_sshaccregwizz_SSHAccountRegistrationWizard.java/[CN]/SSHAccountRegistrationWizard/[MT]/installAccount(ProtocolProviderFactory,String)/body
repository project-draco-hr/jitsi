{
  Hashtable accountProperties=new Hashtable();
  accountProperties.put(ProtocolProviderFactorySSHImpl.IDENTITY_FILE,registration.getIdentityFile());
  accountProperties.put(ProtocolProviderFactorySSH.KNOWN_HOSTS_FILE,String.valueOf(registration.getKnownHostsFile()));
  if (isModification) {
    providerFactory.uninstallAccount(protocolProvider.getAccountID());
    this.protocolProvider=null;
    this.isModification=false;
  }
  try {
    AccountID accountID=providerFactory.installAccount(user,accountProperties);
    ServiceReference serRef=providerFactory.getProviderForAccount(accountID);
    protocolProvider=(ProtocolProviderService)SSHAccRegWizzActivator.bundleContext.getService(serRef);
  }
 catch (  IllegalArgumentException exc) {
    SSHAccRegWizzActivator.getUIService().getPopupDialog().showMessagePopupDialog(exc.getMessage(),Resources.getString("error"),PopupDialog.ERROR_MESSAGE);
  }
catch (  IllegalStateException exc) {
    SSHAccRegWizzActivator.getUIService().getPopupDialog().showMessagePopupDialog(exc.getMessage(),Resources.getString("error"),PopupDialog.ERROR_MESSAGE);
  }
  return protocolProvider;
}
