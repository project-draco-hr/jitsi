{
  String url=null;
  if (logger.isDebugEnabled())   logger.debug("Provisioning discovery [STARTED]");
  ProvisioningActivator.bundleContext=bundleContext;
  String uuid=(String)getConfigurationService().getProperty(PROVISIONING_UUID_PROP);
  if (uuid == null || uuid.equals("")) {
    uuid=UUID.randomUUID().toString();
    getConfigurationService().setProperty(PROVISIONING_UUID_PROP,uuid);
  }
  Dictionary<String,String> properties=new Hashtable<String,String>();
  properties.put(ConfigurationForm.FORM_TYPE,ConfigurationForm.ADVANCED_TYPE);
  bundleContext.registerService(ConfigurationForm.class.getName(),new LazyConfigurationForm("net.java.sip.communicator.plugin.provisioning.ProvisioningForm",getClass().getClassLoader(),"plugin.provisioning.PLUGIN_ICON","plugin.provisioning.PROVISIONING",2000,true),properties);
  String method=getProvisioningMethod();
  if (method == null || method.equals("NONE")) {
    return;
  }
  ServiceReference serviceReferences[]=bundleContext.getServiceReferences(ProvisioningDiscoveryService.class.getName(),null);
  if (serviceReferences != null) {
    for (    ServiceReference ref : serviceReferences) {
      ProvisioningDiscoveryService provdisc=(ProvisioningDiscoveryService)bundleContext.getService(ref);
      if (provdisc.getMethodName().equals(method)) {
        url=provdisc.discoverURL();
        break;
      }
    }
  }
  if (url == null) {
    url=getProvisioningUri();
  }
  if (url != null) {
    File file=retrieveConfigurationFile(url);
    if (file != null) {
      getConfigurationService().setProperty(PROPERTY_PROVISIONING_URL,url);
      updateConfiguration(file);
    }
  }
  if (logger.isDebugEnabled())   logger.debug("Provisioning discovery [REGISTERED]");
}
