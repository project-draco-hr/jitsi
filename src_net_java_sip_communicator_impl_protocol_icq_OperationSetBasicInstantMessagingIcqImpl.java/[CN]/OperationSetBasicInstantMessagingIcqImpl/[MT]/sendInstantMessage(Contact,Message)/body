{
  assertConnected();
  if (!(to instanceof ContactIcqImpl))   throw new IllegalArgumentException("The specified contact is not a Icq contact." + to);
  ImConversation imConversation=icqProvider.getAimConnection().getIcbmService().getImConversation(new Screenname(to.getAddress()));
  String messageContent=null;
  if (message.getContentType().equals(HTML_MIME_TYPE) && !message.getContent().startsWith(defaultHtmlStartTag)) {
    messageContent=defaultHtmlStartTag + message.getContent() + defaultHtmlEndTag;
  }
 else   messageContent=message.getContent();
  MessageDeliveredEvent msgDeliveryPendingEvt=new MessageDeliveredEvent(message,to,System.currentTimeMillis());
  msgDeliveryPendingEvt=this.messageDeliveryPendingTransform(msgDeliveryPendingEvt);
  if (msgDeliveryPendingEvt == null)   return;
  String transformedContent=msgDeliveryPendingEvt.getSourceMessage().getContent();
  if (to.getPresenceStatus().isOnline()) {
    imConversation.sendMessage(new SimpleMessage(transformedContent));
  }
 else   imConversation.sendMessage(new SimpleMessage(transformedContent),true);
  MessageDeliveredEvent msgDeliveredEvt=new MessageDeliveredEvent(message,to,System.currentTimeMillis());
  if (msgDeliveredEvt != null)   fireMessageEvent(msgDeliveredEvt);
}
