{
  assertConnected();
  if (!(to instanceof ContactIcqImpl))   throw new IllegalArgumentException("The specified contact is not a Icq contact." + to);
  ImConversation imConversation=icqProvider.getAimConnection().getIcbmService().getImConversation(new Screenname(to.getAddress()));
  LinkedList messageParts=new LinkedList();
  String messageContent=message.getContent();
  while (messageContent.length() > MAX_MSG_LEN) {
    messageParts.add(messageContent.substring(0,MAX_MSG_LEN));
    messageContent=messageContent.substring(MAX_MSG_LEN);
  }
  if (messageContent.length() > 0)   messageParts.add(messageContent);
  for (int i=0; i < messageParts.size(); i++) {
    String messageSegment=(String)messageParts.get(i);
    if (to.getPresenceStatus().isOnline()) {
      imConversation.sendMessage(new SimpleMessage(messageSegment));
    }
 else {
      imConversation.sendMessage(new SimpleMessage(messageSegment),true);
    }
    MessageDeliveredEvent msgDeliveredEvt=new MessageDeliveredEvent(new MessageIcqImpl(messageSegment,message.getContentType(),message.getEncoding(),message.getSubject(),(i == 0) ? message.getMessageUID() : null),to,new Date());
    fireMessageEvent(msgDeliveredEvt);
  }
}
