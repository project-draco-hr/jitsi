{
  String msgBody=minfo.getMessage().getMessageBody();
  if (logger.isDebugEnabled())   logger.debug("Received from " + conversation.getBuddy() + " the message "+ msgBody);
  if (msgBody.startsWith(SYS_MSG_PREFIX_TEST) && conversation.getBuddy().getFormatted().equals(icqProvider.getAccountID().getUserID())) {
    receivedKeepAlivePackets.addLast(msgBody);
    return;
  }
  String msgContent;
  String msgContentType;
  if (msgBody.startsWith(defaultHtmlStartTag)) {
    msgContent=msgBody.substring(msgBody.indexOf(defaultHtmlStartTag) + defaultHtmlStartTag.length(),msgBody.indexOf(defaultHtmlEndTag));
    msgContentType=HTML_MIME_TYPE;
  }
 else {
    msgContent=msgBody;
    msgContentType=DEFAULT_MIME_TYPE;
  }
  Message newMessage=createMessage(msgContent,msgContentType,DEFAULT_MIME_ENCODING,null);
  Contact sourceContact=opSetPersPresence.findContactByID(conversation.getBuddy().getFormatted());
  if (sourceContact == null) {
    logger.debug("received a message from a unknown contact: " + conversation.getBuddy());
    sourceContact=opSetPersPresence.createVolatileContact(conversation.getBuddy().getFormatted());
  }
  long current=System.currentTimeMillis();
  long msgDate=minfo.getTimestamp().getTime();
  if ((current + ONE_DAY) > msgDate)   msgDate=current;
  MessageReceivedEvent msgReceivedEvt=new MessageReceivedEvent(newMessage,sourceContact,msgDate);
  if (msgReceivedEvt != null) {
    logger.debug("fire msg received for : " + newMessage);
    fireMessageEvent(msgReceivedEvt);
  }
}
