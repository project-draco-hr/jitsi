{
  mockBImOpSet.deliverMessage(TEST_CONTACT_NAME_1,messagesToSend[5]);
  waitWrite(500);
  historyService.purgeLocallyCachedHistories();
  Collection<EventObject> rs=msgHistoryService.findLast(testMetaContact,3);
  assertTrue("Nothing found 8",!rs.isEmpty());
  List<String> msgs=getMessages(rs);
  assertEquals("Messages must be 3",3,msgs.size());
  assertTrue("Message no found",msgs.contains(messagesToSend[3].getContent()));
  assertTrue("Message no found",msgs.contains(messagesToSend[4].getContent()));
  assertTrue("Message no found",msgs.contains(XmlEscapers.xmlContentEscaper().escape(messagesToSend[5].getContent())));
}
