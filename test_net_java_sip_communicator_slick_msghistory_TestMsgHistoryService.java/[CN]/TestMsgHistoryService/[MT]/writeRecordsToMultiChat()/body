{
  try {
    ChatRoom room=mockMultiChat.createChatRoom("test_room",null);
    room.join();
    room.sendMessage(messagesToSend[0]);
    TestMsgHistoryService.controlDate1=new Date();
    Object lock=new Object();
synchronized (lock) {
      try {
        lock.wait(200);
      }
 catch (      InterruptedException ex) {
      }
    }
    room.sendMessage(messagesToSend[1]);
    room.sendMessage(messagesToSend[2]);
    TestMsgHistoryService.controlDate2=new Date();
synchronized (lock) {
      try {
        lock.wait(200);
      }
 catch (      InterruptedException ex) {
      }
    }
    room.sendMessage(messagesToSend[3]);
    room.sendMessage(messagesToSend[4]);
  }
 catch (  OperationFailedException ex) {
    fail("Failed to create room : " + ex.getMessage());
    logger.error("Failed to create room",ex);
  }
catch (  OperationNotSupportedException ex) {
    fail("Failed to create room : " + ex.getMessage());
    logger.error("Failed to create room",ex);
  }
}
