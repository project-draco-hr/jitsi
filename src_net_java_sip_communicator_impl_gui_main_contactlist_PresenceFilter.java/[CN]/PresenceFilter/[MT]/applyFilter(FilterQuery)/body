{
  MetaContactQuery query=new MetaContactQuery();
  filterQuery.addContactQuery(query);
  List<ContactQuery> contactQueryList=new ArrayList<ContactQuery>();
  for (  int cssType : contactSourcePreferences.keySet()) {
    Iterator<UIContactSource> filterSources=GuiActivator.getContactList().getContactSources(cssType).iterator();
    while (filterSources.hasNext()) {
      UIContactSource filterSource=filterSources.next();
      Integer prefValue=contactSourcePreferences.get(cssType);
      if (prefValue != null)       filterSource.setContactSourceIndex(prefValue);
      ContactSourceService sourceService=filterSource.getContactSourceService();
      ContactQuery contactQuery=sourceService.queryContactSource(null);
      contactQueryList.add(contactQuery);
      filterQuery.addContactQuery(contactQuery);
    }
  }
  filterQuery.close();
  query.addContactQueryListener(GuiActivator.getContactList());
  int resultCount=0;
  addMatching(GuiActivator.getContactListService().getRoot(),query,resultCount);
  for (  ContactQuery contactQuery : contactQueryList) {
    for (    SourceContact contact : contactQuery.getQueryResults()) {
      addSourceContact(contact);
    }
    contactQuery.addContactQueryListener(GuiActivator.getContactList());
  }
  query.fireQueryEvent(query.isCanceled() ? MetaContactQueryStatusEvent.QUERY_CANCELED : MetaContactQueryStatusEvent.QUERY_COMPLETED);
}
