{
  Iterator<MetaContact> childContacts=metaGroup.getChildContacts();
  while (childContacts.hasNext() && !query.isCanceled()) {
    MetaContact metaContact=childContacts.next();
    if (isMatching(metaContact)) {
synchronized (metaContact) {
        resultCount++;
        if (resultCount <= INITIAL_CONTACT_COUNT) {
          UIGroup uiGroup=null;
          if (!MetaContactListSource.isRootGroup(metaGroup)) {
            uiGroup=MetaContactListSource.getUIGroup(metaGroup);
            if (uiGroup == null)             uiGroup=MetaContactListSource.createUIGroup(metaGroup);
          }
          if (logger.isDebugEnabled())           logger.debug("Presence filter contact added: " + metaContact.getDisplayName());
          UIContact uiContact=MetaContactListSource.getUIContact(metaContact);
          if (uiContact != null)           continue;
          uiContact=MetaContactListSource.createUIContact(metaContact);
          GuiActivator.getContactList().addContact(uiContact,uiGroup,true,true);
          query.setInitialResultCount(resultCount);
        }
 else         query.fireQueryEvent(metaContact);
      }
    }
  }
  if (query.isCanceled())   return;
  Iterator<MetaContactGroup> subgroups=metaGroup.getSubgroups();
  while (subgroups.hasNext() && !query.isCanceled()) {
    MetaContactGroup subgroup=subgroups.next();
    if (isMatching(subgroup)) {
      GuiActivator.getContactList().addGroup(MetaContactListSource.createUIGroup(subgroup),true);
      addMatching(subgroup,query,resultCount);
    }
  }
}
