{
  AccountManager accountManager=GuiActivator.getAccountManager();
  Iterator<AccountID> storedAccounts=accountManager.getStoredAccounts().iterator();
  while (storedAccounts.hasNext()) {
    AccountID accountID=storedAccounts.next();
    boolean isHidden=accountID.getAccountPropertyBoolean(ProtocolProviderFactory.IS_PROTOCOL_HIDDEN,false);
    if (isHidden)     continue;
    Account uiAccount=null;
    if (accountManager.isAccountLoaded(accountID)) {
      ProtocolProviderService protocolProvider=GuiActivator.getRegisteredProviderForAccount(accountID);
      if (protocolProvider != null) {
        uiAccount=new Account(protocolProvider);
        protocolProvider.addRegistrationStateChangeListener(this);
        OperationSetPresence presence=protocolProvider.getOperationSet(OperationSetPresence.class);
        if (presence != null) {
          presence.addProviderPresenceStatusListener(this);
        }
      }
    }
 else     uiAccount=new Account(accountID);
    if (uiAccount != null)     accountListModel.addAccount(uiAccount);
  }
}
