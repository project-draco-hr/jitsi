{
  if (event.getServiceReference().getBundle().getState() == Bundle.STOPPING) {
    return;
  }
  Object sourceService=GuiActivator.bundleContext.getService(event.getServiceReference());
  if (!(sourceService instanceof ProtocolProviderService)) {
    return;
  }
  ProtocolProviderService protocolProvider=(ProtocolProviderService)sourceService;
  boolean isHidden=(protocolProvider.getAccountID().getAccountProperty(ProtocolProviderFactory.IS_PROTOCOL_HIDDEN) != null);
  if (isHidden)   return;
  if (event.getType() == ServiceEvent.REGISTERED) {
    OperationSetPresence presence=protocolProvider.getOperationSet(OperationSetPresence.class);
    if (presence != null) {
      presence.addProviderPresenceStatusListener(this);
    }
    Account account=accountListModel.getAccount(protocolProvider.getAccountID());
    if (account != null)     account.setProtocolProvider(protocolProvider);
 else     accountListModel.addAccount(new Account(protocolProvider));
    this.repaint();
  }
 else   if (event.getType() == ServiceEvent.UNREGISTERING) {
    Account account=accountListModel.getAccount(protocolProvider.getAccountID());
    if (account != null && account.isEnabled())     accountListModel.removeElement(account);
  }
}
