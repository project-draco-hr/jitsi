{
  if (event.getServiceReference().getBundle().getState() == Bundle.STOPPING) {
    return;
  }
  Object sourceService=GuiActivator.bundleContext.getService(event.getServiceReference());
  if (!(sourceService instanceof ProtocolProviderService)) {
    return;
  }
  ProtocolProviderService protocolProvider=(ProtocolProviderService)sourceService;
  boolean isHidden=(protocolProvider.getAccountID().getAccountProperty(ProtocolProviderFactory.IS_PROTOCOL_HIDDEN) != null);
  if (isHidden)   return;
  if (event.getType() == ServiceEvent.REGISTERED) {
    OperationSetPresence presence=protocolProvider.getOperationSet(OperationSetPresence.class);
    if (presence != null) {
      presence.addProviderPresenceStatusListener(this);
    }
    accountListModel.addAccount(new Account(protocolProvider));
  }
 else   if (event.getType() == ServiceEvent.UNREGISTERING) {
    for (    Object accountListModelElement : accountListModel.toArray()) {
      Account account=(Account)accountListModelElement;
      if (account.getProtocolProvider().equals(protocolProvider))       accountListModel.removeElement(account);
    }
  }
}
