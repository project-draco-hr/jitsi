{
  byte[] input=(byte[])inputBuffer.getData();
  int inputLength=inputBuffer.getLength();
  if (inputLength < INPUT_FRAME_SIZE_IN_BYTES) {
    discardOutputBuffer(outputBuffer);
    return BUFFER_PROCESSED_OK | OUTPUT_BUFFER_NOT_FILLED;
  }
  int inputOffset=inputBuffer.getOffset();
  depacketize(input,inputOffset,serial);
  inputLength-=INPUT_FRAME_SIZE_IN_BYTES;
  inputBuffer.setLength(inputLength);
  inputOffset+=INPUT_FRAME_SIZE_IN_BYTES;
  inputBuffer.setOffset(inputOffset);
  decoder.process(serial,sp16);
  int outputOffset=outputBuffer.getOffset();
  byte[] output=validateByteArraySize(outputBuffer,outputOffset + OUTPUT_FRAME_SIZE_IN_BYTES);
  writeShorts(sp16,output,outputOffset);
  outputBuffer.setLength(OUTPUT_FRAME_SIZE_IN_BYTES);
  int processResult=BUFFER_PROCESSED_OK;
  if (inputLength > 0)   processResult|=INPUT_BUFFER_NOT_CONSUMED;
  return processResult;
}
