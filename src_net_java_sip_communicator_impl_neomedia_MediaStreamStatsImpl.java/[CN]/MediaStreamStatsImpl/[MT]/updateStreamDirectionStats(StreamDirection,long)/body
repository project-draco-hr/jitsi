{
  int streamDirectionIndex=streamDirection.ordinal();
  long newNbRecv=this.getNbPDU(streamDirection);
  long newNbByte=this.getNbBytes(streamDirection);
  long nbSteps=newNbRecv - this.nbPackets[streamDirectionIndex];
  if (nbSteps == 0) {
    nbSteps=(currentTimeMs - this.updateTimeMs) / 20;
  }
  if (streamDirection == StreamDirection.DOWNLOAD) {
    long newNbLost=this.getDownloadNbPDULost() - this.nbLost[streamDirectionIndex];
    updateNbLoss(streamDirection,newNbLost,nbSteps + newNbLost);
  }
  double newRateKiloBitPerSec=MediaStreamStatsImpl.computeRateKiloBitPerSec(newNbByte - this.nbByte[streamDirectionIndex],currentTimeMs - this.updateTimeMs);
  this.rateKiloBitPerSec[streamDirectionIndex]=MediaStreamStatsImpl.computeEWMA(nbSteps,this.rateKiloBitPerSec[streamDirectionIndex],newRateKiloBitPerSec);
  this.nbPackets[streamDirectionIndex]=newNbRecv;
  this.nbByte[streamDirectionIndex]=newNbByte;
}
