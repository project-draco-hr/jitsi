{
  try {
    FromHeader fromHeader=null;
    try {
      fromHeader=provider.getHeaderFactory().createFromHeader(provider.getOurSipAddress(),ProtocolProviderServiceSipImpl.generateLocalTag());
    }
 catch (    ParseException ex) {
      logger.error("Failed to generate a from header for our register request.",ex);
      return;
    }
    CallIdHeader callIdHeader=provider.getDefaultJainSipProvider().getNewCallId();
    CSeqHeader cSeqHeader=null;
    try {
      cSeqHeader=provider.getHeaderFactory().createCSeqHeader(getNextCSeqValue(),Request.OPTIONS);
    }
 catch (    ParseException ex) {
      logger.error("Corrupt Sip Stack",ex);
      return;
    }
catch (    InvalidArgumentException ex) {
      logger.error("The application is corrupt",ex);
      return;
    }
    ToHeader toHeader=null;
    try {
      toHeader=provider.getHeaderFactory().createToHeader(provider.getOurSipAddress(),null);
    }
 catch (    ParseException ex) {
      logger.error("Could not create a To header for address:" + fromHeader.getAddress(),ex);
      return;
    }
    InetAddress destinationInetAddress=null;
    try {
      destinationInetAddress=InetAddress.getByName(((SipURI)provider.getOurSipAddress().getURI()).getHost());
    }
 catch (    UnknownHostException ex) {
      logger.error(ex);
      return;
    }
    ArrayList viaHeaders=provider.getLocalViaHeaders(destinationInetAddress,provider.getDefaultListeningPoint());
    MaxForwardsHeader maxForwardsHeader=provider.getMaxForwardsHeader();
    Request request=null;
    try {
      String domain=((SipURI)toHeader.getAddress().getURI()).getHost();
      SipURI requestURI=provider.getAddressFactory().createSipURI(null,domain);
      request=provider.getMessageFactory().createRequest(requestURI,Request.OPTIONS,callIdHeader,cSeqHeader,fromHeader,toHeader,viaHeaders,maxForwardsHeader);
    }
 catch (    ParseException ex) {
      logger.error("Could not create the register request!",ex);
      return;
    }
    Iterator supportedMethods=provider.getSupportedMethods().iterator();
    while (supportedMethods.hasNext()) {
      String method=(String)supportedMethods.next();
      if (method.equals(Request.REGISTER))       continue;
      request.addHeader(provider.getHeaderFactory().createAllowHeader(method));
    }
    Iterator events=provider.getKnownEventsList().iterator();
synchronized (provider.getKnownEventsList()) {
      while (events.hasNext()) {
        String event=(String)events.next();
        request.addHeader(provider.getHeaderFactory().createAllowEventsHeader(event));
      }
    }
    UserAgentHeader userAgentHeader=provider.getSipCommUserAgentHeader();
    if (userAgentHeader != null)     request.addHeader(userAgentHeader);
    ContactHeader contactHeader=provider.getContactHeader(destinationInetAddress,provider.getDefaultListeningPoint());
    request.addHeader(contactHeader);
    ClientTransaction optionsTrans=null;
    try {
      optionsTrans=provider.getDefaultJainSipProvider().getNewClientTransaction(request);
    }
 catch (    TransactionUnavailableException ex) {
      logger.error("Could not create a register transaction!\n" + "Check that the Registrar address is correct!",ex);
      return;
    }
    try {
      optionsTrans.sendRequest();
      logger.debug("sent request= " + request);
    }
 catch (    Exception ex) {
      logger.error("Could not send out the register request!",ex);
      return;
    }
  }
 catch (  Exception ex) {
    logger.error("Cannot send OPTIONS keep alive",ex);
  }
}
