{
  MediaFormat mediaFormat=createMediaFormat(encoding,clockRate,channels);
  Map<String,String> formatParameters=new HashMap<String,String>();
  Map<String,String> advancedParameters=new HashMap<String,String>();
  boolean recreate=false;
  if ((mediaFormat != null) && (formatParams != null) && !formatParams.isEmpty()) {
    recreate=true;
    formatParameters.putAll(formatParams);
  }
 else   if (mediaFormat != null && (advancedParams != null) && !advancedParams.isEmpty()) {
    recreate=true;
    if (advancedParams != null) {
      advancedParameters.putAll(advancedParams);
    }
  }
  if (recreate) {
switch (mediaFormat.getMediaType()) {
case AUDIO:
      mediaFormat=new AudioMediaFormatImpl(((AudioMediaFormatImpl)mediaFormat).getFormat(),formatParameters,advancedParameters);
    break;
case VIDEO:
  VideoMediaFormatImpl videoMediaFormatImpl=(VideoMediaFormatImpl)mediaFormat;
mediaFormat=new VideoMediaFormatImpl(videoMediaFormatImpl.getFormat(),videoMediaFormatImpl.getClockRate(),formatParameters,advancedParameters);
break;
default :
mediaFormat=null;
}
}
return mediaFormat;
}
