{
  MediaFormat mediaFormat=createMediaFormat(encoding,clockRate,channels);
  if ((mediaFormat != null) && (formatParams != null) && !formatParams.isEmpty()) {
    Map<String,String> formatParameters=new HashMap<String,String>();
    Map<String,String> advancedParameters=new HashMap<String,String>();
    formatParameters.putAll(formatParams);
    if (advancedParams != null) {
      advancedParameters.putAll(advancedParams);
    }
switch (mediaFormat.getMediaType()) {
case AUDIO:
      mediaFormat=new AudioMediaFormatImpl(((AudioMediaFormatImpl)mediaFormat).getFormat(),formatParameters,advancedParameters);
    break;
case VIDEO:
  VideoMediaFormatImpl videoMediaFormatImpl=(VideoMediaFormatImpl)mediaFormat;
mediaFormat=new VideoMediaFormatImpl(videoMediaFormatImpl.getFormat(),videoMediaFormatImpl.getClockRate(),formatParameters,advancedParameters);
break;
default :
mediaFormat=null;
}
}
return mediaFormat;
}
