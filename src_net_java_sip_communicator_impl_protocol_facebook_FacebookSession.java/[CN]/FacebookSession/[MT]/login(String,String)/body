{
  if (this.isLoggedIn())   throw new IllegalStateException("already logged in");
  HttpGet loginGet=new HttpGet(LOGIN_PAGE_URL);
  HttpResponse getLoginResponse=httpClient.execute(loginGet);
  int getLoginStatusCode=getLoginResponse.getStatusLine().getStatusCode();
  getLoginResponse.getEntity().consumeContent();
  if (getLoginStatusCode != 200)   throw new BrokenFacebookProtocolException("Unable to GET Facebook login page");
  HttpPost httpost=new HttpPost(LOGIN_PAGE_URL);
  List<NameValuePair> nvps=new ArrayList<NameValuePair>();
  nvps.add(new BasicNameValuePair("email",email));
  nvps.add(new BasicNameValuePair("pass",password));
  nvps.add(new BasicNameValuePair("login",""));
  httpost.setEntity(new UrlEncodedFormEntity(nvps,HTTP.UTF_8));
  HttpResponse postLoginResponse=httpClient.execute(httpost);
  int postLoginStatusCode=postLoginResponse.getStatusLine().getStatusCode();
  String postBody=EntityUtils.toString(postLoginResponse.getEntity());
  if (postLoginStatusCode >= 400)   throw new BrokenFacebookProtocolException("Code " + postLoginStatusCode + ". Unable to POST Facebook login credentials.");
  String uid=parseUid(postBody);
  String channel=parseChannel(postBody);
  String formId=parseFormId(postBody);
  if (uid == null || channel == null || formId == null) {
    HttpGet channelGet=new HttpGet(POPOUT_PAGE_URL);
    HttpResponse channelResponse=httpClient.execute(channelGet);
    String channelBody=EntityUtils.toString(channelResponse.getEntity());
    if (channel == null)     channel=parseChannel(channelBody);
    if (formId == null)     formId=parseFormId(channelBody);
  }
  if (uid == null || channel == null || formId == null) {
    HttpGet homeGet=new HttpGet(HOME_PAGE_URL);
    HttpResponse homeResponse=httpClient.execute(homeGet);
    String homeBody=EntityUtils.toString(homeResponse.getEntity());
    if (uid == null)     uid=parseUid(homeBody);
    if (channel == null)     channel=parseChannel(homeBody);
    if (formId == null)     formId=parseFormId(homeBody);
  }
  if (uid != null && channel != null && formId != null) {
    this.uid=uid;
    this.channel=channel;
    this.formId=formId;
    this.loggedIn=true;
    this.buddyListRefresher=new BuddyListRefresher(this);
    Thread buddyListThread=new Thread(this.buddyListRefresher,"facebook buddy list refresher " + this.hashCode());
    buddyListThread.start();
    this.pollerRefresher=new PollerRefresher(this);
    Thread pollerRefresher=new Thread(this.pollerRefresher,"facebook messages refresher " + this.hashCode());
    pollerRefresher.start();
    return this.loggedIn;
  }
 else   if (uid != null | channel != null | formId != null) {
    throw new BrokenFacebookProtocolException("One of the session elements could not be read from the home page. UID: " + uid + " - CHANNEL: "+ channel+ " - FORMID: "+ formId);
  }
 else {
    this.loggedIn=false;
    return false;
  }
}
