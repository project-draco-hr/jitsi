{
  assertSupportedAndConnected();
  ChatRoom room=null;
  if (roomName == null)   roomName="chatroom-" + StringUtils.randomString(4);
 else   room=findRoom(roomName);
  if (room == null) {
    if (logger.isInfoEnabled())     logger.info("Find room returns null.");
    if (getXmppConnection().getHost().toLowerCase().contains("google")) {
      roomName="private-chat-" + UUID.randomUUID().toString() + "@groupchat.google.com";
    }
    MultiUserChat muc=null;
    try {
      muc=new MultiUserChat(getXmppConnection(),getCanonicalRoomName(roomName));
      muc.create(StringUtils.parseName(getXmppConnection().getUser()));
    }
 catch (    XMPPException ex) {
      logger.error("Failed to create chat room.",ex);
      throw new OperationFailedException("Failed to create chat room",ex.getXMPPError().getCode(),ex.getCause());
    }
    try {
      muc.sendConfigurationForm(new Form(Form.TYPE_SUBMIT));
    }
 catch (    XMPPException e) {
      logger.error("Failed to send config form.",e);
    }
    room=createLocalChatRoomInstance(muc);
    room.setLocalUserRole(ChatRoomMemberRole.MODERATOR);
  }
  return room;
}
