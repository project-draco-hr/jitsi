{
  String password=FacebookActivator.getProtocolProviderFactory().loadPassword(getAccountID());
  if (password == null) {
    UserCredentials credentials=new UserCredentials();
    credentials.setUserName(getAccountID().getUserID());
    credentials=authority.obtainCredentials(ProtocolNames.FACEBOOK,credentials,SecurityAuthority.AUTHENTICATION_REQUIRED);
    char[] pass=credentials.getPassword();
    if (pass == null) {
      fireRegistrationStateChanged(getRegistrationState(),RegistrationState.UNREGISTERED,RegistrationStateChangeEvent.REASON_USER_REQUEST,"");
      return;
    }
    password=new String(pass);
    if (credentials.isPasswordPersistent()) {
      FacebookActivator.getProtocolProviderFactory().storePassword(getAccountID(),password);
    }
  }
  RegistrationState oldState=currentRegistrationState;
  int initErrorCode=FacebookErrorException.Error_Global_NoError;
  if (!facebookAdapter.initialize(getAccountID().getUserID(),password)) {
    initErrorCode=FacebookErrorException.kError_Login_GenericError;
  }
  if (initErrorCode == FacebookErrorException.Error_Global_NoError) {
    currentRegistrationState=RegistrationState.REGISTERED;
    fireRegistrationStateChanged(oldState,currentRegistrationState,RegistrationStateChangeEvent.REASON_USER_REQUEST,null);
  }
 else {
    fireRegistrationStateChanged(getRegistrationState(),RegistrationState.UNREGISTERED,RegistrationStateChangeEvent.REASON_SERVER_NOT_FOUND,"");
  }
}
