{
  AdHocChatRoomWrapper chatRoomWrapper=null;
  OperationSetAdHocMultiUserChat groupChatOpSet=protocolProvider.getOperationSet(OperationSetAdHocMultiUserChat.class);
  if (groupChatOpSet == null)   return null;
  AdHocChatRoom chatRoom=null;
  try {
    List<Contact> members=new LinkedList<Contact>();
    OperationSetPersistentPresence opSet=protocolProvider.getOperationSet(OperationSetPersistentPresence.class);
    for (    String contact : contacts) {
      members.add(opSet.findContactByID(contact));
    }
    chatRoom=groupChatOpSet.createAdHocChatRoom(null,members);
  }
 catch (  OperationFailedException ex) {
    new ErrorDialog(GuiActivator.getUIService().getMainFrame(),GuiActivator.getResources().getI18NString("service.gui.ERROR"),GuiActivator.getResources().getI18NString("service.gui.CREATE_CHAT_ROOM_ERROR",new String[]{protocolProvider.getProtocolName()}),ex).showDialog();
  }
catch (  OperationNotSupportedException ex) {
    new ErrorDialog(GuiActivator.getUIService().getMainFrame(),GuiActivator.getResources().getI18NString("service.gui.ERROR"),GuiActivator.getResources().getI18NString("service.gui.CREATE_CHAT_ROOM_ERROR",new String[]{protocolProvider.getProtocolName()}),ex).showDialog();
  }
  if (chatRoom != null) {
    AdHocChatRoomProviderWrapper parentProvider=adHocChatRoomList.findServerWrapperFromProvider(protocolProvider);
    chatRoomWrapper=new AdHocChatRoomWrapper(parentProvider,chatRoom);
    parentProvider.addAdHocChatRoom(chatRoomWrapper);
    adHocChatRoomList.addAdHocChatRoom(chatRoomWrapper);
    fireAdHocChatRoomListChangedEvent(chatRoomWrapper,AdHocChatRoomListChangeEvent.AD_HOC_CHAT_ROOM_ADDED);
  }
  return chatRoomWrapper;
}
