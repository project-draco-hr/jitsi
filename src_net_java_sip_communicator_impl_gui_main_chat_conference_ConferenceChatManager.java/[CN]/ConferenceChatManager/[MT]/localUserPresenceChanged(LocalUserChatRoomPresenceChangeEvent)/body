{
  if (!SwingUtilities.isEventDispatchThread()) {
    SwingUtilities.invokeLater(new Runnable(){
      @Override public void run(){
        localUserPresenceChanged(evt);
      }
    }
);
    return;
  }
  ChatRoom sourceChatRoom=evt.getChatRoom();
  ChatRoomWrapper chatRoomWrapper=chatRoomList.findChatRoomWrapperFromChatRoom(sourceChatRoom);
  String eventType=evt.getEventType();
  if (LocalUserChatRoomPresenceChangeEvent.LOCAL_USER_JOINED.equals(eventType)) {
    if (chatRoomWrapper != null) {
      this.fireChatRoomListChangedEvent(chatRoomWrapper,ChatRoomListChangeEvent.CHAT_ROOM_CHANGED);
      ChatWindowManager chatWindowManager=GuiActivator.getUIService().getChatWindowManager();
      ChatPanel chatPanel=chatWindowManager.getMultiChat(chatRoomWrapper,true);
      if (chatPanel.isShown())       ((ConferenceChatSession)chatPanel.getChatSession()).loadChatRoom(sourceChatRoom);
 else       chatWindowManager.openChat(chatPanel,true);
    }
    if (sourceChatRoom.isSystem()) {
      ChatRoomProviderWrapper serverWrapper=chatRoomList.findServerWrapperFromProvider(sourceChatRoom.getParentProvider());
      serverWrapper.setSystemRoom(sourceChatRoom);
    }
    sourceChatRoom.addMessageListener(this);
  }
 else   if (LocalUserChatRoomPresenceChangeEvent.LOCAL_USER_JOIN_FAILED.equals(eventType)) {
    new ErrorDialog(GuiActivator.getUIService().getMainFrame(),GuiActivator.getResources().getI18NString("service.gui.ERROR"),GuiActivator.getResources().getI18NString("service.gui.FAILED_TO_JOIN_CHAT_ROOM",new String[]{sourceChatRoom.getName()}) + evt.getReason()).showDialog();
  }
 else   if (LocalUserChatRoomPresenceChangeEvent.LOCAL_USER_LEFT.equals(eventType) || LocalUserChatRoomPresenceChangeEvent.LOCAL_USER_KICKED.equals(eventType) || LocalUserChatRoomPresenceChangeEvent.LOCAL_USER_DROPPED.equals(eventType)) {
    this.closeChatRoom(chatRoomWrapper);
    fireChatRoomListChangedEvent(chatRoomWrapper,ChatRoomListChangeEvent.CHAT_ROOM_CHANGED);
    sourceChatRoom.removeMessageListener(this);
  }
}
