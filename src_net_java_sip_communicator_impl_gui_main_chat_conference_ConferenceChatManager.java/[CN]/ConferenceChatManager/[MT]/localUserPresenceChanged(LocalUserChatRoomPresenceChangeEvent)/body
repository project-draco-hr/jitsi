{
  ChatRoom sourceChatRoom=evt.getChatRoom();
  ChatRoomWrapper chatRoomWrapper=chatRoomList.findChatRoomWrapperFromChatRoom(sourceChatRoom);
  if (evt.getEventType().equals(LocalUserChatRoomPresenceChangeEvent.LOCAL_USER_JOINED)) {
    if (chatRoomWrapper != null) {
      this.fireChatRoomListChanedEvent(chatRoomWrapper,ChatRoomListChangeEvent.CHAT_ROOM_CHANGED);
      ChatWindowManager chatWindowManager=GuiActivator.getUIService().getChatWindowManager();
      ChatPanel chatPanel=chatWindowManager.getMultiChat(chatRoomWrapper);
      if (chatWindowManager.isChatOpenedForChatRoom(chatRoomWrapper)) {
        ((ConferenceChatSession)chatPanel.getChatSession()).loadChatRoom(sourceChatRoom);
      }
 else {
        chatWindowManager.openChat(chatPanel,true);
      }
    }
    if (sourceChatRoom.isSystem()) {
      ChatRoomProviderWrapper serverWrapper=chatRoomList.findServerWrapperFromProvider(sourceChatRoom.getParentProvider());
      serverWrapper.setSystemRoom(sourceChatRoom);
    }
    sourceChatRoom.addMessageListener(this);
  }
 else   if (evt.getEventType().equals(LocalUserChatRoomPresenceChangeEvent.LOCAL_USER_JOIN_FAILED)) {
    new ErrorDialog(GuiActivator.getUIService().getMainFrame(),Messages.getI18NString("error").getText(),Messages.getI18NString("failedToJoinChatRoom",new String[]{sourceChatRoom.getName()}).getText() + evt.getReason()).showDialog();
  }
 else   if (evt.getEventType().equals(LocalUserChatRoomPresenceChangeEvent.LOCAL_USER_LEFT)) {
    this.closeChatRoom(chatRoomWrapper);
    fireChatRoomListChanedEvent(chatRoomWrapper,ChatRoomListChangeEvent.CHAT_ROOM_CHANGED);
    sourceChatRoom.removeMessageListener(this);
  }
 else   if (evt.getEventType().equals(LocalUserChatRoomPresenceChangeEvent.LOCAL_USER_KICKED)) {
    this.closeChatRoom(chatRoomWrapper);
    fireChatRoomListChanedEvent(chatRoomWrapper,ChatRoomListChangeEvent.CHAT_ROOM_CHANGED);
    sourceChatRoom.removeMessageListener(this);
  }
 else   if (evt.getEventType().equals(LocalUserChatRoomPresenceChangeEvent.LOCAL_USER_DROPPED)) {
    this.closeChatRoom(chatRoomWrapper);
    fireChatRoomListChanedEvent(chatRoomWrapper,ChatRoomListChangeEvent.CHAT_ROOM_CHANGED);
    sourceChatRoom.removeMessageListener(this);
  }
}
