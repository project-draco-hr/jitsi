{
  if (room.getChatRoom() == null) {
    room=GuiActivator.getMUCService().createChatRoom(room.getChatRoomName(),room.getParentProvider().getProtocolProvider(),new ArrayList<String>(),"",false,false,true);
    if (room.getChatRoom().isJoined())     room.getChatRoom().leave();
  }
  String savedNick=ConfigurationUtils.getChatRoomProperty(room.getParentProvider().getProtocolProvider(),room.getChatRoomID(),"userNickName");
  if (savedNick == null) {
    String[] joinOptions=getJoinOptions(room.getParentProvider().getProtocolProvider(),room.getChatRoomID());
    String nickName=joinOptions[0];
    if (nickName == null)     return;
    if (!room.getChatRoom().isJoined()) {
      GuiActivator.getMUCService().joinChatRoom(room,nickName,null,joinOptions[1]);
    }
  }
 else {
    if (!room.getChatRoom().isJoined())     GuiActivator.getMUCService().joinChatRoom(room,savedNick,null);
  }
  ChatWindowManager chatWindowManager=GuiActivator.getUIService().getChatWindowManager();
  ChatPanel chatPanel=chatWindowManager.getMultiChat(room,true);
  chatWindowManager.openChat(chatPanel,true);
}
