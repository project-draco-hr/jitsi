{
  ChatRoomWrapper chatRoomWrapper=null;
  OperationSetMultiUserChat groupChatOpSet=protocolProvider.getOperationSet(OperationSetMultiUserChat.class);
  if (groupChatOpSet == null)   return null;
  ChatRoom chatRoom=null;
  try {
    Map<String,Object> members=new Hashtable<String,Object>();
    OperationSetPersistentPresence opSet=protocolProvider.getOperationSet(OperationSetPersistentPresence.class);
    for (    String contact : contacts) {
      members.put(contact,opSet.findContactByID(contact));
    }
    chatRoom=groupChatOpSet.createChatRoom(chatRoomName,members);
  }
 catch (  OperationFailedException ex) {
    logger.error("Failed to create chat room.",ex);
    new ErrorDialog(GuiActivator.getUIService().getMainFrame(),GuiActivator.getResources().getI18NString("service.gui.ERROR"),GuiActivator.getResources().getI18NString("service.gui.CREATE_CHAT_ROOM_ERROR",new String[]{chatRoomName}),ex).showDialog();
  }
catch (  OperationNotSupportedException ex) {
    logger.error("Failed to create chat room.",ex);
    new ErrorDialog(GuiActivator.getUIService().getMainFrame(),GuiActivator.getResources().getI18NString("service.gui.ERROR"),GuiActivator.getResources().getI18NString("service.gui.CREATE_CHAT_ROOM_ERROR",new String[]{chatRoomName}),ex).showDialog();
  }
  if (chatRoom != null) {
    ChatRoomProviderWrapper parentProvider=chatRoomList.findServerWrapperFromProvider(protocolProvider);
    chatRoomWrapper=new ChatRoomWrapper(parentProvider,chatRoom);
    chatRoomList.addChatRoom(chatRoomWrapper);
    fireChatRoomListChangedEvent(chatRoomWrapper,ChatRoomListChangeEvent.CHAT_ROOM_ADDED);
  }
  return chatRoomWrapper;
}
