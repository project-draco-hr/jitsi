{
  if (!this.chatPanel.isWriteAreaEmpty()) {
    OperationSetBasicInstantMessaging im=this.chatPanel.getImOperationSet();
    Message msg=im.createMessage(chatPanel.getTextFromWriteArea());
    this.chatPanel.getChatWindow().getMainFrame().getWaitToBeDeliveredMsgs().put(msg.getMessageUID(),this.chatPanel);
    Contact contact=(Contact)contactSelectorBox.getMenu().getSelectedObject();
    if (chatPanel.getTnOperationSet() != null) {
      chatPanel.stopTypingNotifications();
    }
    chatPanel.requestFocusInWriteArea();
    try {
      im.sendInstantMessage(contact,msg);
    }
 catch (    IllegalStateException ex) {
      SIPCommMsgTextArea errorMsg=new SIPCommMsgTextArea(Messages.getString("msgSendConnectionProblem"));
      String title=Messages.getString("msgDeliveryFailure");
      JOptionPane.showMessageDialog(this,errorMsg,title,JOptionPane.WARNING_MESSAGE);
    }
  }
}
