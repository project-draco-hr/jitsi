{
  JEditorPane messagePane=this.chatPanel.getWriteMessagePanel().getEditorPane();
  if (messagePane.getText() != null && !messagePane.getText().equals("")) {
    OperationSetBasicInstantMessaging im=this.chatPanel.getImOperationSet();
    Message msg=im.createMessage(messagePane.getText());
    this.chatPanel.getChatWindow().getMainFrame().getWaitToBeDeliveredMsgs().put(msg.getMessageUID(),this.chatPanel);
    Contact contact=(Contact)contactSelectorBox.getSelectedObject();
    chatPanel.getWriteMessagePanel().stopTyping();
    try {
      im.sendInstantMessage(contact,msg);
    }
 catch (    IllegalStateException ex) {
      String errorMsg=Messages.getString("msgSendConnectionProblem");
      String title=Messages.getString("msgDeliveryFailure");
      JOptionPane.showMessageDialog(this,errorMsg,title,JOptionPane.WARNING_MESSAGE);
    }
  }
}
