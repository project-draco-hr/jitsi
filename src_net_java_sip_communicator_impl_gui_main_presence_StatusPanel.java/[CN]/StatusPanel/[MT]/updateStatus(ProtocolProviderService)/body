{
  StatusSelectorBox selectorBox=(StatusSelectorBox)protocolStatusCombos.get(protocolProvider);
  if (selectorBox == null)   return;
  if (selectorBox instanceof PresenceStatusSelectorBox) {
    PresenceStatusSelectorBox presenceSelectorBox=(PresenceStatusSelectorBox)selectorBox;
    if (!protocolProvider.isRegistered())     presenceSelectorBox.updateStatus(presenceSelectorBox.getOfflineStatus());
 else {
      if (presenceSelectorBox.getLastSelectedStatus() != null) {
        presenceSelectorBox.updateStatus(presenceSelectorBox.getLastSelectedStatus());
      }
 else {
        PresenceStatus lastStatus=getLastPresenceStatus(protocolProvider);
        if (lastStatus == null) {
          presenceSelectorBox.updateStatus(presenceSelectorBox.getOnlineStatus());
        }
 else {
          presenceSelectorBox.updateStatus(lastStatus);
        }
      }
    }
  }
 else {
    ((SimpleStatusSelectorBox)selectorBox).updateStatus();
  }
  selectorBox.repaint();
}
