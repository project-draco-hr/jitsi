{
  String sourcePackageName=getFactoryImplPackageName();
  ServiceReference confReference=bundleContext.getServiceReference(ConfigurationService.class.getName());
  ConfigurationService configurationService=(ConfigurationService)bundleContext.getService(confReference);
  List storedAccounts=configurationService.getPropertyNamesByPrefix(sourcePackageName,true);
  logger.debug("Discovered " + storedAccounts.size() + " stored accounts");
  Iterator storedAccountsIter=storedAccounts.iterator();
  while (storedAccountsIter.hasNext()) {
    String accountRootPropName=(String)storedAccountsIter.next();
    logger.debug("Loading account " + accountRootPropName);
    List storedAccPropNames=configurationService.getPropertyNamesByPrefix(accountRootPropName,true);
    Iterator propNamesIter=storedAccPropNames.iterator();
    Map accountProperties=new Hashtable();
    while (propNamesIter.hasNext()) {
      String fullPropertyName=(String)propNamesIter.next();
      String storedPropertyValue=configurationService.getString(fullPropertyName);
      String propertyName=fullPropertyName.substring(fullPropertyName.lastIndexOf('.') + 1);
      if (propertyName.equals(PASSWORD)) {
        if (storedPropertyValue == null || storedPropertyValue.length() == 0) {
          storedPropertyValue="";
        }
 else {
          storedPropertyValue=new String(Base64.decode(storedPropertyValue));
        }
      }
      accountProperties.put(propertyName,storedPropertyValue);
    }
    loadAccount(accountProperties);
  }
}
