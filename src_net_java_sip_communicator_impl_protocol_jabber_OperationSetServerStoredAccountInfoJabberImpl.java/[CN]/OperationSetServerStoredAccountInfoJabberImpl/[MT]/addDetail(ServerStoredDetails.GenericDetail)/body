{
  assertConnected();
  Iterator<GenericDetail> iter=getDetails(detail.getClass());
  int currentDetailsSize=0;
  while (iter.hasNext()) {
    currentDetailsSize++;
  }
  if (currentDetailsSize >= getMaxDetailInstances(detail.getClass())) {
    throw new ArrayIndexOutOfBoundsException("Max count for this detail is already reached");
  }
  if (detail instanceof ImageDetail) {
    try {
      VCard v1=new VCard();
      v1.load(jabberProvider.getConnection());
      v1.setAvatar(((ImageDetail)detail).getBytes());
      v1.save(jabberProvider.getConnection());
    }
 catch (    XMPPException xmppe) {
      xmppe.printStackTrace();
    }
  }
}
