{
  AbstractFileTransfer outgoingTransfer=null;
  try {
    assertConnected();
    Roster roster=jabberProvider.getConnection().getRoster();
    Presence presence=roster.getPresence(toContact.getAddress());
    OutgoingFileTransfer transfer=manager.createOutgoingFileTransfer(presence.getFrom());
    outgoingTransfer=new OutgoingFileTransferJabberImpl(toContact,file,transfer);
    FileTransferCreatedEvent event=new FileTransferCreatedEvent(outgoingTransfer,new Date());
    fireFileTransferCreated(event);
    transfer.sendFile(file,"Sending file.");
    new FileTransferProgressThread(transfer,outgoingTransfer).start();
  }
 catch (  XMPPException e) {
    logger.error("Failed to send file.",e);
  }
  return outgoingTransfer;
}
