{
  OutgoingFileTransferJabberImpl outgoingTransfer=null;
  try {
    assertConnected();
    if (file.length() > getMaximumFileLength())     throw new IllegalArgumentException("File length exceeds the allowed one for this protocol");
    String fullJid=jabberProvider.getFullJid(toContact);
    if (!jabberProvider.isFeatureListSupported(fullJid,new String[]{"http://jabber.org/protocol/si","http://jabber.org/protocol/si/profile/file-transfer"})) {
      new OperationNotSupportedException("Contact client or server does not support file transfers.");
    }
    OutgoingFileTransfer transfer=manager.createOutgoingFileTransfer(fullJid);
    outgoingTransfer=new OutgoingFileTransferJabberImpl(toContact,file,transfer,jabberProvider);
    FileTransferCreatedEvent event=new FileTransferCreatedEvent(outgoingTransfer,new Date());
    fireFileTransferCreated(event);
    transfer.sendFile(file,"Sending file");
    new FileTransferProgressThread(transfer,outgoingTransfer).start();
  }
 catch (  XMPPException e) {
    logger.error("Failed to send file.",e);
  }
  return outgoingTransfer;
}
