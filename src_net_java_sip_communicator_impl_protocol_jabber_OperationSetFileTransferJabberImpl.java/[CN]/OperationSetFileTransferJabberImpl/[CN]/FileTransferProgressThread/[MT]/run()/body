{
  int status;
  long progress;
  while (true) {
    try {
      Thread.sleep(10);
      status=parseJabberStatus(jabberTransfer.getStatus());
      progress=fileTransfer.getTransferedBytes();
      if (status == FileTransferStatusChangeEvent.FAILED || status == FileTransferStatusChangeEvent.COMPLETED || status == FileTransferStatusChangeEvent.CANCELED || status == FileTransferStatusChangeEvent.REFUSED) {
        break;
      }
      fileTransfer.fireStatusChangeEvent(status);
      fileTransfer.fireProgressChangeEvent(System.currentTimeMillis(),progress);
    }
 catch (    InterruptedException e) {
      logger.debug("Unable to sleep thread.",e);
    }
  }
  if (initialFileSize > 0 && status == FileTransferStatusChangeEvent.COMPLETED && fileTransfer.getTransferedBytes() < initialFileSize) {
    status=FileTransferStatusChangeEvent.CANCELED;
  }
  fileTransfer.fireStatusChangeEvent(status);
  fileTransfer.fireProgressChangeEvent(System.currentTimeMillis(),progress);
}
