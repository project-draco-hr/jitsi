{
  int status;
  double progress;
  while (true) {
    try {
      Thread.sleep(10);
      status=parseJabberStatus(jabberTransfer.getStatus());
      progress=fileTransfer.getTransferedBytes();
      if (status == FileTransfer.FAILED || status == FileTransfer.COMPLETED || status == FileTransfer.CANCELED || status == FileTransfer.REFUSED) {
        break;
      }
      fileTransfer.fireStatusChangeEvent(status);
      fileTransfer.fireProgressChangeEvent((int)progress);
    }
 catch (    InterruptedException e) {
      logger.debug("Unable to sleep thread.",e);
    }
  }
  if (initialFileSize > 0 && status == FileTransfer.COMPLETED && fileTransfer.getTransferedBytes() < initialFileSize) {
    status=FileTransfer.CANCELED;
  }
  fileTransfer.fireStatusChangeEvent(status);
  fileTransfer.fireProgressChangeEvent((int)progress);
}
