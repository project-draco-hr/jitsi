{
  logger.debug("The provider changed state from: " + evt.getOldState() + " to: "+ evt.getNewState());
  if (evt.getNewState() == RegistrationState.REGISTERED) {
    manager=new FileTransferManager(jabberProvider.getConnection());
    jabberFileTransferListener=new JabberFileTransferListener();
    manager.addFileTransferListener(jabberFileTransferListener);
  }
 else   if (evt.getNewState() == RegistrationState.UNREGISTERED) {
    if (jabberFileTransferListener != null && manager != null) {
      manager.removeFileTransferListener(jabberFileTransferListener);
      manager=null;
      jabberFileTransferListener=null;
    }
  }
}
