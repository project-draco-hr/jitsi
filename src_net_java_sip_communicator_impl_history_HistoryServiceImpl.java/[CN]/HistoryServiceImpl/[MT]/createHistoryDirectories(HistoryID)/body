{
  String[] idComponents=id.getID();
  String[] dirs=new String[idComponents.length + 1];
  String userSetDataDirectory=System.getProperty("HistoryServiceDirectory");
  if (userSetDataDirectory != null)   dirs[0]=userSetDataDirectory;
 else   dirs[0]=DATA_DIRECTORY;
  escapeCharacters(idComponents);
  System.arraycopy(idComponents,0,dirs,1,dirs.length - 1);
  File directory=null;
  try {
    directory=getFileAccessService().getPrivatePersistentDirectory(dirs);
  }
 catch (  Exception e) {
    IOException ioe=new IOException("Could not create history due to file system error");
    ioe.initCause(e);
    throw ioe;
  }
  if (!directory.exists() && !directory.mkdirs()) {
    throw new IOException("Could not create requested history service files:" + directory.getAbsolutePath());
  }
  return directory;
}
