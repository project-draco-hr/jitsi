{
  disposeBeforeInitCaptureDevices();
  CaptureDeviceInfo audioDeviceInfo=deviceConfiguration.getAudioCaptureDevice();
  DataSource audioDataSource=null;
  muteAudioDataSource=null;
  if (audioDeviceInfo != null) {
    audioDataSource=createDataSource(audioDeviceInfo.getLocator());
    if (audioDataSource instanceof PushBufferDataSource)     audioDataSource=muteAudioDataSource=new MutePushBufferDataSource((PushBufferDataSource)audioDataSource);
  }
  CaptureDeviceInfo videoDeviceInfo=localVideoAllowed ? deviceConfiguration.getVideoCaptureDevice() : null;
  DataSource videoDataSource=null;
  DataSource cloneableVideoDataSource=null;
  try {
    if (videoDeviceInfo != null) {
      videoDataSource=createDataSource(videoDeviceInfo.getLocator());
      selectVideoSize(videoDataSource);
      cloneableVideoDataSource=Manager.createCloneableDataSource(videoDataSource);
      if (cloneableVideoDataSource != null)       videoDataSource=cloneableVideoDataSource;
    }
  }
  finally {
    setVideoDataSource((SourceCloneable)cloneableVideoDataSource);
  }
  if (audioDataSource != null && videoDataSource != null) {
    try {
      avDataSource=Manager.createMergingDataSource(new DataSource[]{audioDataSource,videoDataSource});
    }
 catch (    IncompatibleSourceException exc) {
      logger.fatal("Failed to create a media data source!" + "Media transmission won't be enabled!",exc);
      throw new InternalError("Failed to create a media data source!" + "Media transmission won't be enabled!" + exc.getMessage());
    }
  }
 else   if (audioDataSource != null)   avDataSource=audioDataSource;
 else   if (videoDataSource != null)   avDataSource=videoDataSource;
 else   avDataSource=null;
  if (avDataSource != null)   initProcessor(avDataSource);
 else   sourceProcessor=null;
}
