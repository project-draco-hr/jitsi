{
  logger.trace(" --=== beginning state transition test ===--");
  PresenceStatus oldStatus=operationSetPresence1.getPresenceStatus();
  logger.debug("old status is=" + oldStatus.getStatusName() + " new status="+ newStatus.getStatusName()+ " for contact : "+ fixture.userID1);
  PresenceStatusEventCollector statusEventCollector1=new PresenceStatusEventCollector();
  ContactPresenceEventCollector statusEventCollector2=new ContactPresenceEventCollector(fixture.userID2,newStatus);
  operationSetPresence1.addProviderPresenceStatusListener(statusEventCollector1);
  operationSetPresence2.addContactPresenceStatusListener(statusEventCollector2);
  operationSetPresence1.publishPresenceStatus(newStatus,null);
  statusEventCollector1.waitForPresEvent(10000);
  statusEventCollector2.waitForEvent(10000);
  operationSetPresence1.removeProviderPresenceStatusListener(statusEventCollector1);
  operationSetPresence2.removeContactPresenceStatusListener(statusEventCollector2);
  assertEquals("Events dispatched during an event transition.",1,statusEventCollector1.collectedPresEvents.size());
  assertEquals("A status changed event contained wrong old status.",oldStatus,((ProviderPresenceStatusChangeEvent)statusEventCollector1.collectedPresEvents.get(0)).getOldStatus());
  assertEquals("A status changed event contained wrong new status.",newStatus,((ProviderPresenceStatusChangeEvent)statusEventCollector1.collectedPresEvents.get(0)).getNewStatus());
  assertEquals("opSet.getPresenceStatus() did not return properly.",newStatus,operationSetPresence1.getPresenceStatus());
  YahooStatusEnum actualStatus=(YahooStatusEnum)operationSetPresence2.queryContactStatus(fixture.userID1);
  assertEquals("The underlying implementation did not switch to the " + "requested presence status.",newStatus,actualStatus);
  logger.trace(" --=== finished test ===--");
}
