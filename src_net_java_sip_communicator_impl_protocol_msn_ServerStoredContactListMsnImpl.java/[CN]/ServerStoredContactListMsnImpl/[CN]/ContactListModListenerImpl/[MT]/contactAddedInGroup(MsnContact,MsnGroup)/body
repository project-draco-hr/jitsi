{
  String contactID=contact.getEmail().getEmailAddress();
  ContactMsnImpl contactToAdd=findContactById(contactID);
  ContactGroupMsnImpl dstGroup=findContactGroupByMsnId(group.getGroupId());
  Integer isWaitingForAddInGroup=(Integer)waitAddInGroup.get(contactID);
  Integer isWaitingForMove=(Integer)waitMove.get(contactID);
  Integer isWaitingForMoveFromRoot=(Integer)waitMoveFromRoot.get(contactID);
  if (dstGroup == null) {
    logger.trace("Group not found!" + group);
    return;
  }
  if (isWaitingForMoveFromRoot != null && isWaitingForMoveFromRoot.intValue() == 0) {
    logger.trace("Moving from root to a group: firing event");
    waitMoveFromRoot.remove(contactID);
    rootGroup.removeContact(contactToAdd);
    dstGroup.addContact(contactToAdd);
    fireContactMoved(rootGroup,dstGroup,contactToAdd);
    return;
  }
  if (isWaitingForMove != null && isWaitingForMove.intValue() == 0) {
    dstGroup.addContact(contactToAdd);
    waitMove.put(contactID,dstGroup);
    return;
  }
  if (contactToAdd == null || isWaitingForAddInGroup != null) {
    if (isWaitingForAddInGroup.intValue() == 1) {
      if (contactToAdd == null) {
        contactToAdd=new ContactMsnImpl(contact,ServerStoredContactListMsnImpl.this,true,true);
        waitAddInGroup.remove(contactID);
        dstGroup.addContact(contactToAdd);
        fireContactAdded(dstGroup,contactToAdd);
      }
 else {
        if (!contactToAdd.isPersistent()) {
          waitAddInGroup.remove(contactID);
          contactToAdd.setResolved(contact);
          dstGroup.addContact(contactToAdd);
          fireContactMoved(contactToAdd.getParentContactGroup(),dstGroup,contactToAdd);
        }
 else {
          waitAddInGroup.remove(contactID);
          dstGroup.addContact(contactToAdd);
          fireContactAdded(dstGroup,contactToAdd);
        }
      }
    }
 else {
      logger.trace("Contact not found!" + contact);
      return;
    }
  }
 else {
    dstGroup.addContact(contactToAdd);
    fireContactAdded(dstGroup,contactToAdd);
  }
}
