{
  ConfigurationService config=NeomediaActivator.getConfigurationService();
  if (logger.isInfoEnabled())   logger.info("Scanning for configured Audio Devices.");
  CaptureDeviceInfo[] audioCaptureDevices=getAvailableAudioCaptureDevices();
  if (config.getBoolean(PROP_AUDIO_DEVICE_IS_DISABLED,false)) {
    audioCaptureDevice=null;
    audioSystem=AUDIO_NONE;
  }
 else   if (audioCaptureDevices.length < 1) {
    logger.warn("No Audio Device was found.");
    audioCaptureDevice=null;
    audioSystem=AUDIO_NONE;
  }
 else {
    if (logger.isDebugEnabled())     logger.debug("Found " + audioCaptureDevices.length + " capture devices: "+ audioCaptureDevices);
    String audioDevName=config.getString(PROP_AUDIO_DEVICE);
    if (audioDevName == null || audioDevName.equals(AUDIO_NONE)) {
      if (PortAudioAuto.isSupported()) {
        setAudioSystem(AUDIO_SYSTEM_PORTAUDIO,null,false);
        if (audioDevName != null && audioDevName.equals(AUDIO_NONE))         setAudioCaptureDevice(null,false);
      }
 else {
        setAudioPlaybackDevice(null,false);
        setAudioNotifyDevice(null,false);
        setAudioCaptureDevice(null,false);
        setAudioSystem(AUDIO_SYSTEM_JAVASOUND,null,false);
      }
    }
 else {
      for (      CaptureDeviceInfo captureDeviceInfo : audioCaptureDevices) {
        if (audioDevName.equals(captureDeviceInfo.getName())) {
          setAudioSystem(getAudioSystem(captureDeviceInfo),captureDeviceInfo,false);
          break;
        }
      }
      if (getAudioSystem() == null || !PortAudioAuto.isSupported()) {
        logger.warn("Computer sound config changed or " + "there is a problem since last config was saved, " + "will back to default");
        setAudioPlaybackDevice(null,false);
        setAudioNotifyDevice(null,false);
        setAudioCaptureDevice(null,false);
        setAudioSystem(AUDIO_SYSTEM_PORTAUDIO,null,false);
      }
    }
    if (audioCaptureDevice != null)     if (logger.isInfoEnabled())     logger.info("Found " + audioCaptureDevice.getName() + " as an audio capture device.");
  }
  if (config.getBoolean(PROP_VIDEO_DEVICE_IS_DISABLED,false))   videoCaptureDevice=null;
 else {
    if (logger.isInfoEnabled())     logger.info("Scanning for configured Video Devices.");
    Format[] formats=new Format[]{new AVFrameFormat(),new VideoFormat(VideoFormat.RGB),new VideoFormat(VideoFormat.YUV),new VideoFormat(Constants.H264)};
    for (    Format format : formats) {
      videoCaptureDevice=extractConfiguredVideoCaptureDevice(format);
      if (videoCaptureDevice != null)       break;
    }
    if (videoCaptureDevice == null)     if (logger.isInfoEnabled())     logger.info("No Video Device was found.");
  }
}
