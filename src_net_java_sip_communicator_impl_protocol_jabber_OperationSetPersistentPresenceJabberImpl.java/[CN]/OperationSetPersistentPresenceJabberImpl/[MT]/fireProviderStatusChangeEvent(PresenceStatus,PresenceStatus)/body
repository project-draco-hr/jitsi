{
  if (!oldStatus.equals(newStatus)) {
    currentStatus=newStatus;
    super.fireProviderStatusChangeEvent(oldStatus,newStatus);
    PresenceStatus offlineStatus=parentProvider.getJabberStatusEnum().getStatus(JabberStatusEnum.OFFLINE);
    if (newStatus.equals(offlineStatus)) {
      Iterator<ContactGroup> groupsIter=getServerStoredContactListRoot().subgroups();
      while (groupsIter.hasNext()) {
        ContactGroup group=groupsIter.next();
        Iterator<Contact> contactsIter=group.contacts();
        while (contactsIter.hasNext()) {
          ContactJabberImpl contact=(ContactJabberImpl)contactsIter.next();
          PresenceStatus oldContactStatus=contact.getPresenceStatus();
          if (!oldContactStatus.isOnline())           continue;
          contact.updatePresenceStatus(offlineStatus);
          fireContactPresenceStatusChangeEvent(contact,contact.getParentContactGroup(),oldContactStatus,offlineStatus);
        }
      }
      Iterator<Contact> contactsIter=getServerStoredContactListRoot().contacts();
      while (contactsIter.hasNext()) {
        ContactJabberImpl contact=(ContactJabberImpl)contactsIter.next();
        PresenceStatus oldContactStatus=contact.getPresenceStatus();
        if (!oldContactStatus.isOnline())         continue;
        contact.updatePresenceStatus(offlineStatus);
        fireContactPresenceStatusChangeEvent(contact,contact.getParentContactGroup(),oldContactStatus,offlineStatus);
      }
    }
  }
}
