{
  byte pt=(byte)payloadType.getID();
  boolean unknown=false;
  List<ParameterPacketExtension> params=payloadType.getParameters();
  Map<String,String> paramsMap=new HashMap<String,String>();
  Map<String,String> advancedMap=new HashMap<String,String>();
  for (  ParameterPacketExtension param : params) {
    if (param.getName().equals("imageattr"))     advancedMap.put(param.getName(),param.getValue());
 else     paramsMap.put(param.getName(),param.getValue());
  }
  for (  String attr : payloadType.getAttributeNames()) {
    if (attr.equals("width") || attr.equals("height"))     paramsMap.put(attr,payloadType.getAttributeAsString(attr));
  }
  MediaFormatFactory formatFactory=mediaService.getFormatFactory();
  MediaFormat format=formatFactory.createMediaFormat(pt,payloadType.getName(),(double)payloadType.getClockrate(),payloadType.getChannels(),-1,paramsMap,advancedMap);
  if (format == null) {
    unknown=true;
    format=formatFactory.createUnknownMediaFormat(MediaType.AUDIO);
  }
  if ((ptRegistry != null) && (pt >= MediaFormat.MIN_DYNAMIC_PAYLOAD_TYPE) && (pt <= MediaFormat.MAX_DYNAMIC_PAYLOAD_TYPE)&& (ptRegistry.findFormat(pt) == null)) {
    ptRegistry.addMapping(format,pt);
  }
  return unknown ? null : format;
}
