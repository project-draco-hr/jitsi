{
  if (format instanceof RGBFormat) {
    RGBFormat rgbFormat=(RGBFormat)format;
    Class<?> dataType=format.getDataType();
    int bitsPerPixel=rgbFormat.getBitsPerPixel();
    int pixelStride=rgbFormat.getPixelStride();
    if ((pixelStride == Format.NOT_SPECIFIED) && (dataType != null) && (bitsPerPixel != Format.NOT_SPECIFIED))     pixelStride=dataType.equals(Format.byteArray) ? (bitsPerPixel / 8) : 1;
    format=new RGBFormat(size,Format.NOT_SPECIFIED,dataType,format.getFrameRate(),bitsPerPixel,rgbFormat.getRedMask(),rgbFormat.getGreenMask(),rgbFormat.getBlueMask(),pixelStride,((pixelStride == Format.NOT_SPECIFIED) || (size == null)) ? Format.NOT_SPECIFIED : (pixelStride * size.width),rgbFormat.getFlipped(),rgbFormat.getEndian());
  }
 else   if (format instanceof YUVFormat) {
    YUVFormat yuvFormat=(YUVFormat)format;
    format=new YUVFormat(size,Format.NOT_SPECIFIED,format.getDataType(),format.getFrameRate(),yuvFormat.getYuvType(),Format.NOT_SPECIFIED,Format.NOT_SPECIFIED,0,Format.NOT_SPECIFIED,Format.NOT_SPECIFIED);
  }
 else   if (format != null) {
    logger.warn("SwScaler outputFormat of type " + format.getClass().getName() + " is not supported for optimized scaling.");
  }
  return format;
}
