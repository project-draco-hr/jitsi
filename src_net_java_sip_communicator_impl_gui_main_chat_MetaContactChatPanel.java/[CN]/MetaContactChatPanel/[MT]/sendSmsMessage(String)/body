{
  OperationSetSmsMessaging smsOpSet=null;
  Iterator protocolProviders=chatWindow.getMainFrame().getProtocolProviders();
  while (protocolProviders.hasNext()) {
    ProtocolProviderService protocolProvider=(ProtocolProviderService)protocolProviders.next();
    smsOpSet=(OperationSetSmsMessaging)protocolProvider.getOperationSet(OperationSetSmsMessaging.class);
    if (smsOpSet != null)     break;
  }
  if (smsOpSet == null) {
    logger.error("Failed to send SMS.");
    this.refreshWriteArea();
    this.processMessage(metaContact.getDisplayName(),new Date(System.currentTimeMillis()),Constants.OUTGOING_MESSAGE,text,"plain/text");
    this.processMessage(metaContact.getDisplayName(),new Date(System.currentTimeMillis()),Constants.ERROR_MESSAGE,Messages.getI18NString("sendSmsNotSupported").getText(),"plain/text");
    return;
  }
  smsOpSet.addMessageListener(new SmsMessageListener(smsOpSet));
  Message message=smsOpSet.createMessage(text);
  SendSmsDialog smsDialog=new SendSmsDialog(this,message,smsOpSet);
  smsDialog.setPreferredSize(new Dimension(400,200));
  smsDialog.setVisible(true);
}
