{
  super(chatWindow);
  this.metaContact=metaContact;
  getChatContactListPanel().addContact(metaContact,protocolContact);
  new Thread(){
    public void run(){
      loadHistoryPeriod();
    }
  }
.start();
  Iterator protocolContacts=metaContact.getContacts();
  while (protocolContacts.hasNext()) {
    Contact subContact=(Contact)protocolContacts.next();
    chatWindow.getMainFrame().getProtocolPresenceOpSet(subContact.getProtocolProvider()).addContactPresenceStatusListener(this);
  }
  chatWindow.getMainFrame().getContactList().addMetaContactListListener(this);
  contactSelectorBox=new ProtocolContactSelectorBox(this,metaContact,protocolContact);
  getChatSendPanel().getSendPanel().add(contactSelectorBox,BorderLayout.CENTER);
  getChatSendPanel().getSendPanel().add(sendViaLabel,BorderLayout.WEST);
  ActionMap amap=this.getActionMap();
  amap.put("ChangeProtocol",new ChangeProtocolAction());
  InputMap imap=this.getInputMap(JComponent.WHEN_IN_FOCUSED_WINDOW);
  imap.put(KeyStroke.getKeyStroke(KeyEvent.VK_P,KeyEvent.CTRL_DOWN_MASK),"ChangeProtocol");
}
