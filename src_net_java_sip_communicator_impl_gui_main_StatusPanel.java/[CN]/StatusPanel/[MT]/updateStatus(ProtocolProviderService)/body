{
  StatusSelectorBox selectorBox=(StatusSelectorBox)protocolStatusCombos.get(protocolProvider);
  if (selectorBox != null) {
    if (!protocolProvider.isRegistered())     selectorBox.updateStatus(selectorBox.getOfflineStatus());
 else {
      if (selectorBox.getLastSelectedStatus() != null) {
        selectorBox.updateStatus(selectorBox.getLastSelectedStatus());
      }
 else {
        PresenceStatus lastStatus=getProtocolProviderLastStatus(protocolProvider);
        if (lastStatus == null) {
          selectorBox.updateStatus(selectorBox.getOnlineStatus());
        }
 else {
          selectorBox.updateStatus(lastStatus);
        }
      }
    }
    selectorBox.repaint();
  }
}
