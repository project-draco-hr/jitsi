{
  if (stream == 0)   return;
  try {
    byte[] bytebuff=null;
    int readAvailableFrames;
    if (USE_FRAMES_PER_BUFFER_WORKAROUND) {
      Format bufferFormat=buffer.getFormat();
      if ((bufferFormat != null) && Format.byteArray.equals(bufferFormat.getDataType()))       bytebuff=(byte[])buffer.getData();
    }
    int bytebuffLength;
    if (bytebuff == null) {
      readAvailableFrames=(int)PortAudio.Pa_GetStreamReadAvailable(stream);
      if (readAvailableFrames < 1)       readAvailableFrames=512;
      bytebuff=new byte[readAvailableFrames * frameSize];
      bytebuffLength=bytebuff.length;
    }
 else {
      readAvailableFrames=bytebuff.length / frameSize;
      bytebuffLength=readAvailableFrames * frameSize;
    }
    PortAudio.Pa_ReadStream(stream,bytebuff,readAvailableFrames);
    buffer.setTimeStamp(System.nanoTime());
    buffer.setData(bytebuff);
    buffer.setSequenceNumber(seqNo);
    buffer.setLength(bytebuffLength);
    buffer.setFlags(0);
    buffer.setHeader(null);
    seqNo++;
  }
 catch (  PortAudioException pae) {
    IOException ioe=new IOException();
    ioe.initCause(pae);
    throw ioe;
  }
}
