{
  Iterator<EventFilter> filters=null;
synchronized (eventFilters) {
    filters=new ArrayList<EventFilter>(eventFilters).iterator();
  }
  boolean filtered=false;
  while (filters.hasNext()) {
    try {
      if (filters.next().filterEvent(evt)) {
        filtered=true;
      }
    }
 catch (    Exception exc) {
      logger.error("An exception occurred while filtering an event.",exc);
    }
  }
  if (filtered) {
    logger.trace("Message event filtered.");
    return;
  }
  Iterator listeners=null;
synchronized (messageListeners) {
    listeners=new ArrayList(messageListeners).iterator();
  }
  logger.debug("Dispatching  msg evt. Listeners=" + messageListeners.size() + " evt="+ evt);
  while (listeners.hasNext()) {
    MessageListener listener=(MessageListener)listeners.next();
    if (evt instanceof MessageDeliveredEvent) {
      listener.messageDelivered((MessageDeliveredEvent)evt);
    }
 else     if (evt instanceof MessageReceivedEvent) {
      listener.messageReceived((MessageReceivedEvent)evt);
    }
 else     if (evt instanceof MessageDeliveryFailedEvent) {
      listener.messageDeliveryFailed((MessageDeliveryFailedEvent)evt);
    }
  }
}
