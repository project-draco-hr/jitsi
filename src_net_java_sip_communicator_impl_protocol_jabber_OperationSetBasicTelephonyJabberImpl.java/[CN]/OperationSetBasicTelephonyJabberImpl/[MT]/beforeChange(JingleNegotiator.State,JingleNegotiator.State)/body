{
  if (newState instanceof IncomingJingleSession.Active) {
    JingleSession session=(JingleSession)newState.getNegotiator();
    CallPeerJabberImpl callPeer=activeCallsRepository.findCallPeer(session);
    if (callPeer == null) {
      return;
    }
    callPeer.setState(CallPeerState.CONNECTED);
  }
 else   if (newState instanceof OutgoingJingleSession.Inviting) {
    JingleSession session=(JingleSession)newState.getNegotiator();
    CallPeerJabberImpl callPeer=activeCallsRepository.findCallPeer(session);
    if (callPeer == null) {
      return;
    }
    callPeer.setState(CallPeerState.CONNECTING);
  }
 else   if (newState instanceof OutgoingJingleSession.Pending) {
    JingleSession session=(JingleSession)newState.getNegotiator();
    CallPeerJabberImpl callPeer=activeCallsRepository.findCallPeer(session);
    if (callPeer == null) {
      return;
    }
    callPeer.setState(CallPeerState.ALERTING_REMOTE_SIDE);
  }
 else   if (newState instanceof OutgoingJingleSession.Active) {
    JingleSession session=(JingleSession)newState.getNegotiator();
    CallPeerJabberImpl callPeer=activeCallsRepository.findCallPeer(session);
    if (callPeer == null) {
      return;
    }
    callPeer.setState(CallPeerState.CONNECTED);
  }
  if ((newState == null) && (oldState != null)) {
    JingleSession session=(JingleSession)oldState.getNegotiator();
    CallPeerJabberImpl callPeer=activeCallsRepository.findCallPeer(session);
    if (callPeer == null) {
      logger.debug("Received a stray trying response.");
      return;
    }
    try {
      hangupCallPeer(callPeer);
    }
 catch (    Exception ex) {
      ex.printStackTrace();
    }
  }
}
