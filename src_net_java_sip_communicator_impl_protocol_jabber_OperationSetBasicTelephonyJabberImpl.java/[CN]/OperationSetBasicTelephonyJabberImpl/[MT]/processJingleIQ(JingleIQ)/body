{
  CallPeerJabberImpl callPeer=activeCallsRepository.findCallPeer(jingleIQ.getSID());
  IQ.Type type=jingleIQ.getType();
  if (type == Type.ERROR) {
    logger.error("Received error");
    XMPPError error=jingleIQ.getError();
    String message="Remote party returned an error!";
    if (error != null) {
      logger.error(" code=" + error.getCode() + " message="+ error.getMessage());
      if (error.getMessage() != null)       message=error.getMessage();
    }
    if (callPeer != null)     callPeer.setState(CallPeerState.FAILED,message);
    return;
  }
  JingleAction action=jingleIQ.getAction();
  if (action == JingleAction.SESSION_INITIATE) {
    CallJabberImpl call=null;
    TransferPacketExtension transfer=(TransferPacketExtension)jingleIQ.getExtension(TransferPacketExtension.ELEMENT_NAME,TransferPacketExtension.NAMESPACE);
    if (transfer != null) {
      String sid=transfer.getSID();
      if (sid != null) {
        CallJabberImpl attendantCall=getActiveCallsRepository().findJingleSID(sid);
        if (attendantCall != null) {
          CallPeerJabberImpl attendant=attendantCall.getPeer(sid);
          if ((attendant != null) && getFullCalleeURI(attendant.getAddress()).equals(transfer.getFrom()) && protocolProvider.getOurJID().equals(transfer.getTo())) {
            call=attendantCall;
          }
        }
      }
    }
    if (call == null) {
      call=new CallJabberImpl(this);
    }
    final CallJabberImpl callThread=call;
    new Thread(){
      @Override public void run(){
        callThread.processSessionInitiate(jingleIQ);
        OperationSetAutoAnswerJabberImpl autoAnswerOpSet=(OperationSetAutoAnswerJabberImpl)protocolProvider.getOperationSet(OperationSetBasicAutoAnswer.class);
        if (autoAnswerOpSet != null && autoAnswerOpSet.isAutoAnswerUnconditionalSet()) {
          autoAnswerOpSet.followCallCheck(callThread);
        }
      }
    }
.start();
    return;
  }
 else   if (callPeer == null) {
    if (logger.isDebugEnabled())     logger.debug("Received a stray trying response.");
    return;
  }
 else   if (action == JingleAction.SESSION_TERMINATE) {
    callPeer.processSessionTerminate(jingleIQ);
  }
 else   if (action == JingleAction.SESSION_ACCEPT) {
    callPeer.processSessionAccept(jingleIQ);
  }
 else   if (action == JingleAction.SESSION_INFO) {
    SessionInfoPacketExtension info=jingleIQ.getSessionInfo();
    if (info != null) {
      callPeer.processSessionInfo(info);
    }
 else {
      PacketExtension packetExtension=jingleIQ.getExtension(TransferPacketExtension.ELEMENT_NAME,TransferPacketExtension.NAMESPACE);
      if (packetExtension instanceof TransferPacketExtension) {
        TransferPacketExtension transfer=(TransferPacketExtension)packetExtension;
        if (transfer.getFrom() == null)         transfer.setFrom(jingleIQ.getFrom());
        try {
          callPeer.processTransfer(transfer);
        }
 catch (        OperationFailedException ofe) {
          logger.error("Failed to transfer to " + transfer.getTo(),ofe);
        }
      }
      packetExtension=jingleIQ.getExtension(CoinPacketExtension.ELEMENT_NAME,CoinPacketExtension.NAMESPACE);
      if (packetExtension instanceof CoinPacketExtension) {
        CoinPacketExtension coinExt=(CoinPacketExtension)packetExtension;
        callPeer.setConferenceFocus(Boolean.parseBoolean(coinExt.getAttributeAsString(CoinPacketExtension.ISFOCUS_ATTR_NAME)));
      }
    }
  }
 else   if (action == JingleAction.CONTENT_ACCEPT) {
    callPeer.processContentAccept(jingleIQ);
  }
 else   if (action == JingleAction.CONTENT_ADD) {
    callPeer.processContentAdd(jingleIQ);
  }
 else   if (action == JingleAction.CONTENT_MODIFY) {
    callPeer.processContentModify(jingleIQ);
  }
 else   if (action == JingleAction.CONTENT_REJECT) {
    callPeer.processContentReject(jingleIQ);
  }
 else   if (action == JingleAction.CONTENT_REMOVE) {
    callPeer.processContentRemove(jingleIQ);
  }
 else   if (action == JingleAction.TRANSPORT_INFO) {
    callPeer.processTransportInfo(jingleIQ);
  }
}
