{
  if (!isConnected()) {
    throw new IllegalStateException("Not connected to IRC server.");
  }
  final IRCApi irc=this.session.get();
  final String msg=message.toLowerCase();
  if (msg.startsWith("/msg ")) {
    final String part=message.substring(5);
    int endOfNick=part.indexOf(' ');
    if (endOfNick == -1) {
      throw new IllegalArgumentException("Invalid private message " + "format. Message was not sent.");
    }
    final String target=part.substring(0,endOfNick);
    final String command=part.substring(endOfNick + 1);
    irc.message(target,command);
  }
 else   if (msg.startsWith("/me ")) {
    final String command=message.substring(4);
    irc.act(source,command);
  }
 else   if (msg.startsWith("/join ")) {
    final String part=message.substring(6);
    final String channel;
    final String password;
    int indexOfSep=part.indexOf(' ');
    if (indexOfSep == -1) {
      channel=part;
      password="";
    }
 else {
      channel=part.substring(0,indexOfSep);
      password=part.substring(indexOfSep + 1);
    }
    if (channel.matches("[^,\\n\\r\\s\\a]+")) {
      irc.joinChannel(channel,password);
    }
  }
 else {
    irc.message(source,message);
  }
}
