{
  final IRCServer server;
  if (secureConnection) {
    server=new SecureIRCServer(host,port,password,getCustomSSLContext(host));
  }
 else {
    server=new IRCServer(host,port,password,false);
  }
synchronized (this.session) {
    final IrcConnection current=this.session.get();
    if (current != null && current.isConnected()) {
      return;
    }
    this.params.setServer(server);
    try {
      final IRCApi irc=new IRCApiImpl(true);
      if (LOGGER.isTraceEnabled()) {
        irc.addListener(new DebugListener());
      }
      final IrcConnection connection=new IrcConnection(this.provider,this.params,irc);
      this.session.set(connection);
      this.provider.setCurrentRegistrationState(RegistrationState.REGISTERED);
    }
 catch (    IOException e) {
      this.provider.setCurrentRegistrationState(RegistrationState.CONNECTION_FAILED);
      throw e;
    }
catch (    InterruptedException e) {
      this.provider.setCurrentRegistrationState(RegistrationState.UNREGISTERED);
      throw e;
    }
  }
}
