{
  final String user=msg.getSource().getNick();
  final String text=Utils.formatMessage(Utils.parse(msg.getText()));
  MessageIrcImpl message=new MessageIrcImpl(text,OperationSetBasicInstantMessaging.HTML_MIME_TYPE,OperationSetBasicInstantMessaging.DEFAULT_MIME_ENCODING,null);
  final Contact from=IrcStack.this.provider.getPersistentPresence().findOrCreateContactByID(user);
  try {
    IrcStack.this.provider.getBasicInstantMessaging().fireMessageReceived(message,from);
  }
 catch (  RuntimeException e) {
    LOGGER.error("Error occurred while delivering private message from user" + " '" + user + "': "+ text,e);
  }
}
