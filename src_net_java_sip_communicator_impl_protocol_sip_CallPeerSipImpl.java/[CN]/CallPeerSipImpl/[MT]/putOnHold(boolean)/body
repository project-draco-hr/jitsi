{
  CallPeerMediaHandler mediaHandler=getMediaHandler();
  mediaHandler.setOnHold(onHold);
  try {
    sendReInvite(mediaHandler.createOffer());
  }
 catch (  Exception ex) {
    ProtocolProviderServiceSipImpl.throwOperationFailedException("Failed to create SDP offer to hold.",OperationFailedException.INTERNAL_ERROR,ex,logger);
  }
  CallPeerState state=getState();
  if (CallPeerState.ON_HOLD_LOCALLY.equals(state)) {
    if (!onHold)     setState(CallPeerState.CONNECTED);
  }
 else   if (CallPeerState.ON_HOLD_MUTUALLY.equals(state)) {
    if (!onHold)     setState(CallPeerState.ON_HOLD_REMOTELY);
  }
 else   if (CallPeerState.ON_HOLD_REMOTELY.equals(state)) {
    if (onHold)     setState(CallPeerState.ON_HOLD_MUTUALLY);
  }
 else   if (onHold) {
    setState(CallPeerState.ON_HOLD_LOCALLY);
  }
}
