{
  MediaDeviceSession deviceSession=getDeviceSession();
  MediaFormatImpl<? extends Format> deviceSessionFormat=null;
  if (deviceSession != null) {
    deviceSessionFormat=deviceSession.getFormat();
    if ((deviceSessionFormat != null) && deviceSessionFormat.equals(format) && deviceSessionFormat.advancedAttributesAreEqual(deviceSessionFormat.getAdvancedAttributes(),format.getAdvancedAttributes()))     return;
  }
  if (logger.isTraceEnabled())   logger.trace("Changing format of stream " + hashCode() + " from: "+ deviceSessionFormat+ " to: "+ format);
  setAdvancedAttributes(format.getAdvancedAttributes());
  handleAttributes(format,format.getAdvancedAttributes());
  handleAttributes(format,format.getFormatParameters());
  deviceSession.setFormat(format);
}
