{
  if (getDeviceSession() != null && getDeviceSession().getFormat() != null && getDeviceSession().getFormat().equals(format))   return;
  if (logger.isTraceEnabled())   logger.trace("Changing format of stream " + hashCode() + " from: "+ getDeviceSession().getFormat()+ " to: "+ format);
  setAdvancedAttributes(format.getAdvancedAttributes());
  handleAttributes(format,format.getAdvancedAttributes());
  handleAttributes(format,format.getFormatParameters());
  getDeviceSession().setFormat(format);
}
