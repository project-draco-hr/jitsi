{
  if (device == null)   throw new NullPointerException("device");
  AbstractMediaDevice abstractMediaDevice=(AbstractMediaDevice)device;
  if ((deviceSession == null) || (deviceSession.getDevice() != device)) {
    MediaDeviceSession oldValue=deviceSession;
    MediaFormat format;
    MediaDirection startedDirection;
    if (deviceSession != null) {
      format=getFormat();
      startedDirection=deviceSession.getStartedDirection();
      deviceSession.removePropertyChangeListener(deviceSessionPropertyChangeListener);
      deviceSession.setDisposePlayerOnClose(!(deviceSession instanceof VideoMediaDeviceSession));
      deviceSession.close();
      deviceSession=null;
    }
 else {
      format=null;
      startedDirection=MediaDirection.INACTIVE;
    }
    deviceSession=abstractMediaDevice.createSession();
    if (oldValue != null)     deviceSession.copyPlayback(oldValue);
    deviceSession.addPropertyChangeListener(deviceSessionPropertyChangeListener);
    direction=null;
    if (deviceSession != null) {
      if (format != null)       deviceSession.setFormat(format);
      deviceSession.setMute(mute);
    }
    deviceSessionChanged(oldValue,deviceSession);
    if (deviceSession != null) {
      deviceSession.start(startedDirection);
synchronized (receiveStreams) {
        for (        ReceiveStream receiveStream : receiveStreams)         deviceSession.addReceiveStream(receiveStream);
      }
    }
  }
}
