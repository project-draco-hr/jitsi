{
synchronized (JmDNS.this) {
    if (state == DNSState.CANCELED) {
      return;
    }
    if (logger.isTraceEnabled())     logger.trace("run() JmDNS reaping cache");
    List<DNSEntry> list=new ArrayList<DNSEntry>();
synchronized (cache) {
      for (Iterator<DNSCache.CacheNode> i=cache.iterator(); i.hasNext(); ) {
        for (DNSCache.CacheNode n=i.next(); n != null; n=n.next()) {
          list.add(n.getValue());
        }
      }
    }
    long now=System.currentTimeMillis();
    for (Iterator<DNSEntry> i=list.iterator(); i.hasNext(); ) {
      DNSRecord c=(DNSRecord)i.next();
      if (c.isExpired(now)) {
        updateRecord(now,c);
        cache.remove(c);
      }
    }
  }
}
