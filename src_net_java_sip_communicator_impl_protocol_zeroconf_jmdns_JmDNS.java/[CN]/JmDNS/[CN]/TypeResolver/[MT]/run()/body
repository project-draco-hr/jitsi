{
  try {
    if (state == DNSState.ANNOUNCED) {
      if (count++ < 3) {
        logger.debug("run() JmDNS querying type");
        DNSOutgoing out=new DNSOutgoing(DNSConstants.FLAGS_QR_QUERY);
        out.addQuestion(new DNSQuestion("_services._mdns._udp.local.",DNSConstants.TYPE_PTR,DNSConstants.CLASS_IN));
        for (        String serviceType : serviceTypes.values()) {
          out.addAnswer(new DNSRecord.Pointer("_services._mdns._udp.local.",DNSConstants.TYPE_PTR,DNSConstants.CLASS_IN,DNSConstants.DNS_TTL,serviceType),0);
        }
        send(out);
      }
 else {
        this.cancel();
      }
    }
 else {
      if (state == DNSState.CANCELED) {
        this.cancel();
      }
    }
  }
 catch (  Throwable e) {
    logger.warn("run() exception ",e);
    recover();
  }
}
