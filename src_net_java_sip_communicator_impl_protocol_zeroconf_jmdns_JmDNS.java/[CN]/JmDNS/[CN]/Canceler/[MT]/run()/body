{
  try {
    if (++count < 3) {
      if (logger.isDebugEnabled())       logger.debug("run() JmDNS canceling service");
      DNSOutgoing out=new DNSOutgoing(DNSConstants.FLAGS_QR_RESPONSE | DNSConstants.FLAGS_AA);
      for (int i=0; i < infos.length; i++) {
        ServiceInfo info=infos[i];
        out.addAnswer(new DNSRecord.Pointer(info.type,DNSConstants.TYPE_PTR,DNSConstants.CLASS_IN,ttl,info.getQualifiedName()),0);
        out.addAnswer(new DNSRecord.Service(info.getQualifiedName(),DNSConstants.TYPE_SRV,DNSConstants.CLASS_IN,ttl,info.priority,info.weight,info.port,localHost.getName()),0);
        out.addAnswer(new DNSRecord.Text(info.getQualifiedName(),DNSConstants.TYPE_TXT,DNSConstants.CLASS_IN,ttl,info.text),0);
        DNSRecord answer=localHost.getDNS4AddressRecord();
        if (answer != null) {
          out.addAnswer(answer,0);
        }
        answer=localHost.getDNS6AddressRecord();
        if (answer != null) {
          out.addAnswer(answer,0);
        }
      }
      send(out);
    }
 else {
synchronized (lock) {
        closed=true;
        lock.notifyAll();
      }
      this.cancel();
    }
  }
 catch (  Throwable e) {
    logger.warn("run() exception ",e);
    recover();
  }
}
