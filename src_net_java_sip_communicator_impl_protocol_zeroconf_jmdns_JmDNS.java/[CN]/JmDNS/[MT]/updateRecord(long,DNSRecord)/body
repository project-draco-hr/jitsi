{
  List<DNSListener> listenerList=null;
synchronized (this) {
    listenerList=new ArrayList<DNSListener>(listeners);
  }
  for (  DNSListener listener : listenerList)   listener.updateRecord(this,now,rec);
  if (rec.type == DNSConstants.TYPE_PTR || rec.type == DNSConstants.TYPE_SRV) {
    List<ServiceListener> serviceListenerList=null;
synchronized (this) {
      serviceListenerList=serviceListeners.get(rec.name.toLowerCase());
      if (serviceListenerList != null) {
        serviceListenerList=new ArrayList<ServiceListener>(serviceListenerList);
      }
    }
    if (serviceListenerList != null) {
      boolean expired=rec.isExpired(now);
      String type=rec.getName();
      String name=((DNSRecord.Pointer)rec).getAlias();
      if (!expired) {
        ServiceEvent event=new ServiceEvent(this,type,toUnqualifiedName(type,name),null);
        for (Iterator<ServiceListener> iterator=serviceListenerList.iterator(); iterator.hasNext(); ) {
          iterator.next().serviceAdded(event);
        }
      }
 else {
        ServiceEvent event=new ServiceEvent(this,type,toUnqualifiedName(type,name),null);
        for (Iterator<ServiceListener> iterator=serviceListenerList.iterator(); iterator.hasNext(); ) {
          iterator.next().serviceRemoved(event);
        }
      }
    }
  }
}
