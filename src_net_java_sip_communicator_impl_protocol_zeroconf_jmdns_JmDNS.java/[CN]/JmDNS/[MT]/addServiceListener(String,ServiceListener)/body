{
  String lotype=type.toLowerCase();
  removeServiceListener(lotype,listener);
  List<ServiceListener> list=null;
synchronized (this) {
    list=serviceListeners.get(lotype);
    if (list == null) {
      list=Collections.synchronizedList(new LinkedList());
      serviceListeners.put(lotype,list);
    }
    list.add(listener);
  }
  for (Iterator i=cache.iterator(); i.hasNext(); ) {
    for (DNSCache.CacheNode n=(DNSCache.CacheNode)i.next(); n != null; n=n.next()) {
      DNSRecord rec=(DNSRecord)n.getValue();
      if (rec.type == DNSConstants.TYPE_SRV) {
        if (rec.name.endsWith(type)) {
          listener.serviceAdded(new ServiceEvent(this,type,toUnqualifiedName(type,rec.name),null));
        }
      }
    }
  }
  new ServiceResolver(type).start();
}
