{
  ProtocolProviderService protocolProvider=evt.getProvider();
  this.updateStatus(protocolProvider);
  if (evt.getNewState().equals(RegistrationState.REGISTERED)) {
    final OperationSetServerStoredAccountInfo accountInfoOpSet=protocolProvider.getOperationSet(OperationSetServerStoredAccountInfo.class);
    if (accountInfoOpSet != null)     new Thread(){
      public void run(){
        if (currentImage == null) {
          byte[] accountImage=AccountInfoUtils.getImage(accountInfoOpSet);
          if ((accountImage != null) && (accountImage.length > 0)) {
            currentImage=accountImage;
            accountImageLabel.setImageIcon(currentImage);
          }
        }
        if (!StringUtils.isNullOrEmpty(globalDisplayName))         return;
        String accountName=null;
        if (currentFirstName == null) {
          String firstName=AccountInfoUtils.getFirstName(accountInfoOpSet);
          if (firstName != null && firstName.length() > 0) {
            currentFirstName=firstName;
            accountName=currentFirstName;
          }
        }
        if (currentLastName == null) {
          String lastName=AccountInfoUtils.getLastName(accountInfoOpSet);
          if (lastName != null && lastName.length() > 0) {
            currentLastName=lastName;
            if ((accountName == null) || (accountName.length() == 0))             accountName=currentLastName;
 else             accountName+=" " + currentLastName;
          }
        }
        if (currentFirstName == null && currentLastName == null) {
          String displayName=AccountInfoUtils.getDisplayName(accountInfoOpSet);
          if (displayName != null)           accountName=displayName;
        }
        if (accountName != null && accountName.length() > 0)         accountNameLabel.setText(accountName);
      }
    }
.start();
    OperationSetAvatar avatarOpSet=protocolProvider.getOperationSet(OperationSetAvatar.class);
    if (avatarOpSet != null)     avatarOpSet.addAvatarListener(this);
    OperationSetServerStoredAccountInfo serverStoredAccountInfo=protocolProvider.getOperationSet(OperationSetServerStoredAccountInfo.class);
    if (serverStoredAccountInfo != null)     serverStoredAccountInfo.addServerStoredDetailsChangeListener(this);
  }
 else   if (evt.getNewState().equals(RegistrationState.UNREGISTERING) || evt.getNewState().equals(RegistrationState.CONNECTION_FAILED)) {
    OperationSetAvatar avatarOpSet=protocolProvider.getOperationSet(OperationSetAvatar.class);
    if (avatarOpSet != null)     avatarOpSet.removeAvatarListener(this);
    OperationSetServerStoredAccountInfo serverStoredAccountInfo=protocolProvider.getOperationSet(OperationSetServerStoredAccountInfo.class);
    if (serverStoredAccountInfo != null)     serverStoredAccountInfo.removeServerStoredDetailsChangeListener(this);
  }
 else   if (evt.getNewState().equals(RegistrationState.REGISTERING)) {
    startConnecting(protocolProvider);
  }
}
