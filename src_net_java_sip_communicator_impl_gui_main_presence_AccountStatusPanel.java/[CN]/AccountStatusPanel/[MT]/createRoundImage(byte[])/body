{
  BufferedImage destImage=new BufferedImage(AVATAR_ICON_WIDTH,AVATAR_ICON_HEIGHT,BufferedImage.TYPE_INT_ARGB);
  BufferedImage avatarImage;
  try {
    InputStream in=new ByteArrayInputStream(avatarBytes);
    avatarImage=ImageIO.read(in);
    Graphics2D g=destImage.createGraphics();
    AntialiasingManager.activateAntialiasing(g);
    g.setColor(Color.WHITE);
    g.fillRoundRect(0,0,AVATAR_ICON_WIDTH,AVATAR_ICON_HEIGHT,10,10);
    g.setComposite(AlphaComposite.SrcIn);
    g.drawImage(avatarImage.getScaledInstance(AVATAR_ICON_WIDTH,AVATAR_ICON_HEIGHT,Image.SCALE_SMOOTH),0,0,null);
    return destImage;
  }
 catch (  Exception e) {
    logger.error("Could not create image.",e);
  }
  return null;
}
