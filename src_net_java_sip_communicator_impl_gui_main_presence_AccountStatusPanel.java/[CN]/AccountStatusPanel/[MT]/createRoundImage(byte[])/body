{
  BufferedImage destImage=null;
  try {
    InputStream in=new ByteArrayInputStream(avatarBytes);
    BufferedImage avatarImage=ImageIO.read(in);
    Image scaledImage=avatarImage.getScaledInstance(-1,AVATAR_ICON_HEIGHT,Image.SCALE_SMOOTH);
    destImage=new BufferedImage(scaledImage.getWidth(null),AVATAR_ICON_HEIGHT,BufferedImage.TYPE_INT_ARGB);
    Graphics2D g=destImage.createGraphics();
    AntialiasingManager.activateAntialiasing(g);
    g.setColor(Color.WHITE);
    g.fillRoundRect(0,0,scaledImage.getWidth(null),AVATAR_ICON_HEIGHT,10,10);
    g.setComposite(AlphaComposite.SrcIn);
    g.drawImage(scaledImage,0,0,null);
  }
 catch (  Exception e) {
    logger.error("Could not create image.",e);
  }
  return destImage;
}
