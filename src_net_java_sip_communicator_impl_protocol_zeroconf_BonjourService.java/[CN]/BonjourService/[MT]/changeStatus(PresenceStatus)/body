{
  if (stat.equals(status))   return;
  if (stat.equals(ZeroconfStatusEnum.OFFLINE)) {
    if (logger.isDebugEnabled())     logger.debug("ZEROCONF: Going OFFLINE");
    jmdns.removeServiceListener("_presence._tcp.local.",this);
    jmdns.close();
    jmdns=null;
    opSetPersPresence.changePresenceStatusForAllContacts(opSetPersPresence.getServerStoredContactListRoot(),stat);
    try {
      sleep(1000);
    }
 catch (    InterruptedException ex) {
      logger.error(ex);
    }
  }
 else   if (status.equals(ZeroconfStatusEnum.OFFLINE)) {
    if (logger.isDebugEnabled())     logger.debug("ZEROCONF: Getting out of OFFLINE state");
    props.put("status",stat.getStatusName());
    service=new ServiceInfo("_presence._tcp.local.",id,port,0,0,props);
    try {
      jmdns=new JmDNS();
      jmdns.registerServiceType("_presence._tcp.local.");
      jmdns.addServiceListener("_presence._tcp.local.",this);
      jmdns.registerService(service);
      id=service.getName();
    }
 catch (    Exception ex) {
      logger.error(ex);
    }
  }
 else {
    if (logger.isDebugEnabled())     logger.debug("ZEROCONF : Changing status");
    props.put("status",stat.getStatusName());
    ServiceInfo info=jmdns.getLocalService(id.toLowerCase() + "._presence._tcp.local.");
    if (info == null)     logger.error("ZEROCONF/JMDNS: PROBLEM GETTING " + "LOCAL SERVICEINFO !!");
    byte[] old=info.getTextBytes();
    info.setProps(props);
    jmdns.updateInfos(info,old);
  }
  status=stat;
}
