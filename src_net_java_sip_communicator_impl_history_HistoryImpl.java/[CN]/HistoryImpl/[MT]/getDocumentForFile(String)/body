{
  Document retVal=null;
synchronized (this.historyDocuments) {
    if (!this.historyDocuments.containsKey(filename)) {
      throw new InvalidParameterException("The requested " + "filename does not exist in the document list.");
    }
    Object obj=this.historyDocuments.get(filename);
    if (obj instanceof Document) {
      retVal=(Document)obj;
    }
 else     if (obj instanceof File) {
      File file=(File)obj;
      DocumentBuilder builder=this.historyServiceImpl.getDocumentBuilder();
      try {
        retVal=builder.parse(file);
      }
 catch (      Exception e) {
        log.error("Error occured while parsing XML document.");
        retVal=getFixedDocument(file);
        if (retVal == null)         return null;
      }
      if (historyServiceImpl.isCacheEnabled())       this.historyDocuments.put(filename,retVal);
    }
 else {
    }
  }
  return retVal;
}
