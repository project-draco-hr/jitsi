{
  Iterable<NotificationHandler> popupHandlers=GuiActivator.getNotificationService().getActionHandlers(NotificationAction.ACTION_POPUP_MESSAGE);
  for (  NotificationHandler popupHandler : popupHandlers) {
    if (!(popupHandler instanceof PopupMessageNotificationHandler))     continue;
    PopupMessageNotificationHandler popupMessageNotificationHandler=(PopupMessageNotificationHandler)popupHandler;
    if (listener == null) {
      listener=new SystrayPopupMessageListener(){
        public void popupMessageClicked(        SystrayPopupMessageEvent evt){
          Object tag=evt.getTag();
          if (tag instanceof ErrorDialogParams) {
            ErrorDialogParams params=(ErrorDialogParams)tag;
            if (params.getEx() != null) {
              showAlertDialog(params.getTitle(),params.getMessage(),params.getEx());
            }
 else {
              showAlertDialog(params.getTitle(),params.getMessage());
            }
          }
        }
      }
;
    }
    if (add) {
      popupMessageNotificationHandler.addPopupMessageListener(listener);
    }
 else {
      popupMessageNotificationHandler.removePopupMessageListener(listener);
    }
  }
}
