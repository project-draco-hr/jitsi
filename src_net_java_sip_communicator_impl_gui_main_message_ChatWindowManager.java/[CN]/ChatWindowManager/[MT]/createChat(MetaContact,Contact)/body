{
synchronized (syncChat) {
    ChatWindow chatWindow;
    if (Constants.TABBED_CHAT_WINDOW && this.chatWindow != null)     chatWindow=this.chatWindow;
 else {
      chatWindow=new ChatWindow(mainFrame);
      this.chatWindow=chatWindow;
    }
    ChatPanel chatPanel=new ChatPanel(chatWindow,contact,protocolContact);
synchronized (chats) {
      this.chats.put(contact,chatPanel);
    }
    chatPanel.loadHistory();
    return chatPanel;
  }
}
