{
synchronized (syncChat) {
    if (containsContactChat(chatPanel)) {
      ChatWindow chatWindow=chatPanel.getChatWindow();
      if (!chatPanel.isWriteAreaEmpty()) {
        SIPCommMsgTextArea msgText=new SIPCommMsgTextArea(Messages.getI18NString("nonEmptyChatWindowClose").getText());
        int answer=JOptionPane.showConfirmDialog(chatWindow,msgText,Messages.getI18NString("warning").getText(),JOptionPane.OK_CANCEL_OPTION,JOptionPane.WARNING_MESSAGE);
        if (answer == JOptionPane.OK_OPTION) {
          closeChatPanel(chatPanel);
        }
      }
 else       if (System.currentTimeMillis() - chatPanel.getLastIncomingMsgTimestamp().getTime() < 2 * 1000) {
        SIPCommMsgTextArea msgText=new SIPCommMsgTextArea(Messages.getI18NString("closeChatAfterNewMsg").getText());
        int answer=JOptionPane.showConfirmDialog(chatWindow,msgText,Messages.getI18NString("warning").getText(),JOptionPane.OK_CANCEL_OPTION,JOptionPane.WARNING_MESSAGE);
        if (answer == JOptionPane.OK_OPTION) {
          closeChatPanel(chatPanel);
        }
      }
 else {
        closeChatPanel(chatPanel);
      }
    }
  }
}
