{
synchronized (syncChat) {
    ChatWindow chatWindow=chatPanel.getChatWindow();
    if (!chatPanel.isWindowVisible())     chatWindow.addChat(chatPanel);
    if (chatWindow.isVisible()) {
      if (ConfigurationManager.isAutoPopupNewMessage() || setSelected) {
        if (chatWindow.getState() == JFrame.ICONIFIED)         chatWindow.setState(JFrame.NORMAL);
        chatWindow.toFront();
      }
 else {
        if (chatWindow.getState() == JFrame.ICONIFIED && !chatWindow.getTitle().startsWith("*")) {
          chatWindow.setTitle("*" + chatWindow.getTitle());
        }
      }
    }
 else {
      if (!setSelected)       chatWindow.setCurrentChatPanel(chatPanel);
      chatWindow.setVisible(true);
    }
    chatPanel.setCaretToEnd();
    if (setSelected)     chatWindow.setCurrentChatPanel(chatPanel);
 else {
      if (chatWindow.getChatTabCount() > 0)       chatPanel.getChatWindow().highlightTab(chatPanel);
    }
  }
}
