{
synchronized (syncChat) {
    ChatWindow chatWindow;
    chatWindow=chatPanel.getChatWindow();
    if (!chatPanel.isWindowVisible())     chatWindow.addChat(chatPanel);
    if (chatWindow.getState() == JFrame.ICONIFIED && !chatWindow.getTitle().startsWith("*")) {
      chatWindow.setTitle("*" + chatWindow.getTitle());
    }
    if (chatWindow.isVisible()) {
      if (ConfigurationManager.isAutoPopupNewMessage()) {
        if (chatWindow.getState() == JFrame.ICONIFIED && setSelected)         chatWindow.setState(JFrame.NORMAL);
        chatWindow.toFront();
      }
    }
 else     chatWindow.setVisible(true);
    if (Constants.TABBED_CHAT_WINDOW && chatWindow.getTabCount() > 1) {
      if (setSelected)       chatWindow.setSelectedChatTab(chatPanel);
 else       chatPanel.getChatWindow().highlightTab(chatPanel);
    }
    chatPanel.setCaretToEnd();
    chatWindow.getCurrentChatPanel().requestFocusInWriteArea();
  }
}
