{
  if (provider == null) {
    throw new IllegalArgumentException("provider cannot be null");
  }
  this.provider=provider;
  if (irc == null) {
    throw new IllegalArgumentException("irc instance cannot be null");
  }
  irc.addListener(new ServerListener(irc));
  this.irc=irc;
  this.connectionState=connectSynchronized(this.provider,params,irc);
  this.presence=new PresenceManager(this.irc,this.connectionState,this.provider.getPersistentPresence());
  this.channelLister=new ServerChannelLister(this.irc,this.connectionState);
  this.identity=new IdentityManager(this.irc,this.connectionState);
  this.channel=new ChannelManager(this.irc,this.connectionState,this.provider,this.identity);
}
