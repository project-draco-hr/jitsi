{
  AccountManager accountManager=GuiActivator.getAccountManager();
  for (  AccountID accountID : accountManager.getStoredAccounts()) {
    if (accountManager.isAccountLoaded(accountID)) {
      ProtocolProviderService protocolProvider=GuiActivator.getRegisteredProviderForAccount(accountID);
      if (protocolProvider != null) {
        OperationSetAvatar opSetAvatar=protocolProvider.getOperationSet(OperationSetAvatar.class);
        if (opSetAvatar != null) {
          try {
            opSetAvatar.setAvatar(ImageUtils.toByteArray(image));
          }
 catch (          Throwable t) {
            logger.error("Error setting image",t);
          }
        }
      }
    }
  }
}
