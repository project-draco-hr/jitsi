{
  storageManager.storeContactListAndStopStorageManager();
  bc.removeServiceListener(this);
  Iterator providers=this.currentlyInstalledProviders.values().iterator();
  while (providers.hasNext()) {
    ProtocolProviderService pp=(ProtocolProviderService)providers.next();
    OperationSetPersistentPresence opSetPersPresence=(OperationSetPersistentPresence)pp.getOperationSet(OperationSetPersistentPresence.class);
    if (opSetPersPresence != null) {
      opSetPersPresence.removeSubscriptionListener(clSubscriptionEventHandler);
      opSetPersPresence.removeServerStoredGroupChangeListener(clGroupEventHandler);
    }
 else {
      OperationSetPresence opSetPresence=(OperationSetPresence)pp.getOperationSet(OperationSetPresence.class);
      if (opSetPresence != null) {
        opSetPresence.removeSubscriptionListener(clSubscriptionEventHandler);
      }
    }
  }
  currentlyInstalledProviders.clear();
  if (storageManager != null) {
    storageManager.stop();
  }
}
