{
  this.treeContactList=(TreeContactList)tree;
  this.row=row;
  this.isSelected=selected;
  this.treeNode=(TreeNode)value;
  this.rightLabel.setIcon(null);
  DefaultTreeContactList contactList=(DefaultTreeContactList)tree;
  setBorder();
  addLabels(1);
  if (contactList instanceof TreeContactList) {
    ContactListFilter filter=((TreeContactList)contactList).getCurrentFilter();
    if (filter != null && filter.equals(TreeContactList.historyFilter) && value instanceof ContactNode && row % 2 == 0) {
      setBackground(Constants.CALL_HISTORY_EVEN_ROW_COLOR);
    }
 else {
      setBackground(Color.WHITE);
    }
  }
  this.nameLabel.setIcon(null);
  if (value instanceof ContactNode) {
    UIContactImpl contact=((ContactNode)value).getContactDescriptor();
    if ((contact.getDescriptor() instanceof SourceContact) && ((SourceContact)contact.getDescriptor()).getPreferredContactDetail(OperationSetMultiUserChat.class) != null) {
      setBackground(Constants.CHAT_ROOM_ROW_COLOR);
    }
    String displayName=contact.getDisplayName();
    if ((displayName == null || displayName.trim().length() < 1) && !(contact instanceof ShowMoreContact)) {
      displayName=GuiActivator.getResources().getI18NString("service.gui.UNKNOWN");
    }
    this.nameLabel.setText(displayName);
    if (statusIcon != null && contactList.isContactActive(contact) && statusIcon instanceof ImageIcon)     ((ImageIcon)statusIcon).setImage(msgReceivedImage);
 else     statusIcon=contact.getStatusIcon();
    this.statusLabel.setIcon(statusIcon);
    this.nameLabel.setFont(this.getFont().deriveFont(Font.PLAIN));
    if (contactForegroundColor != null)     nameLabel.setForeground(contactForegroundColor);
    this.initDisplayDetails(contact.getDisplayDetails());
    if (contact.getDescriptor() instanceof MetaContact && isMobile((MetaContact)contact.getDescriptor())) {
      this.nameLabel.setIcon(new ImageIcon(ImageLoader.getImage(ImageLoader.CONTACT_LIST_MOBILE_INDICATOR)));
      this.nameLabel.setHorizontalTextPosition(SwingConstants.LEFT);
    }
    if (this.treeContactList.isContactButtonsVisible())     this.initButtonsPanel(contact);
    int avatarWidth, avatarHeight;
    if (isSelected && treeContactList.isContactButtonsVisible()) {
      avatarWidth=EXTENDED_AVATAR_WIDTH;
      avatarHeight=EXTENDED_AVATAR_HEIGHT;
    }
 else {
      avatarWidth=AVATAR_WIDTH;
      avatarHeight=AVATAR_HEIGHT;
    }
    Icon avatar=contact.getScaledAvatar(isSelected,avatarWidth,avatarHeight);
    if (avatar != null) {
      this.rightLabel.setIcon(avatar);
    }
    if (contact instanceof ShowMoreContact) {
      rightLabel.setFont(rightLabel.getFont().deriveFont(12f));
      rightLabel.setForeground(Color.GRAY);
      rightLabel.setText((String)contact.getDescriptor());
    }
 else {
      rightLabel.setFont(rightLabel.getFont().deriveFont(9f));
      rightLabel.setText("");
    }
    this.setToolTipText(contact.getDescriptor().toString());
  }
 else   if (value instanceof GroupNode) {
    UIGroupImpl groupItem=((GroupNode)value).getGroupDescriptor();
    this.nameLabel.setText(groupItem.getDisplayName());
    this.nameLabel.setFont(this.getFont().deriveFont(Font.BOLD));
    if (groupForegroundColor != null)     this.nameLabel.setForeground(groupForegroundColor);
    this.remove(displayDetailsLabel);
    this.remove(callButton);
    this.remove(callVideoButton);
    this.remove(desktopSharingButton);
    this.remove(chatButton);
    this.remove(addContactButton);
    this.remove(webButton);
    clearCustomActionButtons();
    statusIcon=expanded ? openedGroupIcon : closedGroupIcon;
    this.statusLabel.setIcon(expanded ? openedGroupIcon : closedGroupIcon);
    this.rightLabel.setIcon(null);
    this.rightLabel.setText("");
    if (groupItem.countChildContacts() >= 0) {
      rightLabel.setFont(rightLabel.getFont().deriveFont(9f));
      this.rightLabel.setForeground(Color.BLACK);
      this.rightLabel.setText(groupItem.countOnlineChildContacts() + "/" + groupItem.countChildContacts());
    }
    this.initDisplayDetails(groupItem.getDisplayDetails());
    this.initButtonsPanel(groupItem);
    this.setToolTipText(groupItem.getDescriptor().toString());
  }
  return this;
}
