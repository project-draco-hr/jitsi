{
  AbstractButton button=(AbstractButton)e.getSource();
  String buttonText=button.getName();
  ChatPanel chatPanel=messageWindow.getCurrentChatPanel();
  if (buttonText.equals("previous")) {
    chatPanel.loadPreviousPageFromHistory();
  }
 else   if (buttonText.equals("next")) {
    chatPanel.loadNextPageFromHistory();
  }
 else   if (buttonText.equals("sendFile")) {
    JFileChooser fileChooser=new JFileChooser(ConfigurationManager.getSendFileLastDir());
    int result=fileChooser.showOpenDialog(this);
    if (result == JFileChooser.APPROVE_OPTION) {
      File selectedFile=fileChooser.getSelectedFile();
      ConfigurationManager.setSendFileLastDir(selectedFile.getParent());
      messageWindow.getCurrentChatPanel().sendFile(selectedFile);
    }
  }
 else   if (buttonText.equals("history")) {
    HistoryWindow history;
    HistoryWindowManager historyWindowManager=GuiActivator.getUIService().getHistoryWindowManager();
    ChatSession chatSession=chatPanel.getChatSession();
    if (historyWindowManager.containsHistoryWindowForContact(chatSession.getDescriptor())) {
      history=historyWindowManager.getHistoryWindowForContact(chatSession.getDescriptor());
      if (history.getState() == JFrame.ICONIFIED)       history.setState(JFrame.NORMAL);
      history.toFront();
    }
 else {
      history=new HistoryWindow(chatPanel.getChatSession().getDescriptor());
      history.setVisible(true);
      historyWindowManager.addHistoryWindowForContact(chatSession.getDescriptor(),history);
    }
  }
 else   if (buttonText.equals("invite")) {
    ChatInviteDialog inviteDialog=new ChatInviteDialog(chatPanel);
    inviteDialog.setVisible(true);
  }
 else   if (buttonText.equals("options")) {
    GuiActivator.getUIService().setConfigurationWindowVisible(true);
  }
}
