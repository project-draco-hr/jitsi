{
  List<ChatTransport> list=new ArrayList<ChatTransport>();
  for (  ChatTransport transport : transports) {
    OperationSetContactCapabilities capOpSet=transport.getProtocolProvider().getOperationSet(OperationSetContactCapabilities.class);
    OperationSetPersistentPresence presOpSet=transport.getProtocolProvider().getOperationSet(OperationSetPersistentPresence.class);
    if (capOpSet == null) {
      list.add(transport);
    }
 else     if (presOpSet != null) {
      Contact contact=presOpSet.findContactByID(transport.getName());
      if (capOpSet.getOperationSet(contact,opSetClass) != null) {
        list.add(transport);
      }
    }
  }
  return list;
}
