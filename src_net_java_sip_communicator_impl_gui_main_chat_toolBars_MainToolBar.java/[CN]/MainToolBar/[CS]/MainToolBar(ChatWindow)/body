{
  this.messageWindow=messageWindow;
  this.smiliesBox=new SmiliesSelectorBox(ImageLoader.getDefaultSmiliesPack(),messageWindow);
  this.setRollover(true);
  this.setLayout(new FlowLayout(FlowLayout.LEFT,3,0));
  this.setBorder(BorderFactory.createEmptyBorder(2,2,5,2));
  this.add(cutButton);
  this.add(copyButton);
  this.add(pasteButton);
  this.addSeparator();
  this.add(smiliesBox);
  this.addSeparator();
  this.add(previousButton);
  this.add(nextButton);
  this.addSeparator();
  this.add(historyButton);
  this.addSeparator();
  this.add(addButton);
  this.saveButton.setName("save");
  this.saveButton.setToolTipText(Messages.getI18NString("save").getText() + " Ctrl-S");
  this.printButton.setName("print");
  this.printButton.setToolTipText(Messages.getI18NString("print").getText());
  this.cutButton.setName("cut");
  this.cutButton.setToolTipText(Messages.getI18NString("cut").getText() + " Ctrl-X");
  this.copyButton.setName("copy");
  this.copyButton.setToolTipText(Messages.getI18NString("copy").getText() + " Ctrl-C");
  this.pasteButton.setName("paste");
  this.pasteButton.setToolTipText(Messages.getI18NString("paste").getText() + " Ctrl-P");
  this.smiliesBox.setName("smiley");
  this.smiliesBox.setToolTipText(Messages.getI18NString("insertSmiley").getText() + " Ctrl-M");
  this.previousButton.setName("previous");
  this.previousButton.setToolTipText(Messages.getI18NString("previous").getText());
  this.nextButton.setName("next");
  this.nextButton.setToolTipText(Messages.getI18NString("next").getText());
  this.sendFileButton.setName("sendFile");
  this.sendFileButton.setToolTipText(Messages.getI18NString("sendFile").getText());
  this.historyButton.setName("history");
  this.historyButton.setToolTipText(Messages.getI18NString("history").getText() + " Ctrl-H");
  this.addButton.setName("addContact");
  this.addButton.setToolTipText(Messages.getI18NString("addContact").getText());
  this.fontButton.setName("font");
  this.fontButton.setToolTipText(Messages.getI18NString("font").getText());
  this.saveButton.addActionListener(this);
  this.printButton.addActionListener(this);
  this.cutButton.addActionListener(this);
  this.copyButton.addActionListener(this);
  this.pasteButton.addActionListener(this);
  this.previousButton.addActionListener(this);
  this.nextButton.addActionListener(this);
  this.sendFileButton.addActionListener(this);
  this.historyButton.addActionListener(this);
  this.addButton.addActionListener(this);
  this.fontButton.addActionListener(this);
  this.saveButton.setPreferredSize(new Dimension(BUTTON_WIDTH,BUTTON_HEIGHT));
  this.printButton.setPreferredSize(new Dimension(BUTTON_WIDTH,BUTTON_HEIGHT));
  this.cutButton.setPreferredSize(new Dimension(BUTTON_WIDTH,BUTTON_HEIGHT));
  this.copyButton.setPreferredSize(new Dimension(BUTTON_WIDTH,BUTTON_HEIGHT));
  this.pasteButton.setPreferredSize(new Dimension(BUTTON_WIDTH,BUTTON_HEIGHT));
  this.previousButton.setPreferredSize(new Dimension(BUTTON_WIDTH,BUTTON_HEIGHT));
  this.nextButton.setPreferredSize(new Dimension(BUTTON_WIDTH,BUTTON_HEIGHT));
  this.sendFileButton.setPreferredSize(new Dimension(BUTTON_WIDTH,BUTTON_HEIGHT));
  this.historyButton.setPreferredSize(new Dimension(BUTTON_WIDTH,BUTTON_HEIGHT));
  this.fontButton.setPreferredSize(new Dimension(BUTTON_WIDTH,BUTTON_HEIGHT));
  this.saveButton.setEnabled(false);
  this.printButton.setEnabled(false);
  this.sendFileButton.setEnabled(false);
  this.fontButton.setEnabled(false);
  this.initPluginComponents();
  messageWindow.addChatChangeListener(new ChatChangeListener(){
    public void chatChanged(    ChatPanel panel){
      if (panel instanceof MetaContactChatPanel) {
        MetaContact contact=((MetaContactChatPanel)panel).getMetaContact();
        if (contact == null)         return;
        Contact defaultContact=contact.getDefaultContact();
        if (defaultContact == null)         return;
        ContactGroup parent=defaultContact.getParentContactGroup();
        boolean isParentPersist=true;
        boolean isParentResolved=true;
        if (parent != null) {
          isParentPersist=parent.isPersistent();
          isParentResolved=parent.isResolved();
        }
        if (!defaultContact.isPersistent() && !defaultContact.isResolved() && !isParentPersist&& !isParentResolved) {
          addButton.setVisible(true);
          currentChatContact=defaultContact;
        }
 else {
          addButton.setVisible(false);
          currentChatContact=null;
        }
      }
    }
  }
);
}
