{
  String content=null;
  try {
    content=new String(requestEvent.getRequest().getRawContent(),requestEvent.getRequest().getContentEncoding().getEncoding());
  }
 catch (  UnsupportedEncodingException ex) {
    logger.debug("failed to convert the message charset");
    content=new String(requestEvent.getRequest().getRawContent());
  }
  FromHeader fromHeader=(FromHeader)requestEvent.getRequest().getHeader(FromHeader.NAME);
  if (fromHeader == null) {
    logger.error("received a request without a from header");
    return;
  }
  Contact from=opSetPersPresence.findContactByID(fromHeader.getAddress().getURI().toString());
  Message newMessage=createMessage(content);
  if (from == null) {
    logger.debug("received a message from an unknown contact: " + from);
    from=opSetPersPresence.createVolatileContact(fromHeader.getAddress().getURI().toString());
  }
  try {
    Response ack=sipProvider.getMessageFactory().createResponse(Response.OK,requestEvent.getRequest());
    SipProvider jainSipProvider=(SipProvider)requestEvent.getSource();
    jainSipProvider.getNewServerTransaction(requestEvent.getRequest()).sendResponse(ack);
  }
 catch (  ParseException ex) {
    logger.error("failed to build the response");
  }
catch (  SipException exc) {
    logger.error("failed to send the response : " + exc.getMessage());
  }
catch (  InvalidArgumentException exc1) {
    logger.debug("Invalid argument for createResponse : " + exc1.getMessage());
  }
  MessageReceivedEvent msgReceivedEvt=new MessageReceivedEvent(newMessage,from,new Date());
  fireMessageEvent(msgReceivedEvt);
}
